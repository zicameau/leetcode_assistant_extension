var firebaseClient=(()=>{var wc=Object.defineProperty;var xy=Object.getOwnPropertyDescriptor;var Ly=Object.getOwnPropertyNames;var My=Object.prototype.hasOwnProperty;var Fy=(n,e)=>{for(var t in e)wc(n,t,{get:e[t],enumerable:!0})},Uy=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ly(e))!My.call(n,i)&&i!==t&&wc(n,i,{get:()=>e[i],enumerable:!(r=xy(e,i))||r.enumerable});return n};var By=n=>Uy(wc({},"__esModule",{value:!0}),n);var NA={};Fy(NA,{addMessageToChat:()=>RA,auth:()=>$e,checkEmailVerified:()=>AA,createChat:()=>SA,db:()=>Br,enableOfflinePersistenceSafe:()=>_A,ensureUserProfile:()=>bA,firebaseApp:()=>yd,initAuthPersistence:()=>gA,listChats:()=>PA,listMessages:()=>CA,onAuthChanged:()=>yA,onIdTokenChangedListener:()=>IA,registerWithEmailPassword:()=>wA,sendVerificationEmail:()=>vA,signInWithEmailPassword:()=>EA,signOutUser:()=>TA});var Tf=()=>{};var bf=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},qy=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],c=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},Sf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,c=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,f=s>>2,m=(s&3)<<4|c>>4,_=(c&15)<<2|h>>6,R=h&63;u||(R=64,o||(_=64)),r.push(t[f],t[m],t[_],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(bf(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qy(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let h=i<n.length?t[n.charAt(i)]:64;++i;let m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||h==null||m==null)throw new vc;let _=s<<2|c>>4;if(r.push(_),h!==64){let R=c<<4&240|h>>2;if(r.push(R),m!==64){let k=h<<6&192|m;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},vc=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},jy=function(n){let e=bf(n);return Sf.encodeByteArray(e,!0)},ii=function(n){return jy(n).replace(/\./g,"")},Ps=function(n){try{return Sf.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function bc(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var zy=()=>bc().__FIREBASE_DEFAULTS__,Gy=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},$y=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Ps(n[1]);return e&&JSON.parse(e)},Cs=()=>{try{return Tf()||zy()||Gy()||$y()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Sc=n=>Cs()?.emulatorHosts?.[n],Rf=n=>{let e=Sc(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Rc=()=>Cs()?.config,Pc=n=>Cs()?.[`_${n}`];var Rs=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Pt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ns(n){return(await fetch(n,{credentials:"include"})).ok}function Pf(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...n};return[ii(JSON.stringify(t)),ii(JSON.stringify(o)),""].join(".")}var ri={};function Ky(){let n={prod:[],emulator:[]};for(let e of Object.keys(ri))ri[e]?n.emulator.push(e):n.prod.push(e);return n}function Wy(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var vf=!1;function ks(n,e){if(typeof window>"u"||typeof document>"u"||!Pt(window.location.host)||ri[n]===e||ri[n]||vf)return;ri[n]=e;function t(_){return`__firebase__banner__${_}`}let r="__firebase__banner",s=Ky().prod.length>0;function o(){let _=document.getElementById(r);_&&_.remove()}function c(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function u(_,R){_.setAttribute("width","24"),_.setAttribute("id",R),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function h(){let _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{vf=!0,o()},_}function f(_,R){_.setAttribute("id",R),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function m(){let _=Wy(r),R=t("text"),k=document.getElementById(R)||document.createElement("span"),V=t("learnmore"),N=document.getElementById(V)||document.createElement("a"),j=t("preprendIcon"),q=document.getElementById(j)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){let U=_.element;c(U),f(N,V);let ee=h();u(q,j),U.append(q,k,N,ee),document.body.appendChild(U)}s?(k.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function ue(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Cf(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ue())}function Nf(){let n=Cs()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kf(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Df(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Vf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Of(){let n=ue();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Cc(){return!Nf()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Nc(){return!Nf()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Ds(){try{return typeof indexedDB=="object"}catch{return!1}}function xf(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var Hy="FirebaseError",Le=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Hy,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ut.prototype.create)}},ut=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Qy(s,r):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new Le(i,c,r)}};function Qy(n,e){return n.replace(Jy,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Jy=/\{\$([^}]+)}/g;function Lf(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function et(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],o=e[i];if(Af(s)&&Af(o)){if(!et(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Af(n){return n!==null&&typeof n=="object"}function Hn(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Qn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Jn(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Mf(n,e){let t=new Ac(n,e);return t.subscribe.bind(t)}var Ac=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Yy(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Tc),i.error===void 0&&(i.error=Tc),i.complete===void 0&&(i.complete=Tc);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Yy(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Tc(){}var OA=14400*1e3;function oe(n){return n&&n._delegate?n._delegate:n}var qe=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var hn="[DEFAULT]";var kc=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Rs;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Zy(e))try{this.getOrInitializeService({instanceIdentifier:hn})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=hn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=hn){return this.instances.has(e)}getOptions(e=hn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,o]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&o.resolve(i)}return i}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Xy(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=hn){return this.component?this.component.multipleInstances?e:hn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Xy(n){return n===hn?void 0:n}function Zy(n){return n.instantiationMode==="EAGER"}var Vs=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new kc(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var eI=[],W;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(W||(W={}));var tI={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},nI=W.INFO,rI={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},iI=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=rI[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ct=class{constructor(e){this.name=e,this._logLevel=nI,this._logHandler=iI,this._userLogHandler=null,eI.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}};var sI=(n,e)=>e.some(t=>n instanceof t),Ff,Uf;function oI(){return Ff||(Ff=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aI(){return Uf||(Uf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Bf=new WeakMap,Vc=new WeakMap,qf=new WeakMap,Dc=new WeakMap,xc=new WeakMap;function cI(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(tt(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Bf.set(t,n)}).catch(()=>{}),xc.set(e,n),e}function uI(n){if(Vc.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});Vc.set(n,e)}var Oc={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Vc.get(n);if(e==="objectStoreNames")return n.objectStoreNames||qf.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return tt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function jf(n){Oc=n(Oc)}function lI(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(Os(this),e,...t);return qf.set(r,e.sort?e.sort():[e]),tt(r)}:aI().includes(n)?function(...e){return n.apply(Os(this),e),tt(Bf.get(this))}:function(...e){return tt(n.apply(Os(this),e))}}function hI(n){return typeof n=="function"?lI(n):(n instanceof IDBTransaction&&uI(n),sI(n,oI())?new Proxy(n,Oc):n)}function tt(n){if(n instanceof IDBRequest)return cI(n);if(Dc.has(n))return Dc.get(n);let e=hI(n);return e!==n&&(Dc.set(n,e),xc.set(e,n)),e}var Os=n=>xc.get(n);function Gf(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,e),c=tt(o);return r&&o.addEventListener("upgradeneeded",u=>{r(tt(o.result),u.oldVersion,u.newVersion,tt(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}var dI=["get","getKey","getAll","getAllKeys","count"],fI=["put","add","delete","clear"],Lc=new Map;function zf(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Lc.get(e))return Lc.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=fI.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||dI.includes(t)))return;let s=async function(o,...c){let u=this.transaction(o,i?"readwrite":"readonly"),h=u.store;return r&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),i&&u.done]))[0]};return Lc.set(e,s),s}jf(n=>({...n,get:(e,t,r)=>zf(e,t)||n.get(e,t,r),has:(e,t)=>!!zf(e,t)||n.has(e,t)}));var Fc=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pI(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function pI(n){return n.getComponent()?.type==="VERSION"}var Uc="@firebase/app",$f="0.14.6";var lt=new Ct("@firebase/app"),mI="@firebase/app-compat",gI="@firebase/analytics-compat",_I="@firebase/analytics",yI="@firebase/app-check-compat",II="@firebase/app-check",EI="@firebase/auth",wI="@firebase/auth-compat",TI="@firebase/database",vI="@firebase/data-connect",AI="@firebase/database-compat",bI="@firebase/functions",SI="@firebase/functions-compat",RI="@firebase/installations",PI="@firebase/installations-compat",CI="@firebase/messaging",NI="@firebase/messaging-compat",kI="@firebase/performance",DI="@firebase/performance-compat",VI="@firebase/remote-config",OI="@firebase/remote-config-compat",xI="@firebase/storage",LI="@firebase/storage-compat",MI="@firebase/firestore",FI="@firebase/ai",UI="@firebase/firestore-compat",BI="firebase",qI="12.6.0";var Bc="[DEFAULT]",jI={[Uc]:"fire-core",[mI]:"fire-core-compat",[_I]:"fire-analytics",[gI]:"fire-analytics-compat",[II]:"fire-app-check",[yI]:"fire-app-check-compat",[EI]:"fire-auth",[wI]:"fire-auth-compat",[TI]:"fire-rtdb",[vI]:"fire-data-connect",[AI]:"fire-rtdb-compat",[bI]:"fire-fn",[SI]:"fire-fn-compat",[RI]:"fire-iid",[PI]:"fire-iid-compat",[CI]:"fire-fcm",[NI]:"fire-fcm-compat",[kI]:"fire-perf",[DI]:"fire-perf-compat",[VI]:"fire-rc",[OI]:"fire-rc-compat",[xI]:"fire-gcs",[LI]:"fire-gcs-compat",[MI]:"fire-fst",[UI]:"fire-fst-compat",[FI]:"fire-vertex","fire-js":"fire-js",[BI]:"fire-js-all"};var xs=new Map,zI=new Map,qc=new Map;function Kf(n,e){try{n.container.addComponent(e)}catch(t){lt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function kt(n){let e=n.name;if(qc.has(e))return lt.debug(`There were multiple attempts to register component ${e}.`),!1;qc.set(e,n);for(let t of xs.values())Kf(t,n);for(let t of zI.values())Kf(t,n);return!0}function oi(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function De(n){return n==null?!1:n.settings!==void 0}var GI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Nt=new ut("app","Firebase",GI);var jc=class{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new qe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Nt.create("app-deleted",{appName:this._name})}};var Dt=qI;function $c(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r={name:Bc,automaticDataCollectionEnabled:!0,...e},i=r.name;if(typeof i!="string"||!i)throw Nt.create("bad-app-name",{appName:String(i)});if(t||(t=Rc()),!t)throw Nt.create("no-options");let s=xs.get(i);if(s){if(et(t,s.options)&&et(r,s.config))return s;throw Nt.create("duplicate-app",{appName:i})}let o=new Vs(i);for(let u of qc.values())o.addComponent(u);let c=new jc(t,r,o);return xs.set(i,c),c}function Ls(n=Bc){let e=xs.get(n);if(!e&&n===Bc&&Rc())return $c();if(!e)throw Nt.create("no-app",{appName:n});return e}function Ke(n,e,t){let r=jI[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){let o=[`Unable to register library "${r}" with version "${e}":`];i&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),lt.warn(o.join(" "));return}kt(new qe(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var $I="firebase-heartbeat-database",KI=1,si="firebase-heartbeat-store",Mc=null;function Jf(){return Mc||(Mc=Gf($I,KI,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(si)}catch(t){console.warn(t)}}}}).catch(n=>{throw Nt.create("idb-open",{originalErrorMessage:n.message})})),Mc}async function WI(n){try{let t=(await Jf()).transaction(si),r=await t.objectStore(si).get(Yf(n));return await t.done,r}catch(e){if(e instanceof Le)lt.warn(e.message);else{let t=Nt.create("idb-get",{originalErrorMessage:e?.message});lt.warn(t.message)}}}async function Wf(n,e){try{let r=(await Jf()).transaction(si,"readwrite");await r.objectStore(si).put(e,Yf(n)),await r.done}catch(t){if(t instanceof Le)lt.warn(t.message);else{let r=Nt.create("idb-set",{originalErrorMessage:t?.message});lt.warn(r.message)}}}function Yf(n){return`${n.name}!${n.options.appId}`}var HI=1024,QI=30,zc=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Gc(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Hf();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>QI){let i=YI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){lt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=Hf(),{heartbeatsToSend:t,unsentEntries:r}=JI(this._heartbeatsCache.heartbeats),i=ii(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return lt.warn(e),""}}};function Hf(){return new Date().toISOString().substring(0,10)}function JI(n,e=HI){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Qf(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Qf(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Gc=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ds()?xf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let t=await WI(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){let r=await this.read();return Wf(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){let r=await this.read();return Wf(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}};function Qf(n){return ii(JSON.stringify({version:2,heartbeats:n})).length}function YI(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function XI(n){kt(new qe("platform-logger",e=>new Fc(e),"PRIVATE")),kt(new qe("heartbeat",e=>new zc(e),"PRIVATE")),Ke(Uc,$f,n),Ke(Uc,$f,"esm2020"),Ke("fire-js","")}XI("");var ZI="firebase",eE="12.6.0";Ke(ZI,eE,"app");function gp(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var _p=gp,yp=new ut("auth","Firebase",gp());var zs=new Ct("@firebase/auth");function tE(n,...e){zs.logLevel<=W.WARN&&zs.warn(`Auth (${Dt}): ${n}`,...e)}function Fs(n,...e){zs.logLevel<=W.ERROR&&zs.error(`Auth (${Dt}): ${n}`,...e)}function We(n,...e){throw gu(n,...e)}function rt(n,...e){return gu(n,...e)}function Ip(n,e,t){let r={..._p(),[e]:t};return new ut("auth","Firebase",r).create(e,{appName:n.name})}function dt(n){return Ip(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function gu(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return yp.create(n,...e)}function L(n,e,...t){if(!n)throw gu(e,...t)}function nt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Fs(e),new Error(e)}function ft(n,e){n||nt(e)}function Yc(){return typeof self<"u"&&self.location?.href||""}function nE(){return Xf()==="http:"||Xf()==="https:"}function Xf(){return typeof self<"u"&&self.location?.protocol||null}function rE(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nE()||Df()||"connection"in navigator)?navigator.onLine:!0}function iE(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var dn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,ft(t>e,"Short delay should be less than long delay!"),this.isMobile=Cf()||Vf()}get(){return rE()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function _u(n,e){ft(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Gs=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;nt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;nt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;nt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var sE={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var oE=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],aE=new dn(3e4,6e4);function le(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function we(n,e,t,r,i={}){return Ep(n,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});let c=Hn({key:n.config.apiKey,...o}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);let h={method:e,headers:u,...s};return kf()||(h.referrerPolicy="no-referrer"),n.emulatorConfig&&Pt(n.emulatorConfig.host)&&(h.credentials="include"),Gs.fetch()(await wp(n,n.config.apiHost,t,c),h)})}async function Ep(n,e,t){n._canInitEmulator=!1;let r={...sE,...e};try{let i=new Xc(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=await s.json();if("needConfirmation"in o)throw ci(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ci(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw ci(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw ci(n,"user-disabled",o);let f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Ip(n,f,h);We(n,f)}}catch(i){if(i instanceof Le)throw i;We(n,"network-request-failed",{message:String(i)})}}async function xt(n,e,t,r,i={}){let s=await we(n,e,t,r,i);return"mfaPendingCredential"in s&&We(n,"multi-factor-auth-required",{_serverResponse:s}),s}async function wp(n,e,t,r){let i=`${e}${t}?${r}`,s=n,o=s.config.emulator?_u(n.config,i):`${n.config.apiScheme}://${i}`;return oE.includes(t)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}function cE(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Xc=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(rt(this.auth,"network-request-failed")),aE.get())})}};function ci(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=rt(n,e,r);return i.customData._tokenResponse=t,i}function Zf(n){return n!==void 0&&n.enterprise!==void 0}var $s=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return cE(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}};async function Tp(n,e){return we(n,"GET","/v2/recaptchaConfig",le(n,e))}async function uE(n,e){return we(n,"POST","/v1/accounts:delete",e)}async function Ks(n,e){return we(n,"POST","/v1/accounts:lookup",e)}function ui(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function vp(n,e=!1){let t=oe(n),r=await t.getIdToken(e),i=yu(r);L(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:ui(Kc(i.auth_time)),issuedAtTime:ui(Kc(i.iat)),expirationTime:ui(Kc(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function Kc(n){return Number(n)*1e3}function yu(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Fs("JWT malformed, contained fewer than 3 sections"),null;try{let i=Ps(t);return i?JSON.parse(i):(Fs("Failed to decode base64 JWT payload"),null)}catch(i){return Fs("Caught error parsing JWT payload as JSON",i?.toString()),null}}function ep(n){let e=yu(n);return L(e,"internal-error"),L(typeof e.exp<"u","internal-error"),L(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function di(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Le&&lE(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function lE({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Zc=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}};var fi=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ui(this.lastLoginAt),this.creationTime=ui(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};async function Ws(n){let e=n.auth,t=await n.getIdToken(),r=await di(n,Ks(e,{idToken:t}));L(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let s=i.providerUserInfo?.length?Ap(i.providerUserInfo):[],o=hE(n.providerData,s),c=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!o?.length,h=c?u:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new fi(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function mo(n){let e=oe(n);await Ws(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function hE(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Ap(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function dE(n,e){let t=await Ep(n,{},async()=>{let r=Hn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=await wp(n,i,"/v1/token",`key=${s}`),c=await n._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:c,body:r};return n.emulatorConfig&&Pt(n.emulatorConfig.host)&&(u.credentials="include"),Gs.fetch()(o,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function fE(n,e){return we(n,"POST","/v2/accounts:revokeToken",le(n,e))}var li=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){L(e.idToken,"internal-error"),L(typeof e.idToken<"u","internal-error"),L(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ep(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){L(e.length!==0,"internal-error");let t=ep(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(L(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:i,expiresIn:s}=await dE(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&(L(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(L(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(L(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return nt("not implemented")}};function Vt(n,e){L(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Ot=class n{constructor({uid:e,auth:t,stsTokenManager:r,...i}){this.providerId="firebase",this.proactiveRefresh=new Zc(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new fi(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await di(this,this.stsTokenManager.getToken(this.auth,e));return L(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return vp(this,e)}reload(){return mo(this)}_assign(e){this!==e&&(L(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){L(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ws(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(De(this.auth.app))return Promise.reject(dt(this.auth));let e=await this.getIdToken();return await di(this,uE(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,o=t.photoURL??void 0,c=t.tenantId??void 0,u=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:_,isAnonymous:R,providerData:k,stsTokenManager:V}=t;L(m&&V,e,"internal-error");let N=li.fromJSON(this.name,V);L(typeof m=="string",e,"internal-error"),Vt(r,e.name),Vt(i,e.name),L(typeof _=="boolean",e,"internal-error"),L(typeof R=="boolean",e,"internal-error"),Vt(s,e.name),Vt(o,e.name),Vt(c,e.name),Vt(u,e.name),Vt(h,e.name),Vt(f,e.name);let j=new n({uid:m,auth:e,email:i,emailVerified:_,displayName:r,isAnonymous:R,photoURL:o,phoneNumber:s,tenantId:c,stsTokenManager:N,createdAt:h,lastLoginAt:f});return k&&Array.isArray(k)&&(j.providerData=k.map(q=>({...q}))),u&&(j._redirectEventId=u),j}static async _fromIdTokenResponse(e,t,r=!1){let i=new li;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Ws(s),s}static async _fromGetAccountInfoResponse(e,t,r){let i=t.users[0];L(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Ap(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,c=new li;c.updateFromIdToken(r);let u=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new fi(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u}};var tp=new Map;function ht(n){ft(n instanceof Function,"Expected a class definition");let e=tp.get(n);return e?(ft(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,tp.set(n,e),e)}var Hs=class{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}};Hs.type="NONE";var eu=Hs;function Us(n,e,t){return`firebase:${n}:${e}:${t}`}var Qs=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=Us(this.userKey,i.apiKey,s),this.fullPersistenceKey=Us("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=await Ks(this.auth,{idToken:e}).catch(()=>{});return t?Ot._fromGetAccountInfoResponse(this.auth,t,e):null}return Ot._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new n(ht(eu),e,r);let i=(await Promise.all(t.map(async h=>{if(await h._isAvailable())return h}))).filter(h=>h),s=i[0]||ht(eu),o=Us(r,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=await h._get(o);if(f){let m;if(typeof f=="string"){let _=await Ks(e,{idToken:f}).catch(()=>{});if(!_)break;m=await Ot._fromGetAccountInfoResponse(e,_,f)}else m=Ot._fromJSON(e,f);h!==s&&(c=m),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,e,r):(s=u[0],c&&await s._set(o,c.toJSON()),await Promise.all(t.map(async h=>{if(h!==s)try{await h._remove(o)}catch{}})),new n(s,e,r))}};function np(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Pp(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(bp(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Np(e))return"Blackberry";if(kp(e))return"Webos";if(Sp(e))return"Safari";if((e.includes("chrome/")||Rp(e))&&!e.includes("edge/"))return"Chrome";if(Cp(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function bp(n=ue()){return/firefox\//i.test(n)}function Sp(n=ue()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Rp(n=ue()){return/crios\//i.test(n)}function Pp(n=ue()){return/iemobile/i.test(n)}function Cp(n=ue()){return/android/i.test(n)}function Np(n=ue()){return/blackberry/i.test(n)}function kp(n=ue()){return/webos/i.test(n)}function Iu(n=ue()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function pE(n=ue()){return Iu(n)&&!!window.navigator?.standalone}function mE(){return Of()&&document.documentMode===10}function Dp(n=ue()){return Iu(n)||Cp(n)||kp(n)||Np(n)||/windows phone/i.test(n)||Pp(n)}function Vp(n,e=[]){let t;switch(n){case"Browser":t=np(ue());break;case"Worker":t=`${np(ue())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Dt}/${r}`}var tu=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}};async function gE(n,e={}){return we(n,"GET","/v2/passwordPolicy",le(n,e))}var _E=6,nu=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??_E,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var ru=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Js(this),this.idTokenSubscription=new Js(this),this.beforeStateQueue=new tu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=yp,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ht(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Qs.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await Ks(this,{idToken:e}),r=await Ot._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(De(this.app)){let s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let s=this.redirectUser?._redirectEventId,o=r?._redirectEventId,c=await this.tryRedirectSignIn(e);(!s||s===o)&&c?.user&&(r=c.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(s){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return L(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ws(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iE()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(De(this.app))return Promise.reject(dt(this));let t=e?oe(e):null;return t&&L(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&L(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return De(this.app)?Promise.reject(dt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return De(this.app)?Promise.reject(dt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ht(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=await gE(this),t=new nu(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ut("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await fE(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&ht(e)||this._popupRedirectResolver;L(t,this,"argument-error"),this.redirectPersistenceManager=await Qs.create(this,[ht(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(L(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return L(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Vp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(De(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&tE(`Error while retrieving App Check token: ${e.error}`),e?.token}};function pt(n){return oe(n)}var Js=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Mf(t=>this.observer=t)}get next(){return L(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var go={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function yE(n){go=n}function Op(n){return go.loadJS(n)}function IE(){return go.recaptchaEnterpriseScript}function EE(){return go.gapiScript}function xp(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var iu=class{constructor(){this.enterprise=new su}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}},su=class{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}};var wE="recaptcha-enterprise",hi="NO_RECAPTCHA",Ys=class{constructor(e){this.type=wE,this.auth=pt(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(o,c)=>{Tp(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let h=new $s(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{c(u)})})}function i(s,o,c){let u=window.grecaptcha;Zf(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(hi)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new iu().execute("siteKey",{action:"verify"}):new Promise((s,o)=>{r(this.auth).then(c=>{if(!t&&Zf(window.grecaptcha))i(c,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=IE();u.length!==0&&(u+=c),Op(u).then(()=>{i(c,s,o)}).catch(h=>{o(h)})}}).catch(c=>{o(c)})})}};async function ai(n,e,t,r=!1,i=!1){let s=new Ys(n),o;if(i)o=hi;else try{o=await s.verify(t)}catch{o=await s.verify(t,!0)}let c={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){let u=c.phoneEnrollmentInfo.phoneNumber,h=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:h,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){let u=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return r?Object.assign(c,{captchaResp:o}):Object.assign(c,{captchaResponse:o}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function Yn(n,e,t,r,i){if(i==="EMAIL_PASSWORD_PROVIDER")if(n._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let s=await ai(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let o=await ai(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(s)});else if(i==="PHONE_PROVIDER")if(n._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let s=await ai(n,e,t);return r(n,s).catch(async o=>{if(n._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&(o.code==="auth/missing-recaptcha-token"||o.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);let c=await ai(n,e,t,!1,!0);return r(n,c)}return Promise.reject(o)})}else{let s=await ai(n,e,t,!1,!0);return r(n,s)}else return Promise.reject(i+" provider is not supported.")}async function TE(n){let e=pt(n),t=await Tp(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new $s(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new Ys(e).verify()}function Lp(n,e){let t=oi(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(et(s,e??{}))return i;We(i,"already-initialized")}return t.initialize({options:e})}function vE(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(ht);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Mp(n,e,t){let r=pt(n);L(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=Fp(e),{host:o,port:c}=AE(e),u=c===null?"":`:${c}`,h={url:`${s}//${o}${u}/`},f=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){L(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),L(et(h,r.config.emulator)&&et(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=h,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Pt(o)?(Ns(`${s}//${o}${u}`),ks("Auth",!0)):i||bE()}function Fp(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function AE(n){let e=Fp(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:rp(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:rp(o)}}}function rp(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function bE(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var fn=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return nt("not implemented")}_getIdTokenResponse(e){return nt("not implemented")}_linkToIdToken(e,t){return nt("not implemented")}_getReauthenticationResolver(e){return nt("not implemented")}};async function SE(n,e){return we(n,"POST","/v1/accounts:signUp",e)}async function RE(n,e){return xt(n,"POST","/v1/accounts:signInWithPassword",le(n,e))}async function PE(n,e){return we(n,"POST","/v1/accounts:sendOobCode",le(n,e))}async function CE(n,e){return PE(n,e)}async function NE(n,e){return xt(n,"POST","/v1/accounts:signInWithEmailLink",le(n,e))}async function kE(n,e){return xt(n,"POST","/v1/accounts:signInWithEmailLink",le(n,e))}var pi=class n extends fn{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yn(e,t,"signInWithPassword",RE,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return NE(e,{email:this._email,oobCode:this._password});default:We(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yn(e,r,"signUpPassword",SE,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return kE(e,{idToken:t,email:this._email,oobCode:this._password});default:We(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};async function Xn(n,e){return xt(n,"POST","/v1/accounts:signInWithIdp",le(n,e))}var DE="http://localhost",pn=class n extends fn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):We("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,...s}=t;if(!r||!i)return null;let o=new n(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return Xn(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,Xn(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Xn(e,t)}buildRequest(){let e={requestUri:DE,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Hn(t)}return e}};async function ip(n,e){return we(n,"POST","/v1/accounts:sendVerificationCode",le(n,e))}async function VE(n,e){return xt(n,"POST","/v1/accounts:signInWithPhoneNumber",le(n,e))}async function OE(n,e){let t=await xt(n,"POST","/v1/accounts:signInWithPhoneNumber",le(n,e));if(t.temporaryProof)throw ci(n,"account-exists-with-different-credential",t);return t}var xE={USER_NOT_FOUND:"user-not-found"};async function LE(n,e){let t={...e,operation:"REAUTH"};return xt(n,"POST","/v1/accounts:signInWithPhoneNumber",le(n,t),xE)}var mi=class n extends fn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return VE(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return OE(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return LE(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s}=e;return!r&&!t&&!i&&!s?null:new n({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s})}};function ME(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function FE(n){let e=Qn(Jn(n)).link,t=e?Qn(Jn(e)).deep_link_id:null,r=Qn(Jn(n)).deep_link_id;return(r?Qn(Jn(r)).link:null)||r||t||e||n}var Xs=class n{constructor(e){let t=Qn(Jn(e)),r=t.apiKey??null,i=t.oobCode??null,s=ME(t.mode??null);L(r&&i&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t=FE(e);try{return new n(t)}catch{return null}}};var mn=class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(e,t){return pi._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=Xs.parseLink(t);return L(r,"argument-error"),pi._fromEmailAndCode(e,r.code,r.tenantId)}};mn.PROVIDER_ID="password";mn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";mn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";var Zs=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var gn=class extends Zs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var gi=class n extends gn{constructor(){super("facebook.com")}static credential(e){return pn._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return n.credential(e.oauthAccessToken)}catch{return null}}};gi.FACEBOOK_SIGN_IN_METHOD="facebook.com";gi.PROVIDER_ID="facebook.com";var _i=class n extends gn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return pn._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return n.credential(t,r)}catch{return null}}};_i.GOOGLE_SIGN_IN_METHOD="google.com";_i.PROVIDER_ID="google.com";var yi=class n extends gn{constructor(){super("github.com")}static credential(e){return pn._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return n.credential(e.oauthAccessToken)}catch{return null}}};yi.GITHUB_SIGN_IN_METHOD="github.com";yi.PROVIDER_ID="github.com";var Ii=class n extends gn{constructor(){super("twitter.com")}static credential(e,t){return pn._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return n.credential(t,r)}catch{return null}}};Ii.TWITTER_SIGN_IN_METHOD="twitter.com";Ii.PROVIDER_ID="twitter.com";async function UE(n,e){return xt(n,"POST","/v1/accounts:signUp",le(n,e))}var Zn=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){let s=await Ot._fromIdTokenResponse(e,r,i),o=sp(r);return new n({user:s,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);let i=sp(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})}};function sp(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var ou=class n extends Le{constructor(e,t,r,i){super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function Up(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?ou._fromErrorAndOperation(n,s,e,r):s})}async function BE(n,e,t=!1){let r=await di(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Zn._forOperation(n,"link",r)}async function qE(n,e,t=!1){let{auth:r}=n;if(De(r.app))return Promise.reject(dt(r));let i="reauthenticate";try{let s=await di(n,Up(r,i,e,n),t);L(s.idToken,r,"internal-error");let o=yu(s.idToken);L(o,r,"internal-error");let{sub:c}=o;return L(n.uid===c,r,"user-mismatch"),Zn._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&We(r,"user-mismatch"),s}}async function Bp(n,e,t=!1){if(De(n.app))return Promise.reject(dt(n));let r="signIn",i=await Up(n,r,e),s=await Zn._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function qp(n,e){return Bp(pt(n),e)}function jE(n,e,t){L(t.url?.length>0,n,"invalid-continue-uri"),L(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),L(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(L(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(L(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}async function jp(n){let e=pt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Eu(n,e,t){if(De(n.app))return Promise.reject(dt(n));let r=pt(n),o=await Yn(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",UE,"EMAIL_PASSWORD_PROVIDER").catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&jp(n),u}),c=await Zn._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(c.user),c}function wu(n,e,t){return De(n.app)?Promise.reject(dt(n)):qp(oe(n),mn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&jp(n),r})}async function _o(n,e){let t=oe(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&jE(t.auth,i,e);let{email:s}=await CE(t.auth,i);s!==n.email&&await n.reload()}function Tu(n,e){return oe(n).setPersistence(e)}function yo(n,e,t,r){return oe(n).onIdTokenChanged(e,t,r)}function zp(n,e,t){return oe(n).beforeAuthStateChanged(e,t)}function vu(n,e,t,r){return oe(n).onAuthStateChanged(e,t,r)}function Au(n){return oe(n).signOut()}function op(n,e){return we(n,"POST","/v2/accounts/mfaEnrollment:start",le(n,e))}function zE(n,e){return we(n,"POST","/v2/accounts/mfaEnrollment:finalize",le(n,e))}function GE(n,e){return we(n,"POST","/v2/accounts/mfaEnrollment:start",le(n,e))}function $E(n,e){return we(n,"POST","/v2/accounts/mfaEnrollment:finalize",le(n,e))}var eo="__sak";var to=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(eo,"1"),this.storage.removeItem(eo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var KE=1e3,WE=10,no=class extends to{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Dp(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,c,u)=>{this.notifyListeners(o,u)});return}let r=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);mE()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,WE):i()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},KE)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}};no.type="LOCAL";var Gp=no;var HE=1e3;function Wc(n){let e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return document.cookie.match(t)?.[1]??null}function Hc(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}var au=class{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;let t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;let t=Hc(e);return window.cookieStore?(await window.cookieStore.get(t))?.value:Wc(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;let r=Hc(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;let r=Hc(e);if(window.cookieStore){let c=(h=>{let f=h.changed.find(_=>_.name===r);f&&t(f.value),h.deleted.find(_=>_.name===r)&&t(null)}),u=()=>window.cookieStore.removeEventListener("change",c);return this.listenerUnsubscribes.set(t,u),window.cookieStore.addEventListener("change",c)}let i=Wc(r),s=setInterval(()=>{let c=Wc(r);c!==i&&(t(c),i=c)},HE),o=()=>clearInterval(s);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){let r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}};au.type="COOKIE";var ro=class extends to{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}};ro.type="SESSION";var bu=ro;function QE(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}var io=class n{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;let r=new n(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let t=e,{eventId:r,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!o?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});let c=Array.from(o).map(async h=>h(t.origin,s)),u=await QE(c);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}};io.receivers=[];function Su(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var cu=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let h=Su("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(m){let _=m;if(_.data.eventId===h)switch(_.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(_.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}};function it(){return window}function JE(n){it().location.href=n}function $p(){return typeof it().WorkerGlobalScope<"u"&&typeof it().importScripts=="function"}async function YE(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function XE(){return navigator?.serviceWorker?.controller||null}function ZE(){return $p()?self:null}var Kp="firebaseLocalStorageDb",ew=1,so="firebaseLocalStorage",Wp="fbase_key",_n=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Io(n,e){return n.transaction([so],e?"readwrite":"readonly").objectStore(so)}function tw(){let n=indexedDB.deleteDatabase(Kp);return new _n(n).toPromise()}function uu(){let n=indexedDB.open(Kp,ew);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(so,{keyPath:Wp})}catch(i){t(i)}}),n.addEventListener("success",async()=>{let r=n.result;r.objectStoreNames.contains(so)?e(r):(r.close(),await tw(),e(await uu()))})})}async function ap(n,e,t){let r=Io(n,!0).put({[Wp]:e,value:t});return new _n(r).toPromise()}async function nw(n,e){let t=Io(n,!1).get(e),r=await new _n(t).toPromise();return r===void 0?null:r.value}function cp(n,e){let t=Io(n,!0).delete(e);return new _n(t).toPromise()}var rw=800,iw=3,oo=class{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await uu(),this.db)}async _withRetries(e){let t=0;for(;;)try{let r=await this._openDb();return await e(r)}catch(r){if(t++>iw)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return $p()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=io._getInstance(ZE()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await YE(),!this.activeServiceWorker)return;this.sender=new cu(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||XE()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await uu();return await ap(e,eo,"1"),await cp(e,eo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>ap(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(r=>nw(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>cp(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(i=>{let s=Io(i,!1).getAll();return new _n(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];let t=[],r=new Set;if(e.length!==0)for(let{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(let i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),rw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}};oo.type="LOCAL";var Eo=oo;function up(n,e){return we(n,"POST","/v2/accounts/mfaSignIn:start",le(n,e))}function sw(n,e){return we(n,"POST","/v2/accounts/mfaSignIn:finalize",le(n,e))}function ow(n,e){return we(n,"POST","/v2/accounts/mfaSignIn:finalize",le(n,e))}var ob=xp("rcb"),ab=new dn(3e4,6e4);var Bs="recaptcha";async function aw(n,e,t){if(!n._getRecaptchaConfig())try{await TE(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(typeof e=="string"?r={phoneNumber:e}:r=e,"session"in r){let i=r.session;if("phoneNumber"in r){L(i.type==="enroll",n,"internal-error");let s={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Yn(n,s,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===hi){L(t?.type===Bs,h,"argument-error");let m=await Qc(h,f,t);return op(h,m)}return op(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{L(i.type==="signin",n,"internal-error");let s=r.multiFactorHint?.uid||r.multiFactorUid;L(s,n,"missing-multi-factor-info");let o={mfaPendingCredential:i.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Yn(n,o,"mfaSmsSignIn",async(f,m)=>{if(m.phoneSignInInfo.captchaResponse===hi){L(t?.type===Bs,f,"argument-error");let _=await Qc(f,m,t);return up(f,_)}return up(f,m)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{let i={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Yn(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===hi){L(t?.type===Bs,u,"argument-error");let f=await Qc(u,h,t);return ip(u,f)}return ip(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t?._reset()}}async function Qc(n,e,t){L(t.type===Bs,n,"argument-error");let r=await t.verify();L(typeof r=="string",n,"argument-error");let i={...e};if("phoneEnrollmentInfo"in i){let s=i.phoneEnrollmentInfo.phoneNumber,o=i.phoneEnrollmentInfo.captchaResponse,c=i.phoneEnrollmentInfo.clientType,u=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:s,recaptchaToken:r,captchaResponse:o,clientType:c,recaptchaVersion:u}}),i}else if("phoneSignInInfo"in i){let s=i.phoneSignInInfo.captchaResponse,o=i.phoneSignInInfo.clientType,c=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:s,clientType:o,recaptchaVersion:c}}),i}else return Object.assign(i,{recaptchaToken:r}),i}var Ei=class n{constructor(e){this.providerId=n.PROVIDER_ID,this.auth=pt(e)}verifyPhoneNumber(e,t){return aw(this.auth,e,oe(t))}static credential(e,t){return mi._fromVerification(e,t)}static credentialFromResult(e){let t=e;return n.credentialFromTaggedObject(t)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?mi._fromTokenResponse(t,r):null}};Ei.PROVIDER_ID="phone";Ei.PHONE_SIGN_IN_METHOD="phone";function cw(n,e){return e?ht(e):(L(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var wi=class extends fn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Xn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Xn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Xn(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function uw(n){return Bp(n.auth,new wi(n),n.bypassAuthState)}function lw(n){let{auth:e,user:t}=n;return L(t,e,"internal-error"),qE(t,new wi(n),n.bypassAuthState)}async function hw(n){let{auth:e,user:t}=n;return L(t,e,"internal-error"),BE(t,new wi(n),n.bypassAuthState)}var ao=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(h){this.reject(h)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return uw;case"linkViaPopup":case"linkViaRedirect":return hw;case"reauthViaPopup":case"reauthViaRedirect":return lw;default:We(this.auth,"internal-error")}}resolve(e){ft(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ft(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var dw=new dn(2e3,1e4);var lu=class n extends ao{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return L(e,this.auth,"internal-error"),e}async onExecution(){ft(this.filter.length===1,"Popup operations only handle one event");let e=Su();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(rt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(rt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(rt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,dw.get())};e()}};lu.currentPopupAction=null;var fw="pendingRedirect",qs=new Map,hu=class extends ao{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=qs.get(this.auth._key());if(!e){try{let r=await pw(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}qs.set(this.auth._key(),e)}return this.bypassAuthState||qs.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}};async function pw(n,e){let t=_w(e),r=gw(n);if(!await r._isAvailable())return!1;let i=await r._get(t)==="true";return await r._remove(t),i}function mw(n,e){qs.set(n._key(),e)}function gw(n){return ht(n._redirectPersistence)}function _w(n){return Us(fw,n.config.apiKey,n.name)}async function yw(n,e,t=!1){if(De(n.app))return Promise.reject(dt(n));let r=pt(n),i=cw(r,e),o=await new hu(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}var Iw=600*1e3,du=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Ew(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Hp(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(rt(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Iw&&this.cachedEventUids.clear(),this.cachedEventUids.has(lp(e))}saveEventToCache(e){this.cachedEventUids.add(lp(e)),this.lastProcessedEventTime=Date.now()}};function lp(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Hp({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function Ew(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Hp(n);default:return!1}}async function ww(n,e={}){return we(n,"GET","/v1/projects",e)}var Tw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,vw=/^https?/;async function Aw(n){if(n.config.emulator)return;let{authorizedDomains:e}=await ww(n);for(let t of e)try{if(bw(t))return}catch{}We(n,"unauthorized-domain")}function bw(n){let e=Yc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!vw.test(t))return!1;if(Tw.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var Sw=new dn(3e4,6e4);function hp(){let n=it().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Rw(n){return new Promise((e,t)=>{function r(){hp(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{hp(),t(rt(n,"network-request-failed"))},timeout:Sw.get()})}if(it().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(it().gapi?.load)r();else{let i=xp("iframefcb");return it()[i]=()=>{gapi.load?r():t(rt(n,"network-request-failed"))},Op(`${EE()}?onload=${i}`).catch(s=>t(s))}}).catch(e=>{throw js=null,e})}var js=null;function Pw(n){return js=js||Rw(n),js}var Cw=new dn(5e3,15e3),Nw="__/auth/iframe",kw="emulator/auth/iframe",Dw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Vw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ow(n){let e=n.config;L(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?_u(e,kw):`https://${n.config.authDomain}/${Nw}`,r={apiKey:e.apiKey,appName:n.name,v:Dt},i=Vw.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Hn(r).slice(1)}`}async function xw(n){let e=await Pw(n),t=it().gapi;return L(t,n,"internal-error"),e.open({where:document.body,url:Ow(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Dw,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});let o=rt(n,"network-request-failed"),c=it().setTimeout(()=>{s(o)},Cw.get());function u(){it().clearTimeout(c),i(r)}r.ping(u).then(u,()=>{s(o)})}))}var Lw={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Mw=500,Fw=600,Uw="_blank",Bw="http://localhost",co=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function qw(n,e,t,r=Mw,i=Fw){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",u={...Lw,width:r.toString(),height:i.toString(),top:s,left:o},h=ue().toLowerCase();t&&(c=Rp(h)?Uw:t),bp(h)&&(e=e||Bw,u.scrollbars="yes");let f=Object.entries(u).reduce((_,[R,k])=>`${_}${R}=${k},`,"");if(pE(h)&&c!=="_self")return jw(e||"",c),new co(null);let m=window.open(e||"",c,f);L(m,n,"popup-blocked");try{m.focus()}catch{}return new co(m)}function jw(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var zw="__/auth/handler",Gw="emulator/auth/handler",$w=encodeURIComponent("fac");async function dp(n,e,t,r,i,s){L(n.config.authDomain,n,"auth-domain-config-required"),L(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Dt,eventId:i};if(e instanceof Zs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Lf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,m]of Object.entries(s||{}))o[f]=m}if(e instanceof gn){let f=e.getScopes().filter(m=>m!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=await n._getAppCheckToken(),h=u?`#${$w}=${encodeURIComponent(u)}`:"";return`${Kw(n)}?${Hn(c).slice(1)}${h}`}function Kw({config:n}){return n.emulator?_u(n,Gw):`https://${n.authDomain}/${zw}`}var Jc="webStorageSupport",fu=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=bu,this._completeRedirectFn=yw,this._overrideRedirectResult=mw}async _openPopup(e,t,r,i){ft(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");let s=await dp(e,t,r,Yc(),i);return qw(e,s,Su())}async _openRedirect(e,t,r,i){await this._originValidation(e);let s=await dp(e,t,r,Yc(),i);return JE(s),new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(ft(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await xw(e),r=new du(e);return t.register("authEvent",i=>(L(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Jc,{type:Jc},i=>{let s=i?.[0]?.[Jc];s!==void 0&&t(!!s),We(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Aw(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Dp()||Sp()||Iu()}},Qp=fu,uo=class{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return nt("unexpected MultiFactorSessionType")}}},pu=class n extends uo{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new n(e)}_finalizeEnroll(e,t,r){return zE(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return sw(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},lo=class{constructor(){}static assertion(e){return pu._fromCredential(e)}};lo.FACTOR_ID="phone";var ho=class{static assertionForEnrollment(e,t){return fo._fromSecret(e,t)}static assertionForSignIn(e,t){return fo._fromEnrollmentId(e,t)}static async generateSecret(e){let t=e;L(typeof t.user?.auth<"u","internal-error");let r=await GE(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return po._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}};ho.FACTOR_ID="totp";var fo=class n extends uo{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new n(t,void 0,e)}static _fromEnrollmentId(e,t){return new n(t,e)}async _finalizeEnroll(e,t,r){return L(typeof this.secret<"u",e,"argument-error"),$E(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){L(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");let r={verificationCode:this.otp};return ow(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}},po=class n{constructor(e,t,r,i,s,o,c){this.sessionInfo=o,this.auth=c,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=i,this.enrollmentCompletionDeadline=s}static _fromStartTotpMfaEnrollmentResponse(e,t){return new n(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){let r=!1;return(Ms(e)||Ms(t))&&(r=!0),r&&(Ms(e)&&(e=this.auth.currentUser?.email||"unknownuser"),Ms(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}};function Ms(n){return typeof n>"u"||n?.length===0}var fp="@firebase/auth",pp="1.11.1";var mu=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){L(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Ww(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Hw(n){kt(new qe("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=r.options;L(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let u={apiKey:o,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vp(n)},h=new ru(r,i,s,u);return vE(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),kt(new qe("auth-internal",e=>{let t=pt(e.getProvider("auth").getImmediate());return(r=>new mu(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ke(fp,pp,Ww(n)),Ke(fp,pp,"esm2020")}var Qw=300,Jw=Pc("authIdTokenMaxAge")||Qw,mp=null,Yw=n=>async e=>{let t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Jw)return;let i=t?.token;mp!==i&&(mp=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Ru(n=Ls()){let e=oi(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Lp(n,{popupRedirectResolver:Qp,persistence:[Eo,Gp,bu]}),r=Pc("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(r,location.origin);if(location.origin===s.origin){let o=Yw(s.toString());zp(t,o,()=>o(t.currentUser)),yo(t,c=>o(c))}}let i=Sc("auth");return i&&Mp(t,`http://${i}`),t}function Xw(){return document.getElementsByTagName("head")?.[0]??document}yE({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=rt("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",Xw().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Hw("Browser");var Jp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Yp={};var mt,Pu;(function(){var n;function e(E,g){function I(){}I.prototype=g.prototype,E.F=g.prototype,E.prototype=new I,E.prototype.constructor=E,E.D=function(T,w,A){for(var y=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)y[ke-2]=arguments[ke];return g.prototype[w].apply(T,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,g,I){I||(I=0);let T=Array(16);if(typeof g=="string")for(var w=0;w<16;++w)T[w]=g.charCodeAt(I++)|g.charCodeAt(I++)<<8|g.charCodeAt(I++)<<16|g.charCodeAt(I++)<<24;else for(w=0;w<16;++w)T[w]=g[I++]|g[I++]<<8|g[I++]<<16|g[I++]<<24;g=E.g[0],I=E.g[1],w=E.g[2];let A=E.g[3],y;y=g+(A^I&(w^A))+T[0]+3614090360&4294967295,g=I+(y<<7&4294967295|y>>>25),y=A+(w^g&(I^w))+T[1]+3905402710&4294967295,A=g+(y<<12&4294967295|y>>>20),y=w+(I^A&(g^I))+T[2]+606105819&4294967295,w=A+(y<<17&4294967295|y>>>15),y=I+(g^w&(A^g))+T[3]+3250441966&4294967295,I=w+(y<<22&4294967295|y>>>10),y=g+(A^I&(w^A))+T[4]+4118548399&4294967295,g=I+(y<<7&4294967295|y>>>25),y=A+(w^g&(I^w))+T[5]+1200080426&4294967295,A=g+(y<<12&4294967295|y>>>20),y=w+(I^A&(g^I))+T[6]+2821735955&4294967295,w=A+(y<<17&4294967295|y>>>15),y=I+(g^w&(A^g))+T[7]+4249261313&4294967295,I=w+(y<<22&4294967295|y>>>10),y=g+(A^I&(w^A))+T[8]+1770035416&4294967295,g=I+(y<<7&4294967295|y>>>25),y=A+(w^g&(I^w))+T[9]+2336552879&4294967295,A=g+(y<<12&4294967295|y>>>20),y=w+(I^A&(g^I))+T[10]+4294925233&4294967295,w=A+(y<<17&4294967295|y>>>15),y=I+(g^w&(A^g))+T[11]+2304563134&4294967295,I=w+(y<<22&4294967295|y>>>10),y=g+(A^I&(w^A))+T[12]+1804603682&4294967295,g=I+(y<<7&4294967295|y>>>25),y=A+(w^g&(I^w))+T[13]+4254626195&4294967295,A=g+(y<<12&4294967295|y>>>20),y=w+(I^A&(g^I))+T[14]+2792965006&4294967295,w=A+(y<<17&4294967295|y>>>15),y=I+(g^w&(A^g))+T[15]+1236535329&4294967295,I=w+(y<<22&4294967295|y>>>10),y=g+(w^A&(I^w))+T[1]+4129170786&4294967295,g=I+(y<<5&4294967295|y>>>27),y=A+(I^w&(g^I))+T[6]+3225465664&4294967295,A=g+(y<<9&4294967295|y>>>23),y=w+(g^I&(A^g))+T[11]+643717713&4294967295,w=A+(y<<14&4294967295|y>>>18),y=I+(A^g&(w^A))+T[0]+3921069994&4294967295,I=w+(y<<20&4294967295|y>>>12),y=g+(w^A&(I^w))+T[5]+3593408605&4294967295,g=I+(y<<5&4294967295|y>>>27),y=A+(I^w&(g^I))+T[10]+38016083&4294967295,A=g+(y<<9&4294967295|y>>>23),y=w+(g^I&(A^g))+T[15]+3634488961&4294967295,w=A+(y<<14&4294967295|y>>>18),y=I+(A^g&(w^A))+T[4]+3889429448&4294967295,I=w+(y<<20&4294967295|y>>>12),y=g+(w^A&(I^w))+T[9]+568446438&4294967295,g=I+(y<<5&4294967295|y>>>27),y=A+(I^w&(g^I))+T[14]+3275163606&4294967295,A=g+(y<<9&4294967295|y>>>23),y=w+(g^I&(A^g))+T[3]+4107603335&4294967295,w=A+(y<<14&4294967295|y>>>18),y=I+(A^g&(w^A))+T[8]+1163531501&4294967295,I=w+(y<<20&4294967295|y>>>12),y=g+(w^A&(I^w))+T[13]+2850285829&4294967295,g=I+(y<<5&4294967295|y>>>27),y=A+(I^w&(g^I))+T[2]+4243563512&4294967295,A=g+(y<<9&4294967295|y>>>23),y=w+(g^I&(A^g))+T[7]+1735328473&4294967295,w=A+(y<<14&4294967295|y>>>18),y=I+(A^g&(w^A))+T[12]+2368359562&4294967295,I=w+(y<<20&4294967295|y>>>12),y=g+(I^w^A)+T[5]+4294588738&4294967295,g=I+(y<<4&4294967295|y>>>28),y=A+(g^I^w)+T[8]+2272392833&4294967295,A=g+(y<<11&4294967295|y>>>21),y=w+(A^g^I)+T[11]+1839030562&4294967295,w=A+(y<<16&4294967295|y>>>16),y=I+(w^A^g)+T[14]+4259657740&4294967295,I=w+(y<<23&4294967295|y>>>9),y=g+(I^w^A)+T[1]+2763975236&4294967295,g=I+(y<<4&4294967295|y>>>28),y=A+(g^I^w)+T[4]+1272893353&4294967295,A=g+(y<<11&4294967295|y>>>21),y=w+(A^g^I)+T[7]+4139469664&4294967295,w=A+(y<<16&4294967295|y>>>16),y=I+(w^A^g)+T[10]+3200236656&4294967295,I=w+(y<<23&4294967295|y>>>9),y=g+(I^w^A)+T[13]+681279174&4294967295,g=I+(y<<4&4294967295|y>>>28),y=A+(g^I^w)+T[0]+3936430074&4294967295,A=g+(y<<11&4294967295|y>>>21),y=w+(A^g^I)+T[3]+3572445317&4294967295,w=A+(y<<16&4294967295|y>>>16),y=I+(w^A^g)+T[6]+76029189&4294967295,I=w+(y<<23&4294967295|y>>>9),y=g+(I^w^A)+T[9]+3654602809&4294967295,g=I+(y<<4&4294967295|y>>>28),y=A+(g^I^w)+T[12]+3873151461&4294967295,A=g+(y<<11&4294967295|y>>>21),y=w+(A^g^I)+T[15]+530742520&4294967295,w=A+(y<<16&4294967295|y>>>16),y=I+(w^A^g)+T[2]+3299628645&4294967295,I=w+(y<<23&4294967295|y>>>9),y=g+(w^(I|~A))+T[0]+4096336452&4294967295,g=I+(y<<6&4294967295|y>>>26),y=A+(I^(g|~w))+T[7]+1126891415&4294967295,A=g+(y<<10&4294967295|y>>>22),y=w+(g^(A|~I))+T[14]+2878612391&4294967295,w=A+(y<<15&4294967295|y>>>17),y=I+(A^(w|~g))+T[5]+4237533241&4294967295,I=w+(y<<21&4294967295|y>>>11),y=g+(w^(I|~A))+T[12]+1700485571&4294967295,g=I+(y<<6&4294967295|y>>>26),y=A+(I^(g|~w))+T[3]+2399980690&4294967295,A=g+(y<<10&4294967295|y>>>22),y=w+(g^(A|~I))+T[10]+4293915773&4294967295,w=A+(y<<15&4294967295|y>>>17),y=I+(A^(w|~g))+T[1]+2240044497&4294967295,I=w+(y<<21&4294967295|y>>>11),y=g+(w^(I|~A))+T[8]+1873313359&4294967295,g=I+(y<<6&4294967295|y>>>26),y=A+(I^(g|~w))+T[15]+4264355552&4294967295,A=g+(y<<10&4294967295|y>>>22),y=w+(g^(A|~I))+T[6]+2734768916&4294967295,w=A+(y<<15&4294967295|y>>>17),y=I+(A^(w|~g))+T[13]+1309151649&4294967295,I=w+(y<<21&4294967295|y>>>11),y=g+(w^(I|~A))+T[4]+4149444226&4294967295,g=I+(y<<6&4294967295|y>>>26),y=A+(I^(g|~w))+T[11]+3174756917&4294967295,A=g+(y<<10&4294967295|y>>>22),y=w+(g^(A|~I))+T[2]+718787259&4294967295,w=A+(y<<15&4294967295|y>>>17),y=I+(A^(w|~g))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(w+(y<<21&4294967295|y>>>11))&4294967295,E.g[2]=E.g[2]+w&4294967295,E.g[3]=E.g[3]+A&4294967295}r.prototype.v=function(E,g){g===void 0&&(g=E.length);let I=g-this.blockSize,T=this.C,w=this.h,A=0;for(;A<g;){if(w==0)for(;A<=I;)i(this,E,A),A+=this.blockSize;if(typeof E=="string"){for(;A<g;)if(T[w++]=E.charCodeAt(A++),w==this.blockSize){i(this,T),w=0;break}}else for(;A<g;)if(T[w++]=E[A++],w==this.blockSize){i(this,T),w=0;break}}this.h=w,this.o+=g},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var I=E.length-8;I<E.length;++I)E[I]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,I=0;I<4;++I)for(let T=0;T<32;T+=8)E[g++]=this.g[I]>>>T&255;return E};function s(E,g){var I=c;return Object.prototype.hasOwnProperty.call(I,E)?I[E]:I[E]=g(E)}function o(E,g){this.h=g;let I=[],T=!0;for(let w=E.length-1;w>=0;w--){let A=E[w]|0;T&&A==g||(I[w]=A,T=!1)}this.g=I}var c={};function u(E){return-128<=E&&E<128?s(E,function(g){return new o([g|0],g<0?-1:0)}):new o([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return m;if(E<0)return N(h(-E));let g=[],I=1;for(let T=0;E>=I;T++)g[T]=E/I|0,I*=4294967296;return new o(g,0)}function f(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return N(f(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');let I=h(Math.pow(g,8)),T=m;for(let A=0;A<E.length;A+=8){var w=Math.min(8,E.length-A);let y=parseInt(E.substring(A,A+w),g);w<8?(w=h(Math.pow(g,w)),T=T.j(w).add(h(y))):(T=T.j(I),T=T.add(h(y)))}return T}var m=u(0),_=u(1),R=u(16777216);n=o.prototype,n.m=function(){if(V(this))return-N(this).m();let E=0,g=1;for(let I=0;I<this.g.length;I++){let T=this.i(I);E+=(T>=0?T:4294967296+T)*g,g*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(k(this))return"0";if(V(this))return"-"+N(this).toString(E);let g=h(Math.pow(E,6));var I=this;let T="";for(;;){let w=ee(I,g).g;I=j(I,w.j(g));let A=((I.g.length>0?I.g[0]:I.h)>>>0).toString(E);if(I=w,k(I))return A+T;for(;A.length<6;)A="0"+A;T=A+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function k(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function V(E){return E.h==-1}n.l=function(E){return E=j(this,E),V(E)?-1:k(E)?0:1};function N(E){let g=E.g.length,I=[];for(let T=0;T<g;T++)I[T]=~E.g[T];return new o(I,~E.h).add(_)}n.abs=function(){return V(this)?N(this):this},n.add=function(E){let g=Math.max(this.g.length,E.g.length),I=[],T=0;for(let w=0;w<=g;w++){let A=T+(this.i(w)&65535)+(E.i(w)&65535),y=(A>>>16)+(this.i(w)>>>16)+(E.i(w)>>>16);T=y>>>16,A&=65535,y&=65535,I[w]=y<<16|A}return new o(I,I[I.length-1]&-2147483648?-1:0)};function j(E,g){return E.add(N(g))}n.j=function(E){if(k(this)||k(E))return m;if(V(this))return V(E)?N(this).j(N(E)):N(N(this).j(E));if(V(E))return N(this.j(N(E)));if(this.l(R)<0&&E.l(R)<0)return h(this.m()*E.m());let g=this.g.length+E.g.length,I=[];for(var T=0;T<2*g;T++)I[T]=0;for(T=0;T<this.g.length;T++)for(let w=0;w<E.g.length;w++){let A=this.i(T)>>>16,y=this.i(T)&65535,ke=E.i(w)>>>16,wt=E.i(w)&65535;I[2*T+2*w]+=y*wt,q(I,2*T+2*w),I[2*T+2*w+1]+=A*wt,q(I,2*T+2*w+1),I[2*T+2*w+1]+=y*ke,q(I,2*T+2*w+1),I[2*T+2*w+2]+=A*ke,q(I,2*T+2*w+2)}for(E=0;E<g;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=g;E<2*g;E++)I[E]=0;return new o(I,0)};function q(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function U(E,g){this.g=E,this.h=g}function ee(E,g){if(k(g))throw Error("division by zero");if(k(E))return new U(m,m);if(V(E))return g=ee(N(E),g),new U(N(g.g),N(g.h));if(V(g))return g=ee(E,N(g)),new U(N(g.g),g.h);if(E.g.length>30){if(V(E)||V(g))throw Error("slowDivide_ only works with positive integers.");for(var I=_,T=g;T.l(E)<=0;)I=Y(I),T=Y(T);var w=Q(I,1),A=Q(T,1);for(T=Q(T,2),I=Q(I,2);!k(T);){var y=A.add(T);y.l(E)<=0&&(w=w.add(I),A=y),T=Q(T,1),I=Q(I,1)}return g=j(E,w.j(g)),new U(w,g)}for(w=m;E.l(g)>=0;){for(I=Math.max(1,Math.floor(E.m()/g.m())),T=Math.ceil(Math.log(I)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),A=h(I),y=A.j(g);V(y)||y.l(E)>0;)I-=T,A=h(I),y=A.j(g);k(A)&&(A=_),w=w.add(A),E=j(E,y)}return new U(w,E)}n.B=function(E){return ee(this,E).h},n.and=function(E){let g=Math.max(this.g.length,E.g.length),I=[];for(let T=0;T<g;T++)I[T]=this.i(T)&E.i(T);return new o(I,this.h&E.h)},n.or=function(E){let g=Math.max(this.g.length,E.g.length),I=[];for(let T=0;T<g;T++)I[T]=this.i(T)|E.i(T);return new o(I,this.h|E.h)},n.xor=function(E){let g=Math.max(this.g.length,E.g.length),I=[];for(let T=0;T<g;T++)I[T]=this.i(T)^E.i(T);return new o(I,this.h^E.h)};function Y(E){let g=E.g.length+1,I=[];for(let T=0;T<g;T++)I[T]=E.i(T)<<1|E.i(T-1)>>>31;return new o(I,E.h)}function Q(E,g){let I=g>>5;g%=32;let T=E.g.length-I,w=[];for(let A=0;A<T;A++)w[A]=g>0?E.i(A+I)>>>g|E.i(A+I+1)<<32-g:E.i(A+I);return new o(w,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Pu=Yp.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,mt=Yp.Integer=o}).apply(typeof Jp<"u"?Jp:typeof self<"u"?self:typeof window<"u"?window:{});var wo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},gt={};var Cu,Zw,er,Nu,Ti,To,ku,Du,Vu;(function(){var n,e=Object.defineProperty;function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof wo=="object"&&wo];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function i(a,l){if(l)e:{var d=r;a=a.split(".");for(var p=0;p<a.length-1;p++){var v=a[p];if(!(v in d))break e;d=d[v]}a=a[a.length-1],p=d[a],l=l(p),l!=p&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}i("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(a){return a||function(l){var d=[],p;for(p in l)Object.prototype.hasOwnProperty.call(l,p)&&d.push([p,l[p]]);return d}});var s=s||{},o=this||self;function c(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function u(a,l,d){return a.call.apply(a.bind,arguments)}function h(a,l,d){return h=u,h.apply(null,arguments)}function f(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),a.apply(this,p)}}function m(a,l){function d(){}d.prototype=l.prototype,a.Z=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Ob=function(p,v,S){for(var O=Array(arguments.length-2),$=2;$<arguments.length;$++)O[$-2]=arguments[$];return l.prototype[v].apply(p,O)}}var _=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function R(a){let l=a.length;if(l>0){let d=Array(l);for(let p=0;p<l;p++)d[p]=a[p];return d}return[]}function k(a,l){for(let p=1;p<arguments.length;p++){let v=arguments[p];var d=typeof v;if(d=d!="object"?d:v?Array.isArray(v)?"array":d:"null",d=="array"||d=="object"&&typeof v.length=="number"){d=a.length||0;let S=v.length||0;a.length=d+S;for(let O=0;O<S;O++)a[d+O]=v[O]}else a.push(v)}}class V{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function N(a){o.setTimeout(()=>{throw a},0)}function j(){var a=E;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class q{constructor(){this.h=this.g=null}add(l,d){let p=U.get();p.set(l,d),this.h?this.h.next=p:this.g=p,this.h=p}}var U=new V(()=>new ee,a=>a.reset());class ee{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Y,Q=!1,E=new q,g=()=>{let a=Promise.resolve(void 0);Y=()=>{a.then(I)}};function I(){for(var a;a=j();){try{a.h.call(a.g)}catch(d){N(d)}var l=U;l.j(a),l.h<100&&(l.h++,a.next=l.g,l.g=a)}Q=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function w(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}w.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};o.addEventListener("test",d,l),o.removeEventListener("test",d,l)}catch{}return a})();function y(a){return/^[\s\xa0]*$/.test(a)}function ke(a,l){w.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,l)}m(ke,w),ke.prototype.init=function(a,l){let d=this.type=a.type,p=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget,l||(d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement)),this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&ke.Z.h.call(this)},ke.prototype.h=function(){ke.Z.h.call(this);let a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var wt="closure_listenable_"+(Math.random()*1e6|0),iy=0;function sy(a,l,d,p,v){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!p,this.ha=v,this.key=++iy,this.da=this.fa=!1}function hs(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ds(a,l,d){for(let p in a)l.call(d,a[p],p,a)}function oy(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function Id(a){let l={};for(let d in a)l[d]=a[d];return l}let Ed="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function wd(a,l){let d,p;for(let v=1;v<arguments.length;v++){p=arguments[v];for(d in p)a[d]=p[d];for(let S=0;S<Ed.length;S++)d=Ed[S],Object.prototype.hasOwnProperty.call(p,d)&&(a[d]=p[d])}}function fs(a){this.src=a,this.g={},this.h=0}fs.prototype.add=function(a,l,d,p,v){let S=a.toString();a=this.g[S],a||(a=this.g[S]=[],this.h++);let O=Xa(a,l,p,v);return O>-1?(l=a[O],d||(l.fa=!1)):(l=new sy(l,this.src,S,!!p,v),l.fa=d,a.push(l)),l};function Ya(a,l){let d=l.type;if(d in a.g){var p=a.g[d],v=Array.prototype.indexOf.call(p,l,void 0),S;(S=v>=0)&&Array.prototype.splice.call(p,v,1),S&&(hs(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Xa(a,l,d,p){for(let v=0;v<a.length;++v){let S=a[v];if(!S.da&&S.listener==l&&S.capture==!!d&&S.ha==p)return v}return-1}var Za="closure_lm_"+(Math.random()*1e6|0),ec={};function Td(a,l,d,p,v){if(p&&p.once)return Ad(a,l,d,p,v);if(Array.isArray(l)){for(let S=0;S<l.length;S++)Td(a,l[S],d,p,v);return null}return d=ic(d),a&&a[wt]?a.J(l,d,c(p)?!!p.capture:!!p,v):vd(a,l,d,!1,p,v)}function vd(a,l,d,p,v,S){if(!l)throw Error("Invalid event type");let O=c(v)?!!v.capture:!!v,$=nc(a);if($||(a[Za]=$=new fs(a)),d=$.add(l,d,p,O,S),d.proxy)return d;if(p=ay(),d.proxy=p,p.src=a,p.listener=d,a.addEventListener)A||(v=O),v===void 0&&(v=!1),a.addEventListener(l.toString(),p,v);else if(a.attachEvent)a.attachEvent(Sd(l.toString()),p);else if(a.addListener&&a.removeListener)a.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function ay(){function a(d){return l.call(a.src,a.listener,d)}let l=cy;return a}function Ad(a,l,d,p,v){if(Array.isArray(l)){for(let S=0;S<l.length;S++)Ad(a,l[S],d,p,v);return null}return d=ic(d),a&&a[wt]?a.K(l,d,c(p)?!!p.capture:!!p,v):vd(a,l,d,!0,p,v)}function bd(a,l,d,p,v){if(Array.isArray(l))for(var S=0;S<l.length;S++)bd(a,l[S],d,p,v);else p=c(p)?!!p.capture:!!p,d=ic(d),a&&a[wt]?(a=a.i,S=String(l).toString(),S in a.g&&(l=a.g[S],d=Xa(l,d,p,v),d>-1&&(hs(l[d]),Array.prototype.splice.call(l,d,1),l.length==0&&(delete a.g[S],a.h--)))):a&&(a=nc(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Xa(l,d,p,v)),(d=a>-1?l[a]:null)&&tc(d))}function tc(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[wt])Ya(l.i,a);else{var d=a.type,p=a.proxy;l.removeEventListener?l.removeEventListener(d,p,a.capture):l.detachEvent?l.detachEvent(Sd(d),p):l.addListener&&l.removeListener&&l.removeListener(p),(d=nc(l))?(Ya(d,a),d.h==0&&(d.src=null,l[Za]=null)):hs(a)}}}function Sd(a){return a in ec?ec[a]:ec[a]="on"+a}function cy(a,l){if(a.da)a=!0;else{l=new ke(l,this);let d=a.listener,p=a.ha||a.src;a.fa&&tc(a),a=d.call(p,l)}return a}function nc(a){return a=a[Za],a instanceof fs?a:null}var rc="__closure_events_fn_"+(Math.random()*1e9>>>0);function ic(a){return typeof a=="function"?a:(a[rc]||(a[rc]=function(l){return a.handleEvent(l)}),a[rc])}function ve(){T.call(this),this.i=new fs(this),this.M=this,this.G=null}m(ve,T),ve.prototype[wt]=!0,ve.prototype.removeEventListener=function(a,l,d,p){bd(this,a,l,d,p)};function Se(a,l){var d,p=a.G;if(p)for(d=[];p;p=p.G)d.push(p);if(a=a.M,p=l.type||l,typeof l=="string")l=new w(l,a);else if(l instanceof w)l.target=l.target||a;else{var v=l;l=new w(p,a),wd(l,v)}v=!0;let S,O;if(d)for(O=d.length-1;O>=0;O--)S=l.g=d[O],v=ps(S,p,!0,l)&&v;if(S=l.g=a,v=ps(S,p,!0,l)&&v,v=ps(S,p,!1,l)&&v,d)for(O=0;O<d.length;O++)S=l.g=d[O],v=ps(S,p,!1,l)&&v}ve.prototype.N=function(){if(ve.Z.N.call(this),this.i){var a=this.i;for(let l in a.g){let d=a.g[l];for(let p=0;p<d.length;p++)hs(d[p]);delete a.g[l],a.h--}}this.G=null},ve.prototype.J=function(a,l,d,p){return this.i.add(String(a),l,!1,d,p)},ve.prototype.K=function(a,l,d,p){return this.i.add(String(a),l,!0,d,p)};function ps(a,l,d,p){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();let v=!0;for(let S=0;S<l.length;++S){let O=l[S];if(O&&!O.da&&O.capture==d){let $=O.listener,pe=O.ha||O.src;O.fa&&Ya(a.i,O),v=$.call(pe,p)!==!1&&v}}return v&&!p.defaultPrevented}function uy(a,l){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=h(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:o.setTimeout(a,l||0)}function Rd(a){a.g=uy(()=>{a.g=null,a.i&&(a.i=!1,Rd(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class ly extends T{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Rd(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qr(a){T.call(this),this.h=a,this.g={}}m(qr,T);var Pd=[];function Cd(a){ds(a.g,function(l,d){this.g.hasOwnProperty(d)&&tc(l)},a),a.g={}}qr.prototype.N=function(){qr.Z.N.call(this),Cd(this)},qr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var sc=o.JSON.stringify,hy=o.JSON.parse,dy=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function Nd(){}function kd(){}var jr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function oc(){w.call(this,"d")}m(oc,w);function ac(){w.call(this,"c")}m(ac,w);var on={},Dd=null;function ms(){return Dd=Dd||new ve}on.Ia="serverreachability";function Vd(a){w.call(this,on.Ia,a)}m(Vd,w);function zr(a){let l=ms();Se(l,new Vd(l))}on.STAT_EVENT="statevent";function Od(a,l){w.call(this,on.STAT_EVENT,a),this.stat=l}m(Od,w);function Re(a){let l=ms();Se(l,new Od(l,a))}on.Ja="timingevent";function xd(a,l){w.call(this,on.Ja,a),this.size=l}m(xd,w);function Gr(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},l)}function $r(){this.g=!0}$r.prototype.ua=function(){this.g=!1};function fy(a,l,d,p,v,S){a.info(function(){if(a.g)if(S){var O="",$=S.split("&");for(let ne=0;ne<$.length;ne++){var pe=$[ne].split("=");if(pe.length>1){let Ie=pe[0];pe=pe[1];let Ze=Ie.split("_");O=Ze.length>=2&&Ze[1]=="type"?O+(Ie+"="+pe+"&"):O+(Ie+"=redacted&")}}}else O=null;else O=S;return"XMLHTTP REQ ("+p+") [attempt "+v+"]: "+l+`
`+d+`
`+O})}function py(a,l,d,p,v,S,O){a.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+v+"]: "+l+`
`+d+`
`+S+" "+O})}function $n(a,l,d,p){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+gy(a,d)+(p?" "+p:"")})}function my(a,l){a.info(function(){return"TIMEOUT: "+l})}$r.prototype.info=function(){};function gy(a,l){if(!a.g)return l;if(!l)return null;try{let S=JSON.parse(l);if(S){for(a=0;a<S.length;a++)if(Array.isArray(S[a])){var d=S[a];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var v=p[0];if(v!="noop"&&v!="stop"&&v!="close")for(let O=1;O<p.length;O++)p[O]=""}}}}return sc(S)}catch{return l}}var gs={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ld={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Md;function cc(){}m(cc,Nd),cc.prototype.g=function(){return new XMLHttpRequest},Md=new cc;function Kr(a){return encodeURIComponent(String(a))}function _y(a){var l=1;a=a.split(":");let d=[];for(;l>0&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function Tt(a,l,d,p){this.j=a,this.i=l,this.l=d,this.S=p||1,this.V=new qr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Fd}function Fd(){this.i=null,this.g="",this.h=!1}var Ud={},uc={};function lc(a,l,d){a.M=1,a.A=ys(Xe(l)),a.u=d,a.R=!0,Bd(a,null)}function Bd(a,l){a.F=Date.now(),_s(a),a.B=Xe(a.A);var d=a.B,p=a.S;Array.isArray(p)||(p=[String(p)]),Zd(d.i,"t",p),a.C=0,d=a.j.L,a.h=new Fd,a.g=yf(a.j,d?l:null,!a.u),a.P>0&&(a.O=new ly(h(a.Y,a,a.g),a.P)),l=a.V,d=a.g,p=a.ba;var v="readystatechange";Array.isArray(v)||(v&&(Pd[0]=v.toString()),v=Pd);for(let S=0;S<v.length;S++){let O=Td(d,v[S],p||l.handleEvent,!1,l.h||l);if(!O)break;l.g[O.key]=O}l=a.J?Id(a.J):{},a.u?(a.v||(a.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,l)):(a.v="GET",a.g.ea(a.B,a.v,null,l)),zr(),fy(a.i,a.v,a.B,a.l,a.S,a.u)}Tt.prototype.ba=function(a){a=a.target;let l=this.O;l&&bt(a)==3?l.j():this.Y(a)},Tt.prototype.Y=function(a){try{if(a==this.g)e:{let $=bt(this.g),pe=this.g.ya(),ne=this.g.ca();if(!($<3)&&($!=3||this.g&&(this.h.h||this.g.la()||af(this.g)))){this.K||$!=4||pe==7||(pe==8||ne<=0?zr(3):zr(2)),hc(this);var l=this.g.ca();this.X=l;var d=yy(this);if(this.o=l==200,py(this.i,this.v,this.B,this.l,this.S,$,l),this.o){if(this.U&&!this.L){t:{if(this.g){var p,v=this.g;if((p=v.g?v.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(p)){var S=p;break t}}S=null}if(a=S)$n(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,dc(this,a);else{this.o=!1,this.m=3,Re(12),an(this),Wr(this);break e}}if(this.R){a=!0;let Ie;for(;!this.K&&this.C<d.length;)if(Ie=Iy(this,d),Ie==uc){$==4&&(this.m=4,Re(14),a=!1),$n(this.i,this.l,null,"[Incomplete Response]");break}else if(Ie==Ud){this.m=4,Re(15),$n(this.i,this.l,d,"[Invalid Chunk]"),a=!1;break}else $n(this.i,this.l,Ie,null),dc(this,Ie);if(qd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),$!=4||d.length!=0||this.h.h||(this.m=1,Re(16),a=!1),this.o=this.o&&a,!a)$n(this.i,this.l,d,"[Invalid Chunked Response]"),an(this),Wr(this);else if(d.length>0&&!this.W){this.W=!0;var O=this.j;O.g==this&&O.aa&&!O.P&&(O.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Ic(O),O.P=!0,Re(11))}}else $n(this.i,this.l,d,null),dc(this,d);$==4&&an(this),this.o&&!this.K&&($==4?pf(this.j,this):(this.o=!1,_s(this)))}else Vy(this.g),l==400&&d.indexOf("Unknown SID")>0?(this.m=3,Re(12)):(this.m=0,Re(13)),an(this),Wr(this)}}}catch{}finally{}};function yy(a){if(!qd(a))return a.g.la();let l=af(a.g);if(l==="")return"";let d="",p=l.length,v=bt(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return an(a),Wr(a),"";a.h.i=new o.TextDecoder}for(let S=0;S<p;S++)a.h.h=!0,d+=a.h.i.decode(l[S],{stream:!(v&&S==p-1)});return l.length=0,a.h.g+=d,a.C=0,a.h.g}function qd(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function Iy(a,l){var d=a.C,p=l.indexOf(`
`,d);return p==-1?uc:(d=Number(l.substring(d,p)),isNaN(d)?Ud:(p+=1,p+d>l.length?uc:(l=l.slice(p,p+d),a.C=p+d,l)))}Tt.prototype.cancel=function(){this.K=!0,an(this)};function _s(a){a.T=Date.now()+a.H,jd(a,a.H)}function jd(a,l){if(a.D!=null)throw Error("WatchDog timer not null");a.D=Gr(h(a.aa,a),l)}function hc(a){a.D&&(o.clearTimeout(a.D),a.D=null)}Tt.prototype.aa=function(){this.D=null;let a=Date.now();a-this.T>=0?(my(this.i,this.B),this.M!=2&&(zr(),Re(17)),an(this),this.m=2,Wr(this)):jd(this,this.T-a)};function Wr(a){a.j.I==0||a.K||pf(a.j,a)}function an(a){hc(a);var l=a.O;l&&typeof l.dispose=="function"&&l.dispose(),a.O=null,Cd(a.V),a.g&&(l=a.g,a.g=null,l.abort(),l.dispose())}function dc(a,l){try{var d=a.j;if(d.I!=0&&(d.g==a||fc(d.h,a))){if(!a.L&&fc(d.h,a)&&d.I==3){try{var p=d.Ba.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var v=p;if(v[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<a.F)As(d),Ts(d);else break e;yc(d),Re(18)}}else d.xa=v[1],0<d.xa-d.K&&v[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=Gr(h(d.Va,d),6e3));$d(d.h)<=1&&d.ta&&(d.ta=void 0)}else un(d,11)}else if((a.L||d.g==a)&&As(d),!y(l))for(v=d.Ba.g.parse(l),l=0;l<v.length;l++){let ne=v[l],Ie=ne[0];if(!(Ie<=d.K))if(d.K=Ie,ne=ne[1],d.I==2)if(ne[0]=="c"){d.M=ne[1],d.ba=ne[2];let Ze=ne[3];Ze!=null&&(d.ka=Ze,d.j.info("VER="+d.ka));let ln=ne[4];ln!=null&&(d.za=ln,d.j.info("SVER="+d.za));let St=ne[5];St!=null&&typeof St=="number"&&St>0&&(p=1.5*St,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;let Rt=a.g;if(Rt){let Ss=Rt.g?Rt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ss){var S=p.h;S.g||Ss.indexOf("spdy")==-1&&Ss.indexOf("quic")==-1&&Ss.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(pc(S,S.h),S.h=null))}if(p.G){let Ec=Rt.g?Rt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ec&&(p.wa=Ec,re(p.J,p.G,Ec))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-a.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var O=a;if(p.na=_f(p,p.L?p.ba:null,p.W),O.L){Kd(p.h,O);var $=O,pe=p.O;pe&&($.H=pe),$.D&&(hc($),_s($)),p.g=O}else df(p);d.i.length>0&&vs(d)}else ne[0]!="stop"&&ne[0]!="close"||un(d,7);else d.I==3&&(ne[0]=="stop"||ne[0]=="close"?ne[0]=="stop"?un(d,7):_c(d):ne[0]!="noop"&&d.l&&d.l.qa(ne),d.A=0)}}zr(4)}catch{}}var Ey=class{constructor(a,l){this.g=a,this.map=l}};function zd(a){this.l=a||10,o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Gd(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function $d(a){return a.h?1:a.g?a.g.size:0}function fc(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function pc(a,l){a.g?a.g.add(l):a.h=l}function Kd(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}zd.prototype.cancel=function(){if(this.i=Wd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Wd(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.G);return l}return R(a.i)}var Hd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function wy(a,l){if(a){a=a.split("&");for(let d=0;d<a.length;d++){let p=a[d].indexOf("="),v,S=null;p>=0?(v=a[d].substring(0,p),S=a[d].substring(p+1)):v=a[d],l(v,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function vt(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;a instanceof vt?(this.l=a.l,Hr(this,a.j),this.o=a.o,this.g=a.g,Qr(this,a.u),this.h=a.h,mc(this,ef(a.i)),this.m=a.m):a&&(l=String(a).match(Hd))?(this.l=!1,Hr(this,l[1]||"",!0),this.o=Jr(l[2]||""),this.g=Jr(l[3]||"",!0),Qr(this,l[4]),this.h=Jr(l[5]||"",!0),mc(this,l[6]||"",!0),this.m=Jr(l[7]||"")):(this.l=!1,this.i=new Xr(null,this.l))}vt.prototype.toString=function(){let a=[];var l=this.j;l&&a.push(Yr(l,Qd,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(Yr(l,Qd,!0),"@"),a.push(Kr(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&a.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Yr(d,d.charAt(0)=="/"?Ay:vy,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Yr(d,Sy)),a.join("")},vt.prototype.resolve=function(a){let l=Xe(this),d=!!a.j;d?Hr(l,a.j):d=!!a.o,d?l.o=a.o:d=!!a.g,d?l.g=a.g:d=a.u!=null;var p=a.h;if(d)Qr(l,a.u);else if(d=!!a.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var v=l.h.lastIndexOf("/");v!=-1&&(p=l.h.slice(0,v+1)+p)}if(v=p,v==".."||v==".")p="";else if(v.indexOf("./")!=-1||v.indexOf("/.")!=-1){p=v.lastIndexOf("/",0)==0,v=v.split("/");let S=[];for(let O=0;O<v.length;){let $=v[O++];$=="."?p&&O==v.length&&S.push(""):$==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),p&&O==v.length&&S.push("")):(S.push($),p=!0)}p=S.join("/")}else p=v}return d?l.h=p:d=a.i.toString()!=="",d?mc(l,ef(a.i)):d=!!a.m,d&&(l.m=a.m),l};function Xe(a){return new vt(a)}function Hr(a,l,d){a.j=d?Jr(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function Qr(a,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);a.u=l}else a.u=null}function mc(a,l,d){l instanceof Xr?(a.i=l,Ry(a.i,a.l)):(d||(l=Yr(l,by)),a.i=new Xr(l,a.l))}function re(a,l,d){a.i.set(l,d)}function ys(a){return re(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function Jr(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Yr(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,Ty),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Ty(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Qd=/[#\/\?@]/g,vy=/[#\?:]/g,Ay=/[#\?]/g,by=/[#\?@]/g,Sy=/#/g;function Xr(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function cn(a){a.g||(a.g=new Map,a.h=0,a.i&&wy(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=Xr.prototype,n.add=function(a,l){cn(this),this.i=null,a=Kn(this,a);let d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function Jd(a,l){cn(a),l=Kn(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function Yd(a,l){return cn(a),l=Kn(a,l),a.g.has(l)}n.forEach=function(a,l){cn(this),this.g.forEach(function(d,p){d.forEach(function(v){a.call(l,v,p,this)},this)},this)};function Xd(a,l){cn(a);let d=[];if(typeof l=="string")Yd(a,l)&&(d=d.concat(a.g.get(Kn(a,l))));else for(a=Array.from(a.g.values()),l=0;l<a.length;l++)d=d.concat(a[l]);return d}n.set=function(a,l){return cn(this),this.i=null,a=Kn(this,a),Yd(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},n.get=function(a,l){return a?(a=Xd(this,a),a.length>0?String(a[0]):l):l};function Zd(a,l,d){Jd(a,l),d.length>0&&(a.i=null,a.g.set(Kn(a,l),R(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(let p=0;p<l.length;p++){var d=l[p];let v=Kr(d);d=Xd(this,d);for(let S=0;S<d.length;S++){let O=v;d[S]!==""&&(O+="="+Kr(d[S])),a.push(O)}}return this.i=a.join("&")};function ef(a){let l=new Xr;return l.i=a.i,a.g&&(l.g=new Map(a.g),l.h=a.h),l}function Kn(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function Ry(a,l){l&&!a.j&&(cn(a),a.i=null,a.g.forEach(function(d,p){let v=p.toLowerCase();p!=v&&(Jd(this,p),Zd(this,v,d))},a)),a.j=l}function Py(a,l){let d=new $r;if(o.Image){let p=new Image;p.onload=f(At,d,"TestLoadImage: loaded",!0,l,p),p.onerror=f(At,d,"TestLoadImage: error",!1,l,p),p.onabort=f(At,d,"TestLoadImage: abort",!1,l,p),p.ontimeout=f(At,d,"TestLoadImage: timeout",!1,l,p),o.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=a}else l(!1)}function Cy(a,l){let d=new $r,p=new AbortController,v=setTimeout(()=>{p.abort(),At(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:p.signal}).then(S=>{clearTimeout(v),S.ok?At(d,"TestPingServer: ok",!0,l):At(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(v),At(d,"TestPingServer: error",!1,l)})}function At(a,l,d,p,v){try{v&&(v.onload=null,v.onerror=null,v.onabort=null,v.ontimeout=null),p(d)}catch{}}function Ny(){this.g=new dy}function Is(a){this.i=a.Sb||null,this.h=a.ab||!1}m(Is,Nd),Is.prototype.g=function(){return new Es(this.i,this.h)};function Es(a,l){ve.call(this),this.H=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Es,ve),n=Es.prototype,n.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=l,this.readyState=1,ei(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(l.body=a),(this.H||o).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Zr(this)),this.readyState=0},n.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ei(this)),this.g&&(this.readyState=3,ei(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tf(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function tf(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}n.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?Zr(this):ei(this),this.readyState==3&&tf(this)}},n.Oa=function(a){this.g&&(this.response=this.responseText=a,Zr(this))},n.Na=function(a){this.g&&(this.response=a,Zr(this))},n.ga=function(){this.g&&Zr(this)};function Zr(a){a.readyState=4,a.l=null,a.j=null,a.B=null,ei(a)}n.setRequestHeader=function(a,l){this.A.append(a,l)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function ei(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Es.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function nf(a){let l="";return ds(a,function(d,p){l+=p,l+=":",l+=d,l+=`\r
`}),l}function gc(a,l,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=nf(d),typeof a=="string"?d!=null&&Kr(d):re(a,l,d))}function ce(a){ve.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(ce,ve);var ky=/^https?$/i,Dy=["POST","PUT"];n=ce.prototype,n.Fa=function(a){this.H=a},n.ea=function(a,l,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Md.g(),this.g.onreadystatechange=_(h(this.Ca,this));try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(S){rf(this,S);return}if(a=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var v in p)d.set(v,p[v]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let S of p.keys())d.set(S,p.get(S));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),v=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(Dy,l,void 0)>=0)||p||v||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,O]of d)this.g.setRequestHeader(S,O);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(S){rf(this,S)}};function rf(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.o=5,sf(a),ws(a)}function sf(a){a.A||(a.A=!0,Se(a,"complete"),Se(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,Se(this,"complete"),Se(this,"abort"),ws(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ws(this,!0)),ce.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?of(this):this.Xa())},n.Xa=function(){of(this)};function of(a){if(a.h&&typeof s<"u"){if(a.v&&bt(a)==4)setTimeout(a.Ca.bind(a),0);else if(Se(a,"readystatechange"),bt(a)==4){a.h=!1;try{let S=a.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var p;if(p=S===0){let O=String(a.D).match(Hd)[1]||null;!O&&o.self&&o.self.location&&(O=o.self.location.protocol.slice(0,-1)),p=!ky.test(O?O.toLowerCase():"")}d=p}if(d)Se(a,"complete"),Se(a,"success");else{a.o=6;try{var v=bt(a)>2?a.g.statusText:""}catch{v=""}a.l=v+" ["+a.ca()+"]",sf(a)}}finally{ws(a)}}}}function ws(a,l){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);let d=a.g;a.g=null,l||Se(a,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function bt(a){return a.g?a.g.readyState:0}n.ca=function(){try{return bt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),hy(l)}};function af(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Vy(a){let l={};a=(a.g&&bt(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<a.length;p++){if(y(a[p]))continue;var d=_y(a[p]);let v=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let S=l[v]||[];l[v]=S,S.push(d)}oy(l,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ti(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function cf(a){this.za=0,this.i=[],this.j=new $r,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ti("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ti("baseRetryDelayMs",5e3,a),this.Za=ti("retryDelaySeedMs",1e4,a),this.Ta=ti("forwardChannelMaxRetries",2,a),this.va=ti("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new zd(a&&a.concurrentRequestLimit),this.Ba=new Ny,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=cf.prototype,n.ka=8,n.I=1,n.connect=function(a,l,d,p){Re(0),this.W=a,this.H=l||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=_f(this,null,this.W),vs(this)};function _c(a){if(uf(a),a.I==3){var l=a.V++,d=Xe(a.J);if(re(d,"SID",a.M),re(d,"RID",l),re(d,"TYPE","terminate"),ni(a,d),l=new Tt(a,a.j,l),l.M=2,l.A=ys(Xe(d)),d=!1,o.navigator&&o.navigator.sendBeacon)try{d=o.navigator.sendBeacon(l.A.toString(),"")}catch{}!d&&o.Image&&(new Image().src=l.A,d=!0),d||(l.g=yf(l.j,null),l.g.ea(l.A)),l.F=Date.now(),_s(l)}gf(a)}function Ts(a){a.g&&(Ic(a),a.g.cancel(),a.g=null)}function uf(a){Ts(a),a.v&&(o.clearTimeout(a.v),a.v=null),As(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&o.clearTimeout(a.m),a.m=null)}function vs(a){if(!Gd(a.h)&&!a.m){a.m=!0;var l=a.Ea;Y||g(),Q||(Y(),Q=!0),E.add(l,a),a.D=0}}function Oy(a,l){return $d(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=l.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=Gr(h(a.Ea,a,l),mf(a,a.D)),a.D++,!0)}n.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;let v=new Tt(this,this.j,a),S=this.o;if(this.U&&(S?(S=Id(S),wd(S,this.U)):S=this.U),this.u!==null||this.R||(v.J=S,S=null),this.S)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(l+=p,l>4096){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=hf(this,v,l),d=Xe(this.J),re(d,"RID",a),re(d,"CVER",22),this.G&&re(d,"X-HTTP-Session-Id",this.G),ni(this,d),S&&(this.R?l="headers="+Kr(nf(S))+"&"+l:this.u&&gc(d,this.u,S)),pc(this.h,v),this.Ra&&re(d,"TYPE","init"),this.S?(re(d,"$req",l),re(d,"SID","null"),v.U=!0,lc(v,d,null)):lc(v,d,l),this.I=2}}else this.I==3&&(a?lf(this,a):this.i.length==0||Gd(this.h)||lf(this))};function lf(a,l){var d;l?d=l.l:d=a.V++;let p=Xe(a.J);re(p,"SID",a.M),re(p,"RID",d),re(p,"AID",a.K),ni(a,p),a.u&&a.o&&gc(p,a.u,a.o),d=new Tt(a,a.j,d,a.D+1),a.u===null&&(d.J=a.o),l&&(a.i=l.G.concat(a.i)),l=hf(a,d,1e3),d.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),pc(a.h,d),lc(d,p,l)}function ni(a,l){a.H&&ds(a.H,function(d,p){re(l,p,d)}),a.l&&ds({},function(d,p){re(l,p,d)})}function hf(a,l,d){d=Math.min(a.i.length,d);let p=a.l?h(a.l.Ka,a.l,a):null;e:{var v=a.i;let $=-1;for(;;){let pe=["count="+d];$==-1?d>0?($=v[0].g,pe.push("ofs="+$)):$=0:pe.push("ofs="+$);let ne=!0;for(let Ie=0;Ie<d;Ie++){var S=v[Ie].g;let Ze=v[Ie].map;if(S-=$,S<0)$=Math.max(0,v[Ie].g-100),ne=!1;else try{S="req"+S+"_"||"";try{var O=Ze instanceof Map?Ze:Object.entries(Ze);for(let[ln,St]of O){let Rt=St;c(St)&&(Rt=sc(St)),pe.push(S+ln+"="+encodeURIComponent(Rt))}}catch(ln){throw pe.push(S+"type="+encodeURIComponent("_badmap")),ln}}catch{p&&p(Ze)}}if(ne){O=pe.join("&");break e}}O=void 0}return a=a.i.splice(0,d),l.G=a,O}function df(a){if(!a.g&&!a.v){a.Y=1;var l=a.Da;Y||g(),Q||(Y(),Q=!0),E.add(l,a),a.A=0}}function yc(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=Gr(h(a.Da,a),mf(a,a.A)),a.A++,!0)}n.Da=function(){if(this.v=null,ff(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=Gr(h(this.Wa,this),a)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Re(10),Ts(this),ff(this))};function Ic(a){a.B!=null&&(o.clearTimeout(a.B),a.B=null)}function ff(a){a.g=new Tt(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var l=Xe(a.na);re(l,"RID","rpc"),re(l,"SID",a.M),re(l,"AID",a.K),re(l,"CI",a.F?"0":"1"),!a.F&&a.ia&&re(l,"TO",a.ia),re(l,"TYPE","xmlhttp"),ni(a,l),a.u&&a.o&&gc(l,a.u,a.o),a.O&&(a.g.H=a.O);var d=a.g;a=a.ba,d.M=1,d.A=ys(Xe(l)),d.u=null,d.R=!0,Bd(d,a)}n.Va=function(){this.C!=null&&(this.C=null,Ts(this),yc(this),Re(19))};function As(a){a.C!=null&&(o.clearTimeout(a.C),a.C=null)}function pf(a,l){var d=null;if(a.g==l){As(a),Ic(a),a.g=null;var p=2}else if(fc(a.h,l))d=l.G,Kd(a.h,l),p=1;else return;if(a.I!=0){if(l.o)if(p==1){d=l.u?l.u.length:0,l=Date.now()-l.F;var v=a.D;p=ms(),Se(p,new xd(p,d)),vs(a)}else df(a);else if(v=l.m,v==3||v==0&&l.X>0||!(p==1&&Oy(a,l)||p==2&&yc(a)))switch(d&&d.length>0&&(l=a.h,l.i=l.i.concat(d)),v){case 1:un(a,5);break;case 4:un(a,10);break;case 3:un(a,6);break;default:un(a,2)}}}function mf(a,l){let d=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(d*=2),d*l}function un(a,l){if(a.j.info("Error code "+l),l==2){var d=h(a.bb,a),p=a.Ua;let v=!p;p=new vt(p||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Hr(p,"https"),ys(p),v?Py(p.toString(),d):Cy(p.toString(),d)}else Re(2);a.I=0,a.l&&a.l.pa(l),gf(a),uf(a)}n.bb=function(a){a?(this.j.info("Successfully pinged google.com"),Re(2)):(this.j.info("Failed to ping google.com"),Re(1))};function gf(a){if(a.I=0,a.ja=[],a.l){let l=Wd(a.h);(l.length!=0||a.i.length!=0)&&(k(a.ja,l),k(a.ja,a.i),a.h.i.length=0,R(a.i),a.i.length=0),a.l.oa()}}function _f(a,l,d){var p=d instanceof vt?Xe(d):new vt(d);if(p.g!="")l&&(p.g=l+"."+p.g),Qr(p,p.u);else{var v=o.location;p=v.protocol,l=l?l+"."+v.hostname:v.hostname,v=+v.port;let S=new vt(null);p&&Hr(S,p),l&&(S.g=l),v&&Qr(S,v),d&&(S.h=d),p=S}return d=a.G,l=a.wa,d&&l&&re(p,d,l),re(p,"VER",a.ka),ni(a,p),p}function yf(a,l,d){if(l&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Aa&&!a.ma?new ce(new Is({ab:d})):new ce(a.ma),l.Fa(a.L),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function If(){}n=If.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function bs(){}bs.prototype.g=function(a,l){return new xe(a,l)};function xe(a,l){ve.call(this),this.g=new cf(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(a?a["X-WebChannel-Client-Profile"]=l.sa:a={"X-WebChannel-Client-Profile":l.sa}),this.g.U=a,(a=l&&l.Qb)&&!y(a)&&(this.g.u=a),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!y(l)&&(this.g.G=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new Wn(this)}m(xe,ve),xe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xe.prototype.close=function(){_c(this.g)},xe.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.v&&(d={},d.__data__=sc(a),a=d);l.i.push(new Ey(l.Ya++,a)),l.I==3&&vs(l)},xe.prototype.N=function(){this.g.l=null,delete this.j,_c(this.g),delete this.g,xe.Z.N.call(this)};function Ef(a){oc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}m(Ef,oc);function wf(){ac.call(this),this.status=1}m(wf,ac);function Wn(a){this.g=a}m(Wn,If),Wn.prototype.ra=function(){Se(this.g,"a")},Wn.prototype.qa=function(a){Se(this.g,new Ef(a))},Wn.prototype.pa=function(a){Se(this.g,new wf)},Wn.prototype.oa=function(){Se(this.g,"b")},bs.prototype.createWebChannel=bs.prototype.g,xe.prototype.send=xe.prototype.o,xe.prototype.open=xe.prototype.m,xe.prototype.close=xe.prototype.close,Vu=gt.createWebChannelTransport=function(){return new bs},Du=gt.getStatEventTarget=function(){return ms()},ku=gt.Event=on,To=gt.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},gs.NO_ERROR=0,gs.TIMEOUT=8,gs.HTTP_ERROR=6,Ti=gt.ErrorCode=gs,Ld.COMPLETE="complete",Nu=gt.EventType=Ld,kd.EventType=jr,jr.OPEN="a",jr.CLOSE="b",jr.ERROR="c",jr.MESSAGE="d",ve.prototype.listen=ve.prototype.J,er=gt.WebChannel=kd,Zw=gt.FetchXmlHttpFactory=Is,ce.prototype.listenOnce=ce.prototype.K,ce.prototype.getLastError=ce.prototype.Ha,ce.prototype.getLastErrorCode=ce.prototype.ya,ce.prototype.getStatus=ce.prototype.ca,ce.prototype.getResponseJson=ce.prototype.La,ce.prototype.getResponseText=ce.prototype.la,ce.prototype.send=ce.prototype.ea,ce.prototype.setWithCredentials=ce.prototype.Fa,Cu=gt.XhrIo=ce}).apply(typeof wo<"u"?wo:typeof self<"u"?self:typeof window<"u"?window:{});var Xp="@firebase/firestore",Zp="4.9.2";var me=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};me.UNAUTHENTICATED=new me(null),me.GOOGLE_CREDENTIALS=new me("google-credentials-uid"),me.FIRST_PARTY=new me("first-party-uid"),me.MOCK_USER=new me("mock-user");var Fr="12.3.0";var Vn=new Ct("@firebase/firestore");function ar(){return Vn.logLevel}function C(n,...e){if(Vn.logLevel<=W.DEBUG){let t=e.map(Mh);Vn.debug(`Firestore (${Fr}): ${n}`,...t)}}function Pe(n,...e){if(Vn.logLevel<=W.ERROR){let t=e.map(Mh);Vn.error(`Firestore (${Fr}): ${n}`,...t)}}function On(n,...e){if(Vn.logLevel<=W.WARN){let t=e.map(Mh);Vn.warn(`Firestore (${Fr}): ${n}`,...t)}}function Mh(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function M(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,lg(n,r,t)}function lg(n,e,t){let r=`FIRESTORE (${Fr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Pe(r),new Error(r)}function F(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||lg(e,i,r)}function G(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends Le{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var je=class{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}};var Lo=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},qu=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(me.UNAUTHENTICATED)))}shutdown(){}},ju=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}},zu=class{constructor(e){this.t=e,this.currentUser=me.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){F(this.o===void 0,42304);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new je;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new je,e.enqueueRetryable((()=>i(this.currentUser)))};let o=()=>{let u=s;e.enqueueRetryable((async()=>{await u.promise,await i(this.currentUser)}))},c=u=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((u=>c(u))),setTimeout((()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new je)}}),0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(F(typeof r.accessToken=="string",31837,{l:r}),new Lo(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return F(e===null||typeof e=="string",2055,{h:e}),new me(e)}},Gu=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=me.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},$u=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Gu(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(me.FIRST_PARTY)))}shutdown(){}invalidateToken(){}},Mo=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ku=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,De(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){F(this.o===void 0,3512);let r=s=>{s.error!=null&&C("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,C("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable((()=>r(s)))};let i=s=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((s=>i(s))),setTimeout((()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Mo(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(F(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Mo(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function eT(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Li=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=eT(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function z(n,e){return n<e?-1:n>e?1:0}function Wu(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),s=e.charAt(r);if(i!==s)return Ou(i)===Ou(s)?z(i,s):Ou(i)?1:-1}return z(n.length,e.length)}var tT=55296,nT=57343;function Ou(n){let e=n.charCodeAt(0);return e>=tT&&e<=nT}function _r(n,e,t){return n.length===e.length&&n.every(((r,i)=>t(r,e[i])))}function hg(n){return n+"\0"}var em="__name__",Fo=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&M(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return z(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Wu(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return mt.fromString(e.substring(4,e.length-2))}},X=class n extends Fo{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new D(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((i=>i.length>0)))}return new n(t)}static emptyPath(){return new n([])}},rT=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ge=class n extends Fo{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return rT.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===em}static keyField(){return new n([em])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new D(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new D(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new D(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(r+=c,i++):(s(),i++)}if(s(),o)throw new D(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var x=class n{constructor(e){this.path=e}static fromPath(e){return new n(X.fromString(e))}static fromName(e){return new n(X.fromString(e).popFirst(5))}static empty(){return new n(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new X(e.slice()))}};function dg(n,e,t){if(!t)throw new D(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function iT(n,e,t,r){if(e===!0&&r===!0)throw new D(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function tm(n){if(!x.isDocumentKey(n))throw new D(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function nm(n){if(x.isDocumentKey(n))throw new D(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function fg(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Fa(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M(12329,{type:typeof n})}function Qe(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Fa(n);throw new D(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function sT(n,e){if(e<=0)throw new D(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function fe(n,e){let t={typeString:n};return e&&(t.value=e),t}function rs(n,e){if(!fg(n))throw new D(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new D(P.INVALID_ARGUMENT,t);return!0}var rm=-62135596800,im=1e6,se=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*im);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<rm)throw new D(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/im}_compareTo(e){return this.seconds===e.seconds?z(this.nanoseconds,e.nanoseconds):z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(rs(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-rm;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};se._jsonSchemaVersion="firestore/timestamp/1.0",se._jsonSchema={type:fe("string",se._jsonSchemaVersion),seconds:fe("number"),nanoseconds:fe("number")};var B=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new se(0,0))}static max(){return new n(new se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Mi=-1,yr=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Hu(n){return n.fields.find((e=>e.kind===2))}function In(n){return n.fields.filter((e=>e.kind!==2))}yr.UNKNOWN_ID=-1;var fr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Fi=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Ge.min())}};function oT(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=B.fromTimestamp(r===1e9?new se(t+1,0):new se(t,r));return new Ge(i,x.empty(),e)}function pg(n){return new Ge(n.readTime,n.key,Mi)}var Ge=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(B.min(),x.empty(),Mi)}static max(){return new n(B.max(),x.empty(),Mi)}};function Fh(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=x.comparator(n.documentKey,e.documentKey),t!==0?t:z(n.largestBatchId,e.largestBatchId))}var mg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Uo=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}};async function jn(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==mg)throw n;C("LocalStore","Unexpectedly lost primary lease")}var b=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n(((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):n.reject(t)}static resolve(e){return new n(((t,r)=>{t(e)}))}static reject(e){return new n(((t,r)=>{r(e)}))}static waitFor(e){return new n(((t,r)=>{let i=0,s=0,o=!1;e.forEach((c=>{++i,c.next((()=>{++s,o&&s===i&&t()}),(u=>r(u)))})),o=!0,s===i&&t()}))}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next((i=>i?n.resolve(i):r()));return t}static forEach(e,t){let r=[];return e.forEach(((i,s)=>{r.push(t.call(this,i,s))})),this.waitFor(r)}static mapArray(e,t){return new n(((r,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next((f=>{o[h]=f,++c,c===s&&r(o)}),(f=>i(f)))}}))}static doWhile(e,t){return new n(((r,i)=>{let s=()=>{e()===!0?t().next((()=>{s()}),i):r()};s()}))}};var Me="SimpleDb",Bo=class n{static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Pn(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new je,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Pn(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{let i=Uh(r.target.error);this.S.reject(new Pn(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(C(Me,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Ju(t)}},Ir=class n{static delete(e){return C(Me,"Removing database:",e),wn(bc().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Ds())return!1;if(n.F())return!0;let e=ue(),t=n.M(e),r=0<t&&t<10,i=gg(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,n.M(ue())===12.2&&Pe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(C(Me,"Opening database:",this.name),this.db=await new Promise(((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Pn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new D(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new D(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Pn(e,o))},i.onupgradeneeded=s=>{C(Me,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.N.k(o,i.transaction,s.oldVersion,this.version).next((()=>{C(Me,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,i){let s=t==="readonly",o=0;for(;;){++o;try{this.db=await this.L(e);let c=Bo.open(this.db,e,s?"readonly":"readwrite",r),u=i(c).next((h=>(c.C(),h))).catch((h=>(c.abort(h),b.reject(h)))).toPromise();return u.catch((()=>{})),await c.D,u}catch(c){let u=c,h=u.name!=="FirebaseError"&&o<3;if(C(Me,"Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}};function gg(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Qu=class{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return wn(this.U.delete())}},Pn=class extends D{constructor(e,t){super(P.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function nn(n){return n.name==="IndexedDbTransactionError"}var Ju=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(C(Me,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(C(Me,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),wn(r)}add(e){return C(Me,"ADD",this.store.name,e,e),wn(this.store.add(e))}get(e){return wn(this.store.get(e)).next((t=>(t===void 0&&(t=null),C(Me,"GET",this.store.name,e,t),t)))}delete(e){return C(Me,"DELETE",this.store.name,e),wn(this.store.delete(e))}count(){return C(Me,"COUNT",this.store.name),wn(this.store.count())}J(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new b(((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}}))}{let s=this.cursor(r),o=[];return this.H(s,((c,u)=>{o.push(u)})).next((()=>o))}}Y(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new b(((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}}))}Z(e,t){C(Me,"DELETE ALL",this.store.name);let r=this.options(e,t);r.X=!1;let i=this.cursor(r);return this.H(i,((s,o,c)=>c.delete()))}ee(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.H(i,t)}te(e){let t=this.cursor({});return new b(((r,i)=>{t.onerror=s=>{let o=Uh(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next((c=>{c?o.continue():r()})):r()}}))}H(e,t){let r=[];return new b(((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new Qu(c),h=t(c.primaryKey,c.value,u);if(h instanceof b){let f=h.catch((m=>(u.done(),b.reject(m))));r.push(f)}u.isDone?i():u.G===null?c.continue():c.continue(u.G)}})).next((()=>b.waitFor(r)))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function wn(n){return new b(((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Uh(r.target.error);t(i)}}))}var sm=!1;function Uh(n){let e=Ir.M(ue());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sm||(sm=!0,setTimeout((()=>{throw r}),0)),r}}return n}var Ci="IndexBackfiller",Yu=class{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){C(Ci,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{let t=await this.ne.ie();C(Ci,`Documents written: ${t}`)}catch(t){nn(t)?C(Ci,"Ignoring IndexedDB error during index backfill: ",t):await jn(t)}await this.re(6e4)}))}},Xu=class{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.se(t,e)))}se(e,t){let r=new Set,i=t,s=!0;return b.doWhile((()=>s===!0&&i>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((o=>{if(o!==null&&!r.has(o))return C(Ci,`Processing collection: ${o}`),this.oe(e,o,i).next((c=>{i-=c,r.add(o)}));s=!1})))).next((()=>t-i))}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next((s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next((()=>this._e(i,s))).next((c=>(C(Ci,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c)))).next((()=>o.size))}))))}_e(e,t){let r=e;return t.changes.forEach(((i,s)=>{let o=pg(s);Fh(o,r)>0&&(r=o)})),new Ge(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Oe=class{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}};Oe.ce=-1;var Cn=-1;function Ua(n){return n==null}function Ui(n){return n===0&&1/n==-1/0}function aT(n){return typeof n=="number"&&Number.isInteger(n)&&!Ui(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var qo="";function be(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=om(e)),e=cT(n.get(t),e);return om(e)}function cT(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case qo:t+="";break;default:t+=s}}return t}function om(n){return n+qo+""}function st(n){let e=n.length;if(F(e>=2,64408,{path:n}),e===2)return F(n.charAt(0)===qo&&n.charAt(1)==="",56145,{path:n}),X.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(qo,s);switch((o<0||o>t)&&M(50515,{path:n}),n.charAt(o+1)){case"":let c=n.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:M(61167,{path:n})}s=o+2}return new X(r)}var En="remoteDocuments",is="owner",tr="owner",Bi="mutationQueues",uT="userId",He="mutations",am="batchId",bn="userMutationsIndex",cm=["userId","batchId"];function Po(n,e){return[n,be(e)]}function _g(n,e,t){return[n,be(e),t]}var lT={},Er="documentMutations",jo="remoteDocumentsV14",hT=["prefixPath","collectionGroup","readTime","documentId"],Co="documentKeyIndex",dT=["prefixPath","collectionGroup","documentId"],yg="collectionGroupIndex",fT=["collectionGroup","readTime","prefixPath","documentId"],qi="remoteDocumentGlobal",Zu="remoteDocumentGlobalKey",wr="targets",Ig="queryTargetsIndex",pT=["canonicalId","targetId"],Tr="targetDocuments",mT=["targetId","path"],Bh="documentTargetsIndex",gT=["path","targetId"],zo="targetGlobalKey",Nn="targetGlobal",ji="collectionParents",_T=["collectionId","parent"],vr="clientMetadata",yT="clientId",Ba="bundles",IT="bundleId",qa="namedQueries",ET="name",qh="indexConfiguration",wT="indexId",el="collectionGroupIndex",TT="collectionGroup",Ni="indexState",vT=["indexId","uid"],Eg="sequenceNumberIndex",AT=["uid","sequenceNumber"],ki="indexEntries",bT=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],wg="documentKeyIndex",ST=["indexId","uid","orderedDocumentKey"],ja="documentOverlays",RT=["userId","collectionPath","documentId"],tl="collectionPathOverlayIndex",PT=["userId","collectionPath","largestBatchId"],Tg="collectionGroupOverlayIndex",CT=["userId","collectionGroup","largestBatchId"],jh="globals",NT="name",vg=[Bi,He,Er,En,wr,is,Nn,Tr,vr,qi,ji,Ba,qa],kT=[...vg,ja],Ag=[Bi,He,Er,jo,wr,is,Nn,Tr,vr,qi,ji,Ba,qa,ja],bg=Ag,zh=[...bg,qh,Ni,ki],DT=zh,Sg=[...zh,jh],VT=Sg;var zi=class extends Uo{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}};function ye(n,e){let t=G(n);return Ir.O(t.le,e)}function um(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function rn(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Rg(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ae=class n{constructor(e,t){this.comparator=e,this.root=t||at.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,at.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,at.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){let e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new dr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new dr(this.root,e,this.comparator,!1)}getReverseIterator(){return new dr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new dr(this.root,e,this.comparator,!0)}},dr=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},at=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+(this.isRed()?0:1)}};at.EMPTY=null,at.RED=!0,at.BLACK=!1;at.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new at(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var te=class n{constructor(e){this.comparator=e,this.data=new ae(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Go(this.data.getIterator())}getIteratorFrom(e){return new Go(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach((t=>{e.push(t)})),e}toString(){let e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Go=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function nr(n){return n.hasNext()?n.getNext():void 0}var Fe=class n{constructor(e){this.fields=e,e.sort(ge.comparator)}static empty(){return new n([])}unionWith(e){let t=new te(ge.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _r(this.fields,e.fields,((t,r)=>t.isEqual(r)))}};var $o=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var _e=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new $o("Invalid base64 string: "+s):s}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};_e.EMPTY_BYTE_STRING=new _e("");var OT=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yt(n){if(F(!!n,39018),typeof n=="string"){let e=0,t=OT.exec(n);if(F(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ie(n.seconds),nanos:ie(n.nanos)}}function ie(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function It(n){return typeof n=="string"?_e.fromBase64String(n):_e.fromUint8Array(n)}var Pg="server_timestamp",Cg="__type__",Ng="__previous_value__",kg="__local_write_time__";function Gh(n){return(n?.mapValue?.fields||{})[Cg]?.stringValue===Pg}function za(n){let e=n.mapValue.fields[Ng];return Gh(e)?za(e):e}function Gi(n){let e=yt(n.mapValue.fields[kg].timestampValue);return new se(e.seconds,e.nanos)}var nl=class{constructor(e,t,r,i,s,o,c,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f}},Ko="(default)",Ar=class n{constructor(e,t){this.projectId=e,this.database=t||Ko}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Ko}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var $h="__type__",Dg="__max__",Bt={mapValue:{fields:{__type__:{stringValue:Dg}}}},Kh="__vector__",br="value",No={nullValue:"NULL_VALUE"};function $t(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Gh(n)?4:Vg(n)?9007199254740991:Ga(n)?10:11:M(28295,{value:n})}function ct(n,e){if(n===e)return!0;let t=$t(n);if(t!==$t(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Gi(n).isEqual(Gi(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=yt(i.timestampValue),c=yt(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return It(i.bytesValue).isEqual(It(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return ie(i.geoPointValue.latitude)===ie(s.geoPointValue.latitude)&&ie(i.geoPointValue.longitude)===ie(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return ie(i.integerValue)===ie(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ie(i.doubleValue),c=ie(s.doubleValue);return o===c?Ui(o)===Ui(c):isNaN(o)&&isNaN(c)}return!1})(n,e);case 9:return _r(n.arrayValue.values||[],e.arrayValue.values||[],ct);case 10:case 11:return(function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(um(o)!==um(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!ct(o[u],c[u])))return!1;return!0})(n,e);default:return M(52216,{left:n})}}function $i(n,e){return(n.values||[]).find((t=>ct(t,e)))!==void 0}function Kt(n,e){if(n===e)return 0;let t=$t(n),r=$t(e);if(t!==r)return z(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return z(n.booleanValue,e.booleanValue);case 2:return(function(s,o){let c=ie(s.integerValue||s.doubleValue),u=ie(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1})(n,e);case 3:return lm(n.timestampValue,e.timestampValue);case 4:return lm(Gi(n),Gi(e));case 5:return Wu(n.stringValue,e.stringValue);case 6:return(function(s,o){let c=It(s),u=It(o);return c.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(s,o){let c=s.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){let f=z(c[h],u[h]);if(f!==0)return f}return z(c.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,o){let c=z(ie(s.latitude),ie(o.latitude));return c!==0?c:z(ie(s.longitude),ie(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return hm(n.arrayValue,e.arrayValue);case 10:return(function(s,o){let c=s.fields||{},u=o.fields||{},h=c[br]?.arrayValue,f=u[br]?.arrayValue,m=z(h?.values?.length||0,f?.values?.length||0);return m!==0?m:hm(h,f)})(n.mapValue,e.mapValue);case 11:return(function(s,o){if(s===Bt.mapValue&&o===Bt.mapValue)return 0;if(s===Bt.mapValue)return 1;if(o===Bt.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){let _=Wu(u[m],f[m]);if(_!==0)return _;let R=Kt(c[u[m]],h[f[m]]);if(R!==0)return R}return z(u.length,f.length)})(n.mapValue,e.mapValue);default:throw M(23264,{he:t})}}function lm(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return z(n,e);let t=yt(n),r=yt(e),i=z(t.seconds,r.seconds);return i!==0?i:z(t.nanos,r.nanos)}function hm(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Kt(t[i],r[i]);if(s)return s}return z(t.length,r.length)}function Sr(n){return rl(n)}function rl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=yt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return It(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return x.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=rl(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${rl(t.fields[o])}`;return i+"}"})(n.mapValue):M(61005,{value:n})}function ko(n){switch($t(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=za(n);return e?16+ko(e):16;case 5:return 2*n.stringValue.length;case 6:return It(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((i,s)=>i+ko(s)),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return rn(r.fields,((s,o)=>{i+=s.length+ko(o)})),i})(n.mapValue);default:throw M(13486,{value:n})}}function Ki(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function il(n){return!!n&&"integerValue"in n}function Wi(n){return!!n&&"arrayValue"in n}function dm(n){return!!n&&"nullValue"in n}function fm(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Do(n){return!!n&&"mapValue"in n}function Ga(n){return(n?.mapValue?.fields||{})[$h]?.stringValue===Kh}function Di(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){let e={mapValue:{fields:{}}};return rn(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=Di(r))),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Di(n.arrayValue.values[t]);return e}return{...n}}function Vg(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Dg}var Og={mapValue:{fields:{[$h]:{stringValue:Kh},[br]:{arrayValue:{}}}}};function xT(n){return"nullValue"in n?No:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ki(Ar.empty(),x.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Ga(n)?Og:{mapValue:{}}:M(35942,{value:n})}function LT(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ki(Ar.empty(),x.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Og:"mapValue"in n?Ga(n)?{mapValue:{}}:Bt:M(61959,{value:n})}function pm(n,e){let t=Kt(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function mm(n,e){let t=Kt(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Ce=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Do(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Di(t)}setAll(e){let t=ge.emptyPath(),r={},i=[];e.forEach(((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=c.popLast()}o?r[c.lastSegment()]=Di(o):i.push(c.lastSegment())}));let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Do(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ct(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Do(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){rn(t,((i,s)=>e[i]=s));for(let i of r)delete e[i]}clone(){return new n(Di(this.value))}};function xg(n){let e=[];return rn(n.fields,((t,r)=>{let i=new ge([t]);if(Do(r)){let s=xg(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)})),new Fe(e)}var Te=class n{constructor(e,t,r,i,s,o,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new n(e,0,B.min(),B.min(),B.min(),Ce.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,B.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,B.min(),B.min(),Ce.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,B.min(),B.min(),Ce.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ce.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ce.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Wt=class{constructor(e,t){this.position=e,this.inclusive=t}};function gm(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=x.comparator(x.fromName(o.referenceValue),t.key):r=Kt(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function _m(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ct(n.position[t],e.position[t]))return!1;return!0}var xn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function MT(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Wo=class{},H=class n extends Wo{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new al(e,t,r):t==="array-contains"?new ll(e,r):t==="in"?new Ho(e,r):t==="not-in"?new hl(e,r):t==="array-contains-any"?new dl(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new cl(e,r):new ul(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Kt(t,this.value)):t!==null&&$t(this.value)===$t(t)&&this.matchesComparison(Kt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Z=class n extends Wo{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return Rr(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Rr(n){return n.op==="and"}function sl(n){return n.op==="or"}function Wh(n){return Lg(n)&&Rr(n)}function Lg(n){for(let e of n.filters)if(e instanceof Z)return!1;return!0}function ol(n){if(n instanceof H)return n.field.canonicalString()+n.op.toString()+Sr(n.value);if(Wh(n))return n.filters.map((e=>ol(e))).join(",");{let e=n.filters.map((t=>ol(t))).join(",");return`${n.op}(${e})`}}function Mg(n,e){return n instanceof H?(function(r,i){return i instanceof H&&r.op===i.op&&r.field.isEqual(i.field)&&ct(r.value,i.value)})(n,e):n instanceof Z?(function(r,i){return i instanceof Z&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce(((s,o,c)=>s&&Mg(o,i.filters[c])),!0):!1})(n,e):void M(19439)}function Fg(n,e){let t=n.filters.concat(e);return Z.create(t,n.op)}function Ug(n){return n instanceof H?(function(t){return`${t.field.canonicalString()} ${t.op} ${Sr(t.value)}`})(n):n instanceof Z?(function(t){return t.op.toString()+" {"+t.getFilters().map(Ug).join(" ,")+"}"})(n):"Filter"}var al=class extends H{constructor(e,t,r){super(e,t,r),this.key=x.fromName(r.referenceValue)}matches(e){let t=x.comparator(e.key,this.key);return this.matchesComparison(t)}},cl=class extends H{constructor(e,t){super(e,"in",t),this.keys=Bg("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}},ul=class extends H{constructor(e,t){super(e,"not-in",t),this.keys=Bg("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}};function Bg(n,e){return(e.arrayValue?.values||[]).map((t=>x.fromName(t.referenceValue)))}var ll=class extends H{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Wi(t)&&$i(t.arrayValue,this.value)}},Ho=class extends H{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&$i(this.value.arrayValue,t)}},hl=class extends H{constructor(e,t){super(e,"not-in",t)}matches(e){if($i(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!$i(this.value.arrayValue,t)}},dl=class extends H{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Wi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>$i(this.value.arrayValue,r)))}};var fl=class{constructor(e,t=null,r=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.Te=null}};function pl(n,e=null,t=[],r=[],i=null,s=null,o=null){return new fl(n,e,t,r,i,s,o)}function Ln(n){let e=G(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>ol(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(s){return s.field.canonicalString()+s.dir})(r))).join(","),Ua(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>Sr(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>Sr(r))).join(",")),e.Te=t}return e.Te}function ss(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!MT(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Mg(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!_m(n.startAt,e.startAt)&&_m(n.endAt,e.endAt)}function Qo(n){return x.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Jo(n,e){return n.filters.filter((t=>t instanceof H&&t.field.isEqual(e)))}function ym(n,e,t){let r=No,i=!0;for(let s of Jo(n,e)){let o=No,c=!0;switch(s.op){case"<":case"<=":o=xT(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=No}pm({value:r,inclusive:i},{value:o,inclusive:c})<0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];pm({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function Im(n,e,t){let r=Bt,i=!0;for(let s of Jo(n,e)){let o=Bt,c=!0;switch(s.op){case">=":case">":o=LT(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=Bt}mm({value:r,inclusive:i},{value:o,inclusive:c})>0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];mm({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Ht=class{constructor(e,t=null,r=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function FT(n,e,t,r,i,s,o,c){return new Ht(n,e,t,r,i,s,o,c)}function $a(n){return new Ht(n)}function Em(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function qg(n){return n.collectionGroup!==null}function Vi(n){let e=G(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new te(ge.comparator);return o.filters.forEach((u=>{u.getFlattenedFilters().forEach((h=>{h.isInequality()&&(c=c.add(h.field))}))})),c})(e).forEach((s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new xn(s,r))})),t.has(ge.keyField().canonicalString())||e.Ie.push(new xn(ge.keyField(),r))}return e.Ie}function ze(n){let e=G(n);return e.Ee||(e.Ee=UT(e,Vi(n))),e.Ee}function UT(n,e){if(n.limitType==="F")return pl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((i=>{let s=i.dir==="desc"?"asc":"desc";return new xn(i.field,s)}));let t=n.endAt?new Wt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Wt(n.startAt.position,n.startAt.inclusive):null;return pl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ml(n,e){let t=n.filters.concat([e]);return new Ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Yo(n,e,t){return new Ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ka(n,e){return ss(ze(n),ze(e))&&n.limitType===e.limitType}function jg(n){return`${Ln(ze(n))}|lt:${n.limitType}`}function cr(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((i=>Ug(i))).join(", ")}]`),Ua(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((i=>Sr(i))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((i=>Sr(i))).join(",")),`Target(${r})`})(ze(n))}; limitType=${n.limitType})`}function os(n,e){return e.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):x.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(let s of Vi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(o,c,u){let h=gm(o,c,u);return o.inclusive?h<=0:h<0})(r.startAt,Vi(r),i)||r.endAt&&!(function(o,c,u){let h=gm(o,c,u);return o.inclusive?h>=0:h>0})(r.endAt,Vi(r),i))})(n,e)}function BT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function zg(n){return(e,t)=>{let r=!1;for(let i of Vi(n)){let s=qT(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function qT(n,e,t){let r=n.field.isKeyField()?x.comparator(e.key,t.key):(function(s,o,c){let u=o.data.field(s),h=c.data.field(s);return u!==null&&h!==null?Kt(u,h):M(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M(19790,{direction:n.dir})}}var Je=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){rn(this.inner,((t,r)=>{for(let[i,s]of r)e(i,s)}))}isEmpty(){return Rg(this.inner)}size(){return this.innerSize}};var jT=new ae(x.comparator);function Ue(){return jT}var Gg=new ae(x.comparator);function Ri(...n){let e=Gg;for(let t of n)e=e.insert(t.key,t);return e}function $g(n){let e=Gg;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function ot(){return Oi()}function Kg(){return Oi()}function Oi(){return new Je((n=>n.toString()),((n,e)=>n.isEqual(e)))}var zT=new ae(x.comparator),GT=new te(x.comparator);function K(...n){let e=GT;for(let t of n)e=e.add(t);return e}var $T=new te(z);function KT(){return $T}function Hh(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ui(e)?"-0":e}}function Wg(n){return{integerValue:""+n}}function WT(n,e){return aT(e)?Wg(e):Hh(n,e)}var Pr=class{constructor(){this._=void 0}};function HT(n,e,t){return n instanceof Qt?(function(i,s){let o={fields:{[Cg]:{stringValue:Pg},[kg]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Gh(s)&&(s=za(s)),s&&(o.fields[Ng]=s),{mapValue:o}})(t,e):n instanceof Jt?Qg(n,e):n instanceof Yt?Jg(n,e):(function(i,s){let o=Hg(i,s),c=wm(o)+wm(i.Ae);return il(o)&&il(i.Ae)?Wg(c):Hh(i.serializer,c)})(n,e)}function QT(n,e,t){return n instanceof Jt?Qg(n,e):n instanceof Yt?Jg(n,e):t}function Hg(n,e){return n instanceof Mn?(function(r){return il(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}var Qt=class extends Pr{},Jt=class extends Pr{constructor(e){super(),this.elements=e}};function Qg(n,e){let t=Yg(e);for(let r of n.elements)t.some((i=>ct(i,r)))||t.push(r);return{arrayValue:{values:t}}}var Yt=class extends Pr{constructor(e){super(),this.elements=e}};function Jg(n,e){let t=Yg(e);for(let r of n.elements)t=t.filter((i=>!ct(i,r)));return{arrayValue:{values:t}}}var Mn=class extends Pr{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function wm(n){return ie(n.integerValue||n.doubleValue)}function Yg(n){return Wi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Xo=class{constructor(e,t){this.field=e,this.transform=t}};function JT(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Jt&&i instanceof Jt||r instanceof Yt&&i instanceof Yt?_r(r.elements,i.elements,ct):r instanceof Mn&&i instanceof Mn?ct(r.Ae,i.Ae):r instanceof Qt&&i instanceof Qt})(n.transform,e.transform)}var gl=class{constructor(e,t){this.version=e,this.transformResults=t}},Be=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Vo(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Cr=class{};function Xg(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Hi(n.key,Be.none()):new Xt(n.key,n.data,Be.none());{let t=n.data,r=Ce.empty(),i=new te(ge.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ye(n.key,r,new Fe(i.toArray()),Be.none())}}function YT(n,e,t){n instanceof Xt?(function(i,s,o){let c=i.value.clone(),u=vm(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):n instanceof Ye?(function(i,s,o){if(!Vo(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=vm(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Zg(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(n,e,t):(function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function xi(n,e,t,r){return n instanceof Xt?(function(s,o,c,u){if(!Vo(s.precondition,o))return c;let h=s.value.clone(),f=Am(s.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof Ye?(function(s,o,c,u){if(!Vo(s.precondition,o))return c;let h=Am(s.fieldTransforms,u,o),f=o.data;return f.setAll(Zg(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map((m=>m.field)))})(n,e,t,r):(function(s,o,c){return Vo(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c})(n,e,t)}function XT(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=Hg(r.transform,i||null);s!=null&&(t===null&&(t=Ce.empty()),t.set(r.field,s))}return t||null}function Tm(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&_r(r,i,((s,o)=>JT(s,o)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Xt=class extends Cr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ye=class extends Cr{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Zg(n){let e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}})),e}function vm(n,e,t){let r=new Map;F(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,QT(o,c,t[i]))}return r}function Am(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,HT(s,o,e))}return r}var Hi=class extends Cr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Zo=class extends Cr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Qi=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&YT(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=xi(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=xi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Kg();return this.mutations.forEach((i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=Xg(o,c);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(B.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),K())}isEqual(e){return this.batchId===e.batchId&&_r(this.mutations,e.mutations,((t,r)=>Tm(t,r)))&&_r(this.baseMutations,e.baseMutations,((t,r)=>Tm(t,r)))}},_l=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){F(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return zT})(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Ji=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var yl=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var he,J;function ZT(n){switch(n){case P.OK:return M(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M(15467,{code:n})}}function e_(n){if(n===void 0)return Pe("GRPC error has no .code"),P.UNKNOWN;switch(n){case he.OK:return P.OK;case he.CANCELLED:return P.CANCELLED;case he.UNKNOWN:return P.UNKNOWN;case he.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case he.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case he.INTERNAL:return P.INTERNAL;case he.UNAVAILABLE:return P.UNAVAILABLE;case he.UNAUTHENTICATED:return P.UNAUTHENTICATED;case he.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case he.NOT_FOUND:return P.NOT_FOUND;case he.ALREADY_EXISTS:return P.ALREADY_EXISTS;case he.PERMISSION_DENIED:return P.PERMISSION_DENIED;case he.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case he.ABORTED:return P.ABORTED;case he.OUT_OF_RANGE:return P.OUT_OF_RANGE;case he.UNIMPLEMENTED:return P.UNIMPLEMENTED;case he.DATA_LOSS:return P.DATA_LOSS;default:return M(39323,{code:n})}}(J=he||(he={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var ev=null;function tv(){return new TextEncoder}var nv=new mt([4294967295,4294967295],0);function bm(n){let e=tv().encode(n),t=new Pu;return t.update(e),new Uint8Array(t.digest())}function Sm(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new mt([t,r],0),new mt([i,s],0)]}var Il=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Sn(`Invalid padding: ${t}`);if(r<0)throw new Sn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Sn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Sn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=mt.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(mt.fromNumber(r)));return i.compare(nv)===1&&(i=new mt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=bm(e),[r,i]=Sm(t);for(let s=0;s<this.hashCount;s++){let o=this.ye(r,i,s);if(!this.we(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach((c=>o.insert(c))),o}insert(e){if(this.ge===0)return;let t=bm(e),[r,i]=Sm(t);for(let s=0;s<this.hashCount;s++){let o=this.ye(r,i,s);this.Se(o)}}Se(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Sn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ea=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Yi.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(B.min(),i,new ae(z),Ue(),K())}},Yi=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,K(),K(),K())}};var pr=class{constructor(e,t,r,i){this.be=e,this.removedTargetIds=t,this.key=r,this.De=i}},ta=class{constructor(e,t){this.targetId=e,this.Ce=t}},na=class{constructor(e,t,r=_e.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},ra=class{constructor(){this.ve=0,this.Fe=Rm(),this.Me=_e.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=K(),t=K(),r=K();return this.Fe.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M(38017,{changeType:s})}})),new Yi(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=Rm()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,F(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},El=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ue(),this.Je=vo(),this.He=vo(),this.Ye=new ae(z)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:M(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,i)=>{this.rt(i)&&t(i)}))}st(e){let t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){let s=i.target;if(Qo(s))if(r===0){let o=new x(s.path);this.et(t,o,Te.newNoDocument(o,B.min()))}else F(r===1,20013,{expectedCount:r});else{let o=this._t(t);if(o!==r){let c=this.ut(e),u=c?this.ct(c,e,o):1;if(u!==0){this.it(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}ev?.lt((function(f,m,_,R,k){let V={localCacheCount:f,existenceFilterCount:m.count,databaseId:_.database,projectId:_.projectId},N=m.unchangedNames;return N&&(V.bloomFilter={applied:k===0,hashCount:N?.hashCount??0,bitmapLength:N?.bits?.bitmap?.length??0,padding:N?.bits?.padding??0,mightContain:j=>R?.mightContain(j)??!1}),V})(o,e.Ce,this.Ge.ht(),c,u))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,c;try{o=It(r).toUint8Array()}catch(u){if(u instanceof $o)return On("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Il(o,i,s)}catch(u){return On(u instanceof Sn?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.ge===0?null:c}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),i=0;return r.forEach((s=>{let o=this.Ge.ht(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.et(t,s,null),i++)})),i}Tt(e){let t=new Map;this.ze.forEach(((s,o)=>{let c=this.ot(o);if(c){if(s.current&&Qo(c.target)){let u=new x(c.target.path);this.It(u).has(o)||this.Et(o,u)||this.et(o,u,Te.newNoDocument(u,e))}s.Be&&(t.set(o,s.ke()),s.qe())}}));let r=K();this.He.forEach(((s,o)=>{let c=!0;o.forEachWhile((u=>{let h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(r=r.add(s))})),this.je.forEach(((s,o)=>o.setReadTime(e)));let i=new ea(e,t,this.Ye,this.je,r);return this.je=Ue(),this.Je=vo(),this.He=vo(),this.Ye=new ae(z),i}Xe(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new ra,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new te(z),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new te(z),this.Je=this.Je.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||C("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ra),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function vo(){return new ae(x.comparator)}function Rm(){return new ae(x.comparator)}var rv={asc:"ASCENDING",desc:"DESCENDING"},iv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sv={and:"AND",or:"OR"},wl=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Tl(n,e){return n.useProto3Json||Ua(e)?e:{value:e}}function Nr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function t_(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ov(n,e){return Nr(n,e.toTimestamp())}function Ne(n){return F(!!n,49232),B.fromTimestamp((function(t){let r=yt(t);return new se(r.seconds,r.nanos)})(n))}function Qh(n,e){return vl(n,e).canonicalString()}function vl(n,e){let t=(function(i){return new X(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function n_(n){let e=X.fromString(n);return F(h_(e),10190,{key:e.toString()}),e}function ia(n,e){return Qh(n.databaseId,e.path)}function kn(n,e){let t=n_(e);if(t.get(1)!==n.databaseId.projectId)throw new D(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new x(s_(t))}function r_(n,e){return Qh(n.databaseId,e)}function i_(n){let e=n_(n);return e.length===4?X.emptyPath():s_(e)}function Al(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function s_(n){return F(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Pm(n,e,t){return{name:ia(n,e),fields:t.value.mapValue.fields}}function av(n,e,t){let r=kn(n,e.name),i=Ne(e.updateTime),s=e.createTime?Ne(e.createTime):B.min(),o=new Ce({mapValue:{fields:e.fields}}),c=Te.newFoundDocument(r,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function cv(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:M(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(h,f){return h.useProto3Json?(F(f===void 0||typeof f=="string",58123),_e.fromBase64String(f||"")):(F(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),_e.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&(function(h){let f=h.code===void 0?P.UNKNOWN:e_(h.code);return new D(f,h.message||"")})(o);t=new na(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=kn(n,r.document.name),s=Ne(r.document.updateTime),o=r.document.createTime?Ne(r.document.createTime):B.min(),c=new Ce({mapValue:{fields:r.document.fields}}),u=Te.newFoundDocument(i,s,o,c),h=r.targetIds||[],f=r.removedTargetIds||[];t=new pr(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=kn(n,r.document),s=r.readTime?Ne(r.readTime):B.min(),o=Te.newNoDocument(i,s),c=r.removedTargetIds||[];t=new pr([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=kn(n,r.document),s=r.removedTargetIds||[];t=new pr([],s,i,null)}else{if(!("filter"in e))return M(11601,{Rt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new yl(i,s),c=r.targetId;t=new ta(c,o)}}return t}function sa(n,e){let t;if(e instanceof Xt)t={update:Pm(n,e.key,e.value)};else if(e instanceof Hi)t={delete:ia(n,e.key)};else if(e instanceof Ye)t={update:Pm(n,e.key,e.data),updateMask:pv(e.fieldMask)};else{if(!(e instanceof Zo))return M(16599,{Vt:e.type});t={verify:ia(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(s,o){let c=o.transform;if(c instanceof Qt)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Jt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Yt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Mn)return{fieldPath:o.field.canonicalString(),increment:c.Ae};throw M(20930,{transform:o.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:ov(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:M(27497)})(n,e.precondition)),t}function bl(n,e){let t=e.currentDocument?(function(s){return s.updateTime!==void 0?Be.updateTime(Ne(s.updateTime)):s.exists!==void 0?Be.exists(s.exists):Be.none()})(e.currentDocument):Be.none(),r=e.updateTransforms?e.updateTransforms.map((i=>(function(o,c){let u=null;if("setToServerValue"in c)F(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new Qt;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new Jt(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new Yt(f)}else"increment"in c?u=new Mn(o,c.increment):M(16584,{proto:c});let h=ge.fromServerFormat(c.fieldPath);return new Xo(h,u)})(n,i))):[];if(e.update){e.update.name;let i=kn(n,e.update.name),s=new Ce({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=(function(u){let h=u.fieldPaths||[];return new Fe(h.map((f=>ge.fromServerFormat(f))))})(e.updateMask);return new Ye(i,s,o,t,r)}return new Xt(i,s,t,r)}if(e.delete){let i=kn(n,e.delete);return new Hi(i,t)}if(e.verify){let i=kn(n,e.verify);return new Zo(i,t)}return M(1463,{proto:e})}function uv(n,e){return n&&n.length>0?(F(e!==void 0,14353),n.map((t=>(function(i,s){let o=i.updateTime?Ne(i.updateTime):Ne(s);return o.isEqual(B.min())&&(o=Ne(s)),new gl(o,i.transformResults||[])})(t,e)))):[]}function o_(n,e){return{documents:[r_(n,e.path)]}}function a_(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=r_(n,i);let s=(function(h){if(h.length!==0)return l_(Z.create(h,"and"))})(e.filters);s&&(t.structuredQuery.where=s);let o=(function(h){if(h.length!==0)return h.map((f=>(function(_){return{field:ur(_.field),direction:hv(_.dir)}})(f)))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=Tl(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function c_(n){let e=i_(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){F(r===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=(function(m){let _=u_(m);return _ instanceof Z&&Wh(_)?_.getFilters():[_]})(t.where));let o=[];t.orderBy&&(o=(function(m){return m.map((_=>(function(k){return new xn(lr(k.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(_)))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let _;return _=typeof m=="object"?m.value:m,Ua(_)?null:_})(t.limit));let u=null;t.startAt&&(u=(function(m){let _=!!m.before,R=m.values||[];return new Wt(R,_)})(t.startAt));let h=null;return t.endAt&&(h=(function(m){let _=!m.before,R=m.values||[];return new Wt(R,_)})(t.endAt)),FT(e,i,o,s,c,"F",u,h)}function lv(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function u_(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=lr(t.unaryFilter.field);return H.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=lr(t.unaryFilter.field);return H.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=lr(t.unaryFilter.field);return H.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=lr(t.unaryFilter.field);return H.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}})(n):n.fieldFilter!==void 0?(function(t){return H.create(lr(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Z.create(t.compositeFilter.filters.map((r=>u_(r))),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}})(t.compositeFilter.op))})(n):M(30097,{filter:n})}function hv(n){return rv[n]}function dv(n){return iv[n]}function fv(n){return sv[n]}function ur(n){return{fieldPath:n.canonicalString()}}function lr(n){return ge.fromServerFormat(n.fieldPath)}function l_(n){return n instanceof H?(function(t){if(t.op==="=="){if(fm(t.value))return{unaryFilter:{field:ur(t.field),op:"IS_NAN"}};if(dm(t.value))return{unaryFilter:{field:ur(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(fm(t.value))return{unaryFilter:{field:ur(t.field),op:"IS_NOT_NAN"}};if(dm(t.value))return{unaryFilter:{field:ur(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ur(t.field),op:dv(t.op),value:t.value}}})(n):n instanceof Z?(function(t){let r=t.getFilters().map((i=>l_(i)));return r.length===1?r[0]:{compositeFilter:{op:fv(t.op),filters:r}}})(n):M(54877,{filter:n})}function pv(n){let e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function h_(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var kr=class n{constructor(e,t,r,i,s=B.min(),o=B.min(),c=_e.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var oa=class{constructor(e){this.yt=e}};function mv(n,e){let t;if(e.document)t=av(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=x.fromSegments(e.noDocument.path),i=Un(e.noDocument.readTime);t=Te.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return M(56709);{let r=x.fromSegments(e.unknownDocument.path),i=Un(e.unknownDocument.version);t=Te.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime((function(i){let s=new se(i[0],i[1]);return B.fromTimestamp(s)})(e.readTime)),t}function Cm(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:aa(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=(function(s,o){return{name:ia(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Nr(s,o.version.toTimestamp()),createTime:Nr(s,o.createTime.toTimestamp())}})(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Fn(e.version)};else{if(!e.isUnknownDocument())return M(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Fn(e.version)}}return r}function aa(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Fn(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Un(n){let e=new se(n.seconds,n.nanoseconds);return B.fromTimestamp(e)}function Tn(n,e){let t=(e.baseMutations||[]).map((s=>bl(n.yt,s)));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map((s=>bl(n.yt,s))),i=se.fromMillis(e.localWriteTimeMs);return new Qi(e.batchId,i,t,r)}function Pi(n){let e=Un(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Un(n.lastLimboFreeSnapshotVersion):B.min(),r;return r=(function(s){return s.documents!==void 0})(n.query)?(function(s){let o=s.documents.length;return F(o===1,1966,{count:o}),ze($a(i_(s.documents[0])))})(n.query):(function(s){return ze(c_(s))})(n.query),new kr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,_e.fromBase64String(n.resumeToken))}function d_(n,e){let t=Fn(e.snapshotVersion),r=Fn(e.lastLimboFreeSnapshotVersion),i;i=Qo(e.target)?o_(n.yt,e.target):a_(n.yt,e.target).ft;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ln(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function f_(n){let e=c_({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Yo(e,e.limit,"L"):e}function xu(n,e){return new Ji(e.largestBatchId,bl(n.yt,e.overlayMutation))}function Nm(n,e){let t=e.path.lastSegment();return[n,be(e.path.popLast()),t]}function km(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Fn(r.readTime),documentKey:be(r.documentKey.path),largestBatchId:r.largestBatchId}}var Sl=class{getBundleMetadata(e,t){return Dm(e).get(t).next((r=>{if(r)return(function(s){return{id:s.bundleId,createTime:Un(s.createTime),version:s.version}})(r)}))}saveBundleMetadata(e,t){return Dm(e).put((function(i){return{bundleId:i.id,createTime:Fn(Ne(i.createTime)),version:i.version}})(t))}getNamedQuery(e,t){return Vm(e).get(t).next((r=>{if(r)return(function(s){return{name:s.name,query:f_(s.bundledQuery),readTime:Un(s.readTime)}})(r)}))}saveNamedQuery(e,t){return Vm(e).put((function(i){return{name:i.name,readTime:Fn(Ne(i.readTime)),bundledQuery:i.bundledQuery}})(t))}};function Dm(n){return ye(n,Ba)}function Vm(n){return ye(n,qa)}var ca=class n{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return vi(e).get(Nm(this.userId,t)).next((r=>r?xu(this.serializer,r):null))}getOverlays(e,t){let r=ot();return b.forEach(t,(i=>this.getOverlay(e,i).next((s=>{s!==null&&r.set(i,s)})))).next((()=>r))}saveOverlays(e,t,r){let i=[];return r.forEach(((s,o)=>{let c=new Ji(t,o);i.push(this.St(e,c))})),b.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach((o=>i.add(be(o.getCollectionPath()))));let s=[];return i.forEach((o=>{let c=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(vi(e).Z(tl,c))})),b.waitFor(s)}getOverlaysForCollection(e,t,r){let i=ot(),s=be(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return vi(e).J(tl,o).next((c=>{for(let u of c){let h=xu(this.serializer,u);i.set(h.getKey(),h)}return i}))}getOverlaysForCollectionGroup(e,t,r,i){let s=ot(),o,c=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return vi(e).ee({index:Tg,range:c},((u,h,f)=>{let m=xu(this.serializer,h);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):f.done()})).next((()=>s))}St(e,t){return vi(e).put((function(i,s,o){let[c,u,h]=Nm(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:sa(i.yt,o.mutation)}})(this.serializer,this.userId,t))}};function vi(n){return ye(n,ja)}var Rl=class{bt(e){return ye(e,jh)}getSessionToken(e){return this.bt(e).get("sessionToken").next((t=>{let r=t?.value;return r?_e.fromUint8Array(r):_e.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var _t=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ie(e.integerValue));else if("doubleValue"in e){let r=ie(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Ui(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=yt(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(It(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?Vg(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Ga(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):M(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=br,s=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ie(s)),this.Ot(i,t),this.Ct(r[i],t)}Qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),x.fromName(e).path.forEach((r=>{this.Ft(t,60),this.Ut(r,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};_t.Kt=new _t;var rr=255;function gv(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Om(n){let e=64-(function(r){let i=0;for(let s=0;s<8;++s){let o=gv(255&r[s]);if(i+=o,o!==8)break}return i})(n);return Math.ceil(e/8)}var Pl=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{let i=t.codePointAt(0);this.Gt(240|i>>>18),this.Gt(128|63&i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i)}}this.zt()}Zt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{let i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Ht()}Xt(e){let t=this.en(e),r=Om(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}nn(e){let t=this.en(e),r=Om(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}rn(){this.sn(rr),this.sn(255)}_n(){this.an(rr),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t=(function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)})(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Gt(e){let t=255&e;t===0?(this.sn(0),this.sn(255)):t===rr?(this.sn(rr),this.sn(0)):this.sn(t)}Jt(e){let t=255&e;t===0?(this.an(0),this.an(255)):t===rr?(this.an(rr),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Cl=class{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}},Nl=class{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}},vn=class{constructor(){this.cn=new Pl,this.ln=new Cl(this.cn),this.hn=new Nl(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}};var An=class n{constructor(e,t,r,i){this.Tn=e,this.In=t,this.En=r,this.dn=i}An(){let e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new n(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Oo(this.En),directionalValue:Oo(this.dn),orderedDocumentKey:Oo(t),documentKey:r.path.toArray()}}Vn(e,t,r){let i=this.Rn(e,t,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function Lt(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=xm(n.En,e.En),t!==0?t:(t=xm(n.dn,e.dn),t!==0?t:x.comparator(n.In,e.In)))}function xm(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Oo(n){return Nc()?(function(t){let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r})(n):n}function Lm(n){return typeof n!="string"?n:(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(n)}var ua=class{constructor(e){this.mn=new te(((t,r)=>ge.comparator(t.field,r.field))),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(let t of e.filters){let r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(F(e.collectionGroup===this.collectionId,49279),this.pn)return!1;let t=Hu(e);if(t!==void 0&&!this.wn(t))return!1;let r=In(e),i=new Set,s=0,o=0;for(;s<r.length&&this.wn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.mn.size>0){let c=this.mn.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=r[s];if(!this.Sn(c,u)||!this.bn(this.fn[o++],u))return!1}++s}for(;s<r.length;++s){let c=r[s];if(o>=this.fn.length||!this.bn(this.fn[o++],c))return!1}return!0}Dn(){if(this.pn)return null;let e=new te(ge.comparator),t=[];for(let r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new fr(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new fr(r.field,0))}for(let r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new fr(r.field,r.dir==="asc"?0:1)));return new yr(yr.UNKNOWN_ID,this.collectionId,t,Fi.empty())}wn(e){for(let t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function p_(n){if(F(n instanceof H||n instanceof Z,20012),n instanceof H){if(n instanceof Ho){let t=n.value.arrayValue?.values?.map((r=>H.create(n.field,"==",r)))||[];return Z.create(t,"or")}return n}let e=n.filters.map((t=>p_(t)));return Z.create(e,n.op)}function _v(n){if(n.getFilters().length===0)return[];let e=Vl(p_(n));return F(m_(e),7391),kl(e)||Dl(e)?[e]:e.getFilters()}function kl(n){return n instanceof H}function Dl(n){return n instanceof Z&&Wh(n)}function m_(n){return kl(n)||Dl(n)||(function(t){if(t instanceof Z&&sl(t)){for(let r of t.getFilters())if(!kl(r)&&!Dl(r))return!1;return!0}return!1})(n)}function Vl(n){if(F(n instanceof H||n instanceof Z,34018),n instanceof H)return n;if(n.filters.length===1)return Vl(n.filters[0]);let e=n.filters.map((r=>Vl(r))),t=Z.create(e,n.op);return t=la(t),m_(t)?t:(F(t instanceof Z,64498),F(Rr(t),40251),F(t.filters.length>1,57927),t.filters.reduce(((r,i)=>Jh(r,i))))}function Jh(n,e){let t;return F(n instanceof H||n instanceof Z,38388),F(e instanceof H||e instanceof Z,25473),t=n instanceof H?e instanceof H?(function(i,s){return Z.create([i,s],"and")})(n,e):Mm(n,e):e instanceof H?Mm(e,n):(function(i,s){if(F(i.filters.length>0&&s.filters.length>0,48005),Rr(i)&&Rr(s))return Fg(i,s.getFilters());let o=sl(i)?i:s,c=sl(i)?s:i,u=o.filters.map((h=>Jh(h,c)));return Z.create(u,"or")})(n,e),la(t)}function Mm(n,e){if(Rr(e))return Fg(e,n.getFilters());{let t=e.filters.map((r=>Jh(n,r)));return Z.create(t,"or")}}function la(n){if(F(n instanceof H||n instanceof Z,11850),n instanceof H)return n;let e=n.getFilters();if(e.length===1)return la(e[0]);if(Lg(n))return n;let t=e.map((i=>la(i))),r=[];return t.forEach((i=>{i instanceof H?r.push(i):i instanceof Z&&(i.op===n.op?r.push(...i.filters):r.push(i))})),r.length===1?r[0]:Z.create(r,n.op)}var Ol=class{constructor(){this.Cn=new Xi}addToCollectionParentIndex(e,t){return this.Cn.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}deleteAllFieldIndexes(e){return b.resolve()}createTargetIndexes(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(Ge.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(Ge.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}},Xi=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new te(X.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new te(X.comparator)).toArray()}};var Fm="IndexedDbIndexManager",Ao=new Uint8Array(0),xl=class{constructor(e,t){this.databaseId=t,this.vn=new Xi,this.Fn=new Je((r=>Ln(r)),((r,i)=>ss(r,i))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((()=>{this.vn.add(t)}));let s={collectionId:r,parent:be(i)};return Um(e).put(s)}return b.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[hg(t),""],!1,!0);return Um(e).J(i).next((s=>{for(let o of s){if(o.collectionId!==t)break;r.push(st(o.parent))}return r}))}addFieldIndex(e,t){let r=Ai(e),i=(function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map((u=>[u.fieldPath.canonicalString(),u.kind]))}})(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=sr(e);return s.next((c=>{o.put(km(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return s.next()}deleteFieldIndex(e,t){let r=Ai(e),i=sr(e),s=ir(e);return r.delete(t.indexId).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){let t=Ai(e),r=ir(e),i=sr(e);return t.Z().next((()=>r.Z())).next((()=>i.Z()))}createTargetIndexes(e,t){return b.forEach(this.Mn(t),(r=>this.getIndexType(e,r).next((i=>{if(i===0||i===1){let s=new ua(r).Dn();if(s!=null)return this.addFieldIndex(e,s)}}))))}getDocumentsMatchingTarget(e,t){let r=ir(e),i=!0,s=new Map;return b.forEach(this.Mn(t),(o=>this.xn(e,o).next((c=>{i&&(i=!!c),s.set(o,c)})))).next((()=>{if(i){let o=K(),c=[];return b.forEach(s,((u,h)=>{C(Fm,`Using index ${(function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map((ee=>`${ee.fieldPath}:${ee.kind}`)).join(",")}`})(u)} to execute ${Ln(t)}`);let f=(function(U,ee){let Y=Hu(ee);if(Y===void 0)return null;for(let Q of Jo(U,Y.fieldPath))switch(Q.op){case"array-contains-any":return Q.value.arrayValue.values||[];case"array-contains":return[Q.value]}return null})(h,u),m=(function(U,ee){let Y=new Map;for(let Q of In(ee))for(let E of Jo(U,Q.fieldPath))switch(E.op){case"==":case"in":Y.set(Q.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return Y.set(Q.fieldPath.canonicalString(),E.value),Array.from(Y.values())}return null})(h,u),_=(function(U,ee){let Y=[],Q=!0;for(let E of In(ee)){let g=E.kind===0?ym(U,E.fieldPath,U.startAt):Im(U,E.fieldPath,U.startAt);Y.push(g.value),Q&&(Q=g.inclusive)}return new Wt(Y,Q)})(h,u),R=(function(U,ee){let Y=[],Q=!0;for(let E of In(ee)){let g=E.kind===0?Im(U,E.fieldPath,U.endAt):ym(U,E.fieldPath,U.endAt);Y.push(g.value),Q&&(Q=g.inclusive)}return new Wt(Y,Q)})(h,u),k=this.On(u,h,_),V=this.On(u,h,R),N=this.Nn(u,h,m),j=this.Bn(u.indexId,f,k,_.inclusive,V,R.inclusive,N);return b.forEach(j,(q=>r.Y(q,t.limit).next((U=>{U.forEach((ee=>{let Y=x.fromSegments(ee.documentKey);o.has(Y)||(o=o.add(Y),c.push(Y))}))}))))})).next((()=>c))}return b.resolve(null)}))}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=_v(Z.create(e.filters,"and")).map((r=>pl(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt))),this.Fn.set(e,t),t)}Bn(e,t,r,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),h=u/(t!=null?t.length:1),f=[];for(let m=0;m<u;++m){let _=t?this.Ln(t[m/h]):Ao,R=this.kn(e,_,r[m%h],i),k=this.qn(e,_,s[m%h],o),V=c.map((N=>this.kn(e,_,N,!0)));f.push(...this.createRange(R,k,V))}return f}kn(e,t,r,i){let s=new An(e,x.empty(),t,r);return i?s:s.An()}qn(e,t,r,i){let s=new An(e,x.empty(),t,r);return i?s.An():s}xn(e,t){let r=new ua(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next((s=>{let o=null;for(let c of s)r.yn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o}))}getIndexType(e,t){let r=2,i=this.Mn(t);return b.forEach(i,(s=>this.xn(e,s).next((o=>{o?r!==0&&o.fields.length<(function(u){let h=new te(ge.comparator),f=!1;for(let m of u.filters)for(let _ of m.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:h=h.add(_.field));for(let m of u.orderBy)m.field.isKeyField()||(h=h.add(m.field));return h.size+(f?1:0)})(s)&&(r=1):r=0})))).next((()=>(function(o){return o.limit!==null})(t)&&i.length>1&&r===2?1:r))}Qn(e,t){let r=new vn;for(let i of In(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Pn(i.kind);_t.Kt.Dt(s,o)}return r.un()}Ln(e){let t=new vn;return _t.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){let r=new vn;return _t.Kt.Dt(Ki(this.databaseId,t),r.Pn((function(s){let o=In(s);return o.length===0?0:o[o.length-1].kind})(e))),r.un()}Nn(e,t,r){if(r===null)return[];let i=[];i.push(new vn);let s=0;for(let o of In(e)){let c=r[s++];for(let u of i)if(this.Un(t,o.fieldPath)&&Wi(c))i=this.Kn(i,o,c);else{let h=u.Pn(o.kind);_t.Kt.Dt(c,h)}}return this.Wn(i)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let c of i){let u=new vn;u.seed(c.un()),_t.Kt.Dt(o,u.Pn(t.kind)),s.push(u)}return s}Un(e,t){return!!e.filters.find((r=>r instanceof H&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in")))}getFieldIndexes(e,t){let r=Ai(e),i=sr(e);return(t?r.J(el,IDBKeyRange.bound(t,t)):r.J()).next((s=>{let o=[];return b.forEach(s,(c=>i.get([c.indexId,this.uid]).next((u=>{o.push((function(f,m){let _=m?new Fi(m.sequenceNumber,new Ge(Un(m.readTime),new x(st(m.documentKey)),m.largestBatchId)):Fi.empty(),R=f.fields.map((([k,V])=>new fr(ge.fromServerFormat(k),V)));return new yr(f.indexId,f.collectionGroup,R,_)})(c,u))})))).next((()=>o))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((t=>t.length===0?null:(t.sort(((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:z(r.collectionGroup,i.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(e,t,r){let i=Ai(e),s=sr(e);return this.Gn(e).next((o=>i.J(el,IDBKeyRange.bound(t,t)).next((c=>b.forEach(c,(u=>s.put(km(u.indexId,this.uid,o,r))))))))}updateIndexEntries(e,t){let r=new Map;return b.forEach(t,((i,s)=>{let o=r.get(i.collectionGroup);return(o?b.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next((c=>(r.set(i.collectionGroup,c),b.forEach(c,(u=>this.zn(e,i,u).next((h=>{let f=this.jn(s,u);return h.isEqual(f)?b.resolve():this.Jn(e,s,u,h,f)})))))))}))}Hn(e,t,r,i){return ir(e).put(i.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,i){return ir(e).delete(i.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){let i=ir(e),s=new te(Lt);return i.ee({index:wg,range:IDBKeyRange.only([r.indexId,this.uid,Oo(this.$n(r,t))])},((o,c)=>{s=s.add(new An(r.indexId,t,Lm(c.arrayValue),Lm(c.directionalValue)))})).next((()=>s))}jn(e,t){let r=new te(Lt),i=this.Qn(t,e);if(i==null)return r;let s=Hu(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Wi(o))for(let c of o.arrayValue.values||[])r=r.add(new An(t.indexId,e.key,this.Ln(c),i))}else r=r.add(new An(t.indexId,e.key,Ao,i));return r}Jn(e,t,r,i,s){C(Fm,"Updating index entries for document '%s'",t.key);let o=[];return(function(u,h,f,m,_){let R=u.getIterator(),k=h.getIterator(),V=nr(R),N=nr(k);for(;V||N;){let j=!1,q=!1;if(V&&N){let U=f(V,N);U<0?q=!0:U>0&&(j=!0)}else V!=null?q=!0:j=!0;j?(m(N),N=nr(k)):q?(_(V),V=nr(R)):(V=nr(R),N=nr(k))}})(i,s,Lt,(c=>{o.push(this.Hn(e,t,r,c))}),(c=>{o.push(this.Yn(e,t,r,c))})),b.waitFor(o)}Gn(e){let t=1;return sr(e).ee({index:Eg,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((r,i,s)=>{s.done(),t=i.sequenceNumber+1})).next((()=>t))}createRange(e,t,r){r=r.sort(((o,c)=>Lt(o,c))).filter(((o,c,u)=>!c||Lt(o,u[c-1])!==0));let i=[];i.push(e);for(let o of r){let c=Lt(o,e),u=Lt(o,t);if(c===0)i[0]=e.An();else if(c>0&&u<0)i.push(o),i.push(o.An());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Zn(i[o],i[o+1]))return[];let c=i[o].Vn(this.uid,Ao,x.empty()),u=i[o+1].Vn(this.uid,Ao,x.empty());s.push(IDBKeyRange.bound(c,u))}return s}Zn(e,t){return Lt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Bm)}getMinOffset(e,t){return b.mapArray(this.Mn(t),(r=>this.xn(e,r).next((i=>i||M(44426))))).next(Bm)}};function Um(n){return ye(n,ji)}function ir(n){return ye(n,ki)}function Ai(n){return ye(n,qh)}function sr(n){return ye(n,Ni)}function Bm(n){F(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Fh(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Ge(e.readTime,e.documentKey,t)}var qm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},g_=41943040,Ve=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};function __(n,e,t){let r=n.store(He),i=n.store(Er),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=r.ee({range:o},((f,m,_)=>(c++,_.delete())));s.push(u.next((()=>{F(c===1,47070,{batchId:t.batchId})})));let h=[];for(let f of t.mutations){let m=_g(e,f.key.path,t.batchId);s.push(i.delete(m)),h.push(f.key)}return b.waitFor(s).next((()=>h))}function ha(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw M(14731);e=n.noDocument}return JSON.stringify(e).length}Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(g_,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);var da=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Xn={}}static wt(e,t,r,i){F(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mt(e).ee({index:bn,range:r},((i,s,o)=>{t=!1,o.done()})).next((()=>t))}addMutationBatch(e,t,r,i){let s=hr(e),o=Mt(e);return o.add({}).next((c=>{F(typeof c=="number",49019);let u=new Qi(c,t,r,i),h=(function(R,k,V){let N=V.baseMutations.map((q=>sa(R.yt,q))),j=V.mutations.map((q=>sa(R.yt,q)));return{userId:k,batchId:V.batchId,localWriteTimeMs:V.localWriteTime.toMillis(),baseMutations:N,mutations:j}})(this.serializer,this.userId,u),f=[],m=new te(((_,R)=>z(_.canonicalString(),R.canonicalString())));for(let _ of i){let R=_g(this.userId,_.key.path,c);m=m.add(_.key.path.popLast()),f.push(o.put(h)),f.push(s.put(R,lT))}return m.forEach((_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))})),e.addOnCommittedListener((()=>{this.Xn[c]=u.keys()})),b.waitFor(f).next((()=>u))}))}lookupMutationBatch(e,t){return Mt(e).get(t).next((r=>r?(F(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Tn(this.serializer,r)):null))}er(e,t){return this.Xn[t]?b.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next((r=>{if(r){let i=r.keys();return this.Xn[t]=i,i}return null}))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Mt(e).ee({index:bn,range:i},((o,c,u)=>{c.userId===this.userId&&(F(c.batchId>=r,47524,{tr:r}),s=Tn(this.serializer,c)),u.done()})).next((()=>s))}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Cn;return Mt(e).ee({index:bn,range:t,reverse:!0},((i,s,o)=>{r=s.batchId,o.done()})).next((()=>r))}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Cn],[this.userId,Number.POSITIVE_INFINITY]);return Mt(e).J(bn,t).next((r=>r.map((i=>Tn(this.serializer,i)))))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Po(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return hr(e).ee({range:i},((o,c,u)=>{let[h,f,m]=o,_=st(f);if(h===this.userId&&t.path.isEqual(_))return Mt(e).get(m).next((R=>{if(!R)throw M(61480,{nr:o,batchId:m});F(R.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:R.userId,batchId:m}),s.push(Tn(this.serializer,R))}));u.done()})).next((()=>s))}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new te(z),i=[];return t.forEach((s=>{let o=Po(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=hr(e).ee({range:c},((h,f,m)=>{let[_,R,k]=h,V=st(R);_===this.userId&&s.path.isEqual(V)?r=r.add(k):m.done()}));i.push(u)})),b.waitFor(i).next((()=>this.rr(e,r)))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Po(this.userId,r),o=IDBKeyRange.lowerBound(s),c=new te(z);return hr(e).ee({range:o},((u,h,f)=>{let[m,_,R]=u,k=st(_);m===this.userId&&r.isPrefixOf(k)?k.length===i&&(c=c.add(R)):f.done()})).next((()=>this.rr(e,c)))}rr(e,t){let r=[],i=[];return t.forEach((s=>{i.push(Mt(e).get(s).next((o=>{if(o===null)throw M(35274,{batchId:s});F(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),r.push(Tn(this.serializer,o))})))})),b.waitFor(i).next((()=>r))}removeMutationBatch(e,t){return __(e.le,this.userId,t).next((r=>(e.addOnCommittedListener((()=>{this.ir(t.batchId)})),b.forEach(r,(i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return b.resolve();let r=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),i=[];return hr(e).ee({range:r},((s,o,c)=>{if(s[0]===this.userId){let u=st(s[1]);i.push(u)}else c.done()})).next((()=>{F(i.length===0,56720,{sr:i.map((s=>s.canonicalString()))})}))}))}containsKey(e,t){return y_(e,this.userId,t)}_r(e){return I_(e).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:Cn,lastStreamToken:""}))}};function y_(n,e,t){let r=Po(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return hr(n).ee({range:s,X:!0},((c,u,h)=>{let[f,m,_]=c;f===e&&m===i&&(o=!0),h.done()})).next((()=>o))}function Mt(n){return ye(n,He)}function hr(n){return ye(n,Er)}function I_(n){return ye(n,Bi)}var Dr=class n{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new n(0)}static cr(){return new n(-1)}};var Ll=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next((t=>{let r=new Dr(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.lr(e).next((t=>B.fromTimestamp(new se(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.lr(e).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(e,t,r){return this.lr(e).next((i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.hr(e,i))))}addTargetData(e,t){return this.Pr(e,t).next((()=>this.lr(e).next((r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>or(e).delete(t.targetId))).next((()=>this.lr(e))).next((r=>(F(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r))))}removeTargets(e,t,r){let i=0,s=[];return or(e).ee(((o,c)=>{let u=Pi(c);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))})).next((()=>b.waitFor(s))).next((()=>i))}forEachTarget(e,t){return or(e).ee(((r,i)=>{let s=Pi(i);t(s)}))}lr(e){return jm(e).get(zo).next((t=>(F(t!==null,2888),t)))}hr(e,t){return jm(e).put(zo,t)}Pr(e,t){return or(e).put(d_(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next((t=>t.targetCount))}getTargetData(e,t){let r=Ln(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return or(e).ee({range:i,index:Ig},((o,c,u)=>{let h=Pi(c);ss(t,h.target)&&(s=h,u.done())})).next((()=>s))}addMatchingKeys(e,t,r){let i=[],s=Ut(e);return t.forEach((o=>{let c=be(o.path);i.push(s.put({targetId:r,path:c})),i.push(this.referenceDelegate.addReference(e,r,o))})),b.waitFor(i)}removeMatchingKeys(e,t,r){let i=Ut(e);return b.forEach(t,(s=>{let o=be(s.path);return b.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])}))}removeMatchingKeysForTargetId(e,t){let r=Ut(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ut(e),s=K();return i.ee({range:r,X:!0},((o,c,u)=>{let h=st(o[1]),f=new x(h);s=s.add(f)})).next((()=>s))}containsKey(e,t){let r=be(t.path),i=IDBKeyRange.bound([r],[hg(r)],!1,!0),s=0;return Ut(e).ee({index:Bh,X:!0,range:i},(([o,c],u,h)=>{o!==0&&(s++,h.done())})).next((()=>s>0))}At(e,t){return or(e).get(t).next((r=>r?Pi(r):null))}};function or(n){return ye(n,wr)}function jm(n){return ye(n,Nn)}function Ut(n){return ye(n,Tr)}var zm="LruGarbageCollector",yv=1048576;function Gm([n,e],[t,r]){let i=z(n,t);return i===0?z(e,r):i}var Ml=class{constructor(e){this.Ir=e,this.buffer=new te(Gm),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Gm(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},fa=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){C(zm,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){nn(t)?C(zm,"Ignoring IndexedDB error during garbage collection: ",t):await jn(t)}await this.Vr(3e5)}))}},Fl=class{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return b.resolve(Oe.ce);let r=new Ml(t);return this.mr.forEachTarget(e,(i=>r.Ar(i.sequenceNumber))).next((()=>this.mr.pr(e,(i=>r.Ar(i))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(C("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(qm)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qm):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,i,s,o,c,u,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((m=>(m>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i)))).next((m=>(r=m,c=Date.now(),this.removeTargets(e,r,t)))).next((m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((m=>(h=Date.now(),ar()<=W.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m}))))}};function E_(n,e){return new Fl(n,e)}var Ul=class{constructor(e,t){this.db=e,this.garbageCollector=E_(this,t)}gr(e){let t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,((r,i)=>t(i)))}addReference(e,t,r){return bo(e,r)}removeReference(e,t,r){return bo(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return bo(e,t)}br(e,t){return(function(i,s){let o=!1;return I_(i).te((c=>y_(i,c,s).next((u=>(u&&(o=!0),b.resolve(!u)))))).next((()=>o))})(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Sr(e,((o,c)=>{if(c<=t){let u=this.br(e,o).next((h=>{if(!h)return s++,r.getEntry(e,o).next((()=>(r.removeEntry(o,B.min()),Ut(e).delete((function(m){return[0,be(m.path)]})(o)))))}));i.push(u)}})).next((()=>b.waitFor(i))).next((()=>r.apply(e))).next((()=>s))}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return bo(e,t)}Sr(e,t){let r=Ut(e),i,s=Oe.ce;return r.ee({index:Bh},(([o,c],{path:u,sequenceNumber:h})=>{o===0?(s!==Oe.ce&&t(new x(st(i)),s),s=h,i=u):s=Oe.ce})).next((()=>{s!==Oe.ce&&t(new x(st(i)),s)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function bo(n,e){return Ut(n).put((function(r,i){return{targetId:0,path:be(r.path),sequenceNumber:i}})(e,n.currentSequenceNumber))}var pa=class{constructor(){this.changes=new Je((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Te.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Bl=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return yn(e).put(r)}removeEntry(e,t,r){return yn(e).delete((function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],aa(o),c[c.length-1]]})(t,r))}updateMetadata(e,t){return this.getMetadata(e).next((r=>(r.byteSize+=t,this.Dr(e,r))))}getEntry(e,t){let r=Te.newInvalidDocument(t);return yn(e).ee({index:Co,range:IDBKeyRange.only(bi(t))},((i,s)=>{r=this.Cr(t,s)})).next((()=>r))}vr(e,t){let r={size:0,document:Te.newInvalidDocument(t)};return yn(e).ee({index:Co,range:IDBKeyRange.only(bi(t))},((i,s)=>{r={document:this.Cr(t,s),size:ha(s)}})).next((()=>r))}getEntries(e,t){let r=Ue();return this.Fr(e,t,((i,s)=>{let o=this.Cr(i,s);r=r.insert(i,o)})).next((()=>r))}Mr(e,t){let r=Ue(),i=new ae(x.comparator);return this.Fr(e,t,((s,o)=>{let c=this.Cr(s,o);r=r.insert(s,c),i=i.insert(s,ha(o))})).next((()=>({documents:r,Or:i})))}Fr(e,t,r){if(t.isEmpty())return b.resolve();let i=new te(Wm);t.forEach((u=>i=i.add(u)));let s=IDBKeyRange.bound(bi(i.first()),bi(i.last())),o=i.getIterator(),c=o.getNext();return yn(e).ee({index:Co,range:s},((u,h,f)=>{let m=x.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;c&&Wm(c,m)<0;)r(c,null),c=o.getNext();c&&c.isEqual(m)&&(r(c,h),c=o.hasNext()?o.getNext():null),c?f.j(bi(c)):f.done()})).next((()=>{for(;c;)r(c,null),c=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),aa(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return yn(e).J(IDBKeyRange.bound(c,u,!0)).next((h=>{s?.incrementDocumentReadCount(h.length);let f=Ue();for(let m of h){let _=this.Cr(x.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);_.isFoundDocument()&&(os(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f}))}getAllFromCollectionGroup(e,t,r,i){let s=Ue(),o=Km(t,r),c=Km(t,Ge.max());return yn(e).ee({index:yg,range:IDBKeyRange.bound(o,c,!0)},((u,h,f)=>{let m=this.Cr(x.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(m.key,m),s.size===i&&f.done()})).next((()=>s))}newChangeBuffer(e){return new ql(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((t=>t.byteSize))}getMetadata(e){return $m(e).get(Zu).next((t=>(F(!!t,20021),t)))}Dr(e,t){return $m(e).put(Zu,t)}Cr(e,t){if(t){let r=mv(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(B.min())))return r}return Te.newInvalidDocument(e)}};function w_(n){return new Bl(n)}var ql=class extends pa{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Je((r=>r.toString()),((r,i)=>r.isEqual(i)))}applyChanges(e){let t=[],r=0,i=new te(((s,o)=>z(s.canonicalString(),o.canonicalString())));return this.changes.forEach(((s,o)=>{let c=this.Br.get(s);if(t.push(this.Nr.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=Cm(this.Nr.serializer,o);i=i.add(s.path.popLast());let h=ha(u);r+=h-c.size,t.push(this.Nr.addEntry(e,s,u))}else if(r-=c.size,this.trackRemovals){let u=Cm(this.Nr.serializer,o.convertToNoDocument(B.min()));t.push(this.Nr.addEntry(e,s,u))}})),i.forEach((s=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,s))})),t.push(this.Nr.updateMetadata(e,r)),b.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next((r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document)))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next((({documents:r,Or:i})=>(i.forEach(((s,o)=>{this.Br.set(s,{size:o,readTime:r.get(s).readTime})})),r)))}};function $m(n){return ye(n,qi)}function yn(n){return ye(n,jo)}function bi(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Km(n,e){let t=e.documentKey.path.toArray();return[n,aa(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Wm(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=z(t[s],r[s]),i)return i;return i=z(t.length,r.length),i||(i=z(t[t.length-2],r[r.length-2]),i||z(t[t.length-1],r[r.length-1]))}var jl=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var ma=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(r=i,this.remoteDocumentCache.getEntry(e,t)))).next((i=>(r!==null&&xi(r.mutation,i,Fe.empty(),se.now()),i)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,K()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=K()){let i=ot();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,r).next((s=>{let o=Ri();return s.forEach(((c,u)=>{o=o.insert(c,u.overlayedDocument)})),o}))))}getOverlayedDocuments(e,t){let r=ot();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,K())))}populateOverlays(e,t,r){let i=[];return r.forEach((s=>{t.has(s)||i.push(s)})),this.documentOverlayCache.getOverlays(e,i).next((s=>{s.forEach(((o,c)=>{t.set(o,c)}))}))}computeViews(e,t,r,i){let s=Ue(),o=Oi(),c=(function(){return Oi()})();return t.forEach(((u,h)=>{let f=r.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Ye)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),xi(f.mutation,h,f.mutation.getFieldMask(),se.now())):o.set(h.key,Fe.empty())})),this.recalculateAndSaveOverlays(e,s).next((u=>(u.forEach(((h,f)=>o.set(h,f))),t.forEach(((h,f)=>c.set(h,new jl(f,o.get(h)??null)))),c)))}recalculateAndSaveOverlays(e,t){let r=Oi(),i=new ae(((o,c)=>o-c)),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((o=>{for(let c of o)c.keys().forEach((u=>{let h=t.get(u);if(h===null)return;let f=r.get(u)||Fe.empty();f=c.applyToLocalView(h,f),r.set(u,f);let m=(i.get(c.batchId)||K()).add(u);i=i.insert(c.batchId,m)}))})).next((()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),h=u.key,f=u.value,m=Kg();f.forEach((_=>{if(!s.has(_)){let R=Xg(t.get(_),r.get(_));R!==null&&m.set(_,R),s=s.add(_)}})),o.push(this.documentOverlayCache.saveOverlays(e,h,m))}return b.waitFor(o)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,i){return(function(o){return x.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):qg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next((s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):b.resolve(ot()),c=Mi,u=s;return o.next((h=>b.forEach(h,((f,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),s.get(f)?b.resolve():this.remoteDocumentCache.getEntry(e,f).next((_=>{u=u.insert(f,_)}))))).next((()=>this.populateOverlays(e,h,s))).next((()=>this.computeViews(e,u,h,K()))).next((f=>({batchId:c,changes:$g(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new x(t)).next((r=>{let i=Ri();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Ri();return this.indexManager.getCollectionParents(e,s).next((c=>b.forEach(c,(u=>{let h=(function(m,_){return new Ht(_,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next((f=>{f.forEach(((m,_)=>{o=o.insert(m,_)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i)))).next((o=>{s.forEach(((u,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,Te.newInvalidDocument(f)))}));let c=Ri();return o.forEach(((u,h)=>{let f=s.get(u);f!==void 0&&xi(f.mutation,h,Fe.empty(),se.now()),os(t,h)&&(c=c.insert(u,h))})),c}))}};var zl=class{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return b.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Ne(i.createTime)}})(t)),b.resolve()}getNamedQuery(e,t){return b.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:f_(i.bundledQuery),readTime:Ne(i.readTime)}})(t)),b.resolve()}};var Gl=class{constructor(){this.overlays=new ae(x.comparator),this.qr=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){let r=ot();return b.forEach(t,(i=>this.getOverlay(e,i).next((s=>{s!==null&&r.set(i,s)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((i,s)=>{this.St(e,t,s)})),b.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.qr.get(r);return i!==void 0&&(i.forEach((s=>this.overlays=this.overlays.remove(s))),this.qr.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){let i=ot(),s=t.length+1,o=new x(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ae(((h,f)=>h-f)),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=s.get(h.largestBatchId);f===null&&(f=ot(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=ot(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((h,f)=>c.set(h,f))),!(c.size()>=i)););return b.resolve(c)}St(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.qr.get(i.largestBatchId).delete(r.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ji(t,r));let s=this.qr.get(t);s===void 0&&(s=K(),this.qr.set(t,s)),this.qr.set(t,s.add(r.key))}};var $l=class{constructor(){this.sessionToken=_e.EMPTY_BYTE_STRING}getSessionToken(e){return b.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,b.resolve()}};var Zi=class{constructor(){this.Qr=new te(de.$r),this.Ur=new te(de.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new de(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new de(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){let t=new x(new X([])),r=new de(t,e),i=new de(t,e+1),s=[];return this.Ur.forEachInRange([r,i],(o=>{this.Gr(o),s.push(o.key)})),s}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new x(new X([])),r=new de(t,e),i=new de(t,e+1),s=K();return this.Ur.forEachInRange([r,i],(o=>{s=s.add(o.key)})),s}containsKey(e){let t=new de(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},de=class{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return x.comparator(e.key,t.key)||z(e.Yr,t.Yr)}static Kr(e,t){return z(e.Yr,t.Yr)||x.comparator(e.key,t.key)}};var Kl=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new te(de.$r)}checkEmpty(e){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Qi(s,t,r,i);this.mutationQueue.push(o);for(let c of i)this.Zr=this.Zr.add(new de(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return b.resolve(o)}lookupMutationBatch(e,t){return b.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.ei(r),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?Cn:this.tr-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new de(t,0),i=new de(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([r,i],(o=>{let c=this.Xr(o.Yr);s.push(c)})),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new te(z);return t.forEach((i=>{let s=new de(i,0),o=new de(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,o],(c=>{r=r.add(c.Yr)}))})),b.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;x.isDocumentKey(s)||(s=s.child(""));let o=new de(new x(s),0),c=new te(z);return this.Zr.forEachWhile((u=>{let h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(c=c.add(u.Yr)),!0)}),o),b.resolve(this.ti(c))}ti(e){let t=[];return e.forEach((r=>{let i=this.Xr(r);i!==null&&t.push(i)})),t}removeMutationBatch(e,t){F(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return b.forEach(t.mutations,(i=>{let s=new de(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){let r=new de(t,0),i=this.Zr.firstAfterOrEqual(r);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,b.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Wl=class{constructor(e){this.ri=e,this.docs=(function(){return new ae(x.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():Te.newInvalidDocument(t))}getEntries(e,t){let r=Ue();return t.forEach((i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Te.newInvalidDocument(i))})),b.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ue(),o=t.path,c=new x(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Fh(pg(f),r)<=0||(i.has(f.key)||os(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(e,t,r,i){M(9500)}ii(e,t){return b.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new Hl(this)}getSize(e){return b.resolve(this.size)}},Hl=class extends pa{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach(((r,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(r)})),b.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}};var Ql=class{constructor(e){this.persistence=e,this.si=new Je((t=>Ln(t)),ss),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.oi=0,this._i=new Zi,this.targetCount=0,this.ai=Dr.ur()}forEachTarget(e,t){return this.si.forEach(((r,i)=>t(i))),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),b.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new Dr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Pr(t),b.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.si.forEach(((o,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.si.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)})),b.waitFor(s).next((()=>i))}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),b.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((o=>{s.push(i.markPotentiallyOrphaned(e,o))})),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),b.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this._i.containsKey(t))}};var es=class{constructor(e,t){this.ui={},this.overlays={},this.ci=new Oe(0),this.li=!1,this.li=!0,this.hi=new $l,this.referenceDelegate=e(this),this.Pi=new Ql(this),this.indexManager=new Ol,this.remoteDocumentCache=(function(i){return new Wl(i)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new oa(t),this.Ii=new zl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Gl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new Kl(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){C("MemoryPersistence","Starting transaction:",e);let i=new Jl(this.ci.next());return this.referenceDelegate.Ei(),r(i).next((s=>this.referenceDelegate.di(i).next((()=>s)))).toPromise().then((s=>(i.raiseOnCommittedEvent(),s)))}Ai(e,t){return b.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}},Jl=class extends Uo{constructor(e){super(),this.currentSequenceNumber=e}},ga=class n{constructor(e){this.persistence=e,this.Ri=new Zi,this.Vi=null}static mi(e){return new n(e)}get fi(){if(this.Vi)return this.Vi;throw M(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),b.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((i=>this.fi.add(i.toString())));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((i=>{i.forEach((s=>this.fi.add(s.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.fi,(r=>{let i=x.fromPath(r);return this.gi(e,i).next((s=>{s||t.removeEntry(i,B.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return b.or([()=>b.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}},_a=class n{constructor(e,t){this.persistence=e,this.pi=new Je((r=>be(r.path)),((r,i)=>r.isEqual(i))),this.garbageCollector=E_(this,t)}static mi(e,t){return new n(e,t)}Ei(){}di(e){return b.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((i=>r+i))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return b.forEach(this.pi,((r,i)=>this.br(e,r,i).next((s=>s?b.resolve():t(i)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,(o=>this.br(e,o,t).next((c=>{c||(r++,s.removeEntry(o,B.min()))})))).next((()=>s.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),b.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),b.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),b.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),b.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ko(e.data.value)),t}br(e,t,r){return b.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.pi.get(t);return b.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Yl=class{constructor(e){this.serializer=e}k(e,t,r,i){let s=new Bo("createOrUpgrade",t);r<1&&i>=1&&((function(u){u.createObjectStore(is)})(e),(function(u){u.createObjectStore(Bi,{keyPath:uT}),u.createObjectStore(He,{keyPath:am,autoIncrement:!0}).createIndex(bn,cm,{unique:!0}),u.createObjectStore(Er)})(e),Hm(e),(function(u){u.createObjectStore(En)})(e));let o=b.resolve();return r<3&&i>=3&&(r!==0&&((function(u){u.deleteObjectStore(Tr),u.deleteObjectStore(wr),u.deleteObjectStore(Nn)})(e),Hm(e)),o=o.next((()=>(function(u){let h=u.store(Nn),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return h.put(zo,f)})(s)))),r<4&&i>=4&&(r!==0&&(o=o.next((()=>(function(u,h){return h.store(He).J().next((m=>{u.deleteObjectStore(He),u.createObjectStore(He,{keyPath:am,autoIncrement:!0}).createIndex(bn,cm,{unique:!0});let _=h.store(He),R=m.map((k=>_.put(k)));return b.waitFor(R)}))})(e,s)))),o=o.next((()=>{(function(u){u.createObjectStore(vr,{keyPath:yT})})(e)}))),r<5&&i>=5&&(o=o.next((()=>this.yi(s)))),r<6&&i>=6&&(o=o.next((()=>((function(u){u.createObjectStore(qi)})(e),this.wi(s))))),r<7&&i>=7&&(o=o.next((()=>this.Si(s)))),r<8&&i>=8&&(o=o.next((()=>this.bi(e,s)))),r<9&&i>=9&&(o=o.next((()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)}))),r<10&&i>=10&&(o=o.next((()=>this.Di(s)))),r<11&&i>=11&&(o=o.next((()=>{(function(u){u.createObjectStore(Ba,{keyPath:IT})})(e),(function(u){u.createObjectStore(qa,{keyPath:ET})})(e)}))),r<12&&i>=12&&(o=o.next((()=>{(function(u){let h=u.createObjectStore(ja,{keyPath:RT});h.createIndex(tl,PT,{unique:!1}),h.createIndex(Tg,CT,{unique:!1})})(e)}))),r<13&&i>=13&&(o=o.next((()=>(function(u){let h=u.createObjectStore(jo,{keyPath:hT});h.createIndex(Co,dT),h.createIndex(yg,fT)})(e))).next((()=>this.Ci(e,s))).next((()=>e.deleteObjectStore(En)))),r<14&&i>=14&&(o=o.next((()=>this.Fi(e,s)))),r<15&&i>=15&&(o=o.next((()=>(function(u){u.createObjectStore(qh,{keyPath:wT,autoIncrement:!0}).createIndex(el,TT,{unique:!1}),u.createObjectStore(Ni,{keyPath:vT}).createIndex(Eg,AT,{unique:!1}),u.createObjectStore(ki,{keyPath:bT}).createIndex(wg,ST,{unique:!1})})(e)))),r<16&&i>=16&&(o=o.next((()=>{t.objectStore(Ni).clear()})).next((()=>{t.objectStore(ki).clear()}))),r<17&&i>=17&&(o=o.next((()=>{(function(u){u.createObjectStore(jh,{keyPath:NT})})(e)}))),r<18&&i>=18&&Nc()&&(o=o.next((()=>{t.objectStore(Ni).clear()})).next((()=>{t.objectStore(ki).clear()}))),o}wi(e){let t=0;return e.store(En).ee(((r,i)=>{t+=ha(i)})).next((()=>{let r={byteSize:t};return e.store(qi).put(Zu,r)}))}yi(e){let t=e.store(Bi),r=e.store(He);return t.J().next((i=>b.forEach(i,(s=>{let o=IDBKeyRange.bound([s.userId,Cn],[s.userId,s.lastAcknowledgedBatchId]);return r.J(bn,o).next((c=>b.forEach(c,(u=>{F(u.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});let h=Tn(this.serializer,u);return __(e,s.userId,h).next((()=>{}))}))))}))))}Si(e){let t=e.store(Tr),r=e.store(En);return e.store(Nn).get(zo).next((i=>{let s=[];return r.ee(((o,c)=>{let u=new X(o),h=(function(m){return[0,be(m)]})(u);s.push(t.get(h).next((f=>f?b.resolve():(m=>t.put({targetId:0,path:be(m),sequenceNumber:i.highestListenSequenceNumber}))(u))))})).next((()=>b.waitFor(s)))}))}bi(e,t){e.createObjectStore(ji,{keyPath:_T});let r=t.store(ji),i=new Xi,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return r.put({collectionId:c,parent:be(u)})}};return t.store(En).ee({X:!0},((o,c)=>{let u=new X(o);return s(u.popLast())})).next((()=>t.store(Er).ee({X:!0},(([o,c,u],h)=>{let f=st(c);return s(f.popLast())}))))}Di(e){let t=e.store(wr);return t.ee(((r,i)=>{let s=Pi(i),o=d_(this.serializer,s);return t.put(o)}))}Ci(e,t){let r=t.store(En),i=[];return r.ee(((s,o)=>{let c=t.store(jo),u=(function(m){return m.document?new x(X.fromString(m.document.name).popFirst(5)):m.noDocument?x.fromSegments(m.noDocument.path):m.unknownDocument?x.fromSegments(m.unknownDocument.path):M(36783)})(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(h))})).next((()=>b.waitFor(i)))}Fi(e,t){let r=t.store(He),i=w_(this.serializer),s=new es(ga.mi,this.serializer.yt);return r.J().next((o=>{let c=new Map;return o.forEach((u=>{let h=c.get(u.userId)??K();Tn(this.serializer,u).keys().forEach((f=>h=h.add(f))),c.set(u.userId,h)})),b.forEach(c,((u,h)=>{let f=new me(h),m=ca.wt(this.serializer,f),_=s.getIndexManager(f),R=da.wt(f,this.serializer,_,s.referenceDelegate);return new ma(i,R,m,_).recalculateAndSaveOverlaysForDocumentKeys(new zi(t,Oe.ce),u).next()}))}))}};function Hm(n){n.createObjectStore(Tr,{keyPath:mT}).createIndex(Bh,gT,{unique:!0}),n.createObjectStore(wr,{keyPath:"targetId"}).createIndex(Ig,pT,{unique:!0}),n.createObjectStore(Nn)}var Ft="IndexedDbPersistence",Lu=18e5,Mu=5e3,Fu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Iv="main",Xl=class n{constructor(e,t,r,i,s,o,c,u,h,f,m=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=s,this.window=o,this.document=c,this.xi=h,this.Oi=f,this.Ni=m,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=_=>Promise.resolve(),!n.v())throw new D(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ul(this,i),this.$i=t+Iv,this.serializer=new oa(u),this.Ui=new Ir(this.$i,this.Ni,new Yl(this.serializer)),this.hi=new Rl,this.Pi=new Ll(this.referenceDelegate,this.serializer),this.remoteDocumentCache=w_(this.serializer),this.Ii=new Sl,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&Pe(Ft,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,Fu);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Pi.getHighestSequenceNumber(e)))})).then((e=>{this.ci=new Oe(e,this.xi)})).then((()=>{this.li=!0})).catch((e=>(this.Ui&&this.Ui.close(),Promise.reject(e))))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$((async t=>{t.newVersion===null&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>So(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(e).next((t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(e))).next((t=>this.isPrimary&&!t?this.Zi(e).next((()=>!1)):!!t&&this.Xi(e).next((()=>!0)))))).catch((e=>{if(nn(e))return C(Ft,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return C(Ft,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable((()=>this.Qi(e))),this.isPrimary=e}))}Hi(e){return Si(e).get(tr).next((t=>b.resolve(this.es(t))))}ts(e){return So(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Lu)){this.qi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{let r=ye(t,vr);return r.J().next((i=>{let s=this.ss(i,Lu),o=i.filter((c=>s.indexOf(c)===-1));return b.forEach(o,(c=>r.delete(c.clientId))).next((()=>o))}))})).catch((()=>[]));if(this.Ki)for(let t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?b.resolve(!0):Si(e).get(tr).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Mu)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new D(P.FAILED_PRECONDITION,Fu);return!1}}return!(!this.networkEnabled||!this.inForeground)||So(e).J().next((r=>this.ss(r,Mu).find((i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1}))===void 0))})).next((t=>(this.isPrimary!==t&&C(Ft,`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[is,vr],(e=>{let t=new zi(e,Oe.ce);return this.Zi(t).next((()=>this.ts(t)))})),this.Ui.close(),this.Ps()}ss(e,t){return e.filter((r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(e=>So(e).J().next((t=>this.ss(t,Lu).map((r=>r.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return da.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new xl(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return ca.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){C(Ft,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=(function(u){return u===18?VT:u===17?Sg:u===16?DT:u===15?zh:u===14?bg:u===13?Ag:u===12?kT:u===11?vg:void M(60245)})(this.Ni),o;return this.Ui.runTransaction(e,i,s,(c=>(o=new zi(c,this.ci?this.ci.next():Oe.ce),t==="readwrite-primary"?this.Hi(o).next((u=>!!u||this.Yi(o))).next((u=>{if(!u)throw Pe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new D(P.FAILED_PRECONDITION,mg);return r(o)})).next((u=>this.Xi(o).next((()=>u)))):this.Is(o).next((()=>r(o)))))).then((c=>(o.raiseOnCommittedEvent(),c)))}Is(e){return Si(e).get(tr).next((t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Mu)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(P.FAILED_PRECONDITION,Fu)}))}Xi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Si(e).put(tr,t)}static v(){return Ir.v()}Zi(e){let t=Si(e);return t.get(tr).next((r=>this.es(r)?(C(Ft,"Releasing primary lease."),t.delete(tr)):b.resolve()))}rs(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(Pe(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();let e=/(?:Version|Mobile)\/1[456]/;Cc()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{let t=this.Ki?.getItem(this._s(e))!==null;return C(Ft,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return Pe(Ft,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Pe("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Si(n){return ye(n,is)}function So(n){return ye(n,vr)}function Ev(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Zl=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=i}static As(e,t){let r=K(),i=K();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var eh=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var ya=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Cc()?8:gg(ue())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ys(e,t).next((o=>{s.result=o})).next((()=>{if(!s.result)return this.ws(e,t,i,r).next((o=>{s.result=o}))})).next((()=>{if(s.result)return;let o=new eh;return this.Ss(e,t,o).next((c=>{if(s.result=c,this.Vs)return this.bs(e,t,o,c.size)}))})).next((()=>s.result))}bs(e,t,r,i){return r.documentReadCount<this.fs?(ar()<=W.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",cr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),b.resolve()):(ar()<=W.DEBUG&&C("QueryEngine","Query:",cr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.gs*i?(ar()<=W.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",cr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ze(t))):b.resolve())}ys(e,t){if(Em(t))return b.resolve(null);let r=ze(t);return this.indexManager.getIndexType(e,r).next((i=>i===0?null:(t.limit!==null&&i===1&&(t=Yo(t,null,"F"),r=ze(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((s=>{let o=K(...s);return this.ps.getDocuments(e,o).next((c=>this.indexManager.getMinOffset(e,r).next((u=>{let h=this.Ds(t,c);return this.Cs(t,h,o,u.readTime)?this.ys(e,Yo(t,null,"F")):this.vs(e,h,t,u)}))))})))))}ws(e,t,r,i){return Em(t)||i.isEqual(B.min())?b.resolve(null):this.ps.getDocuments(e,r).next((s=>{let o=this.Ds(t,s);return this.Cs(t,o,r,i)?b.resolve(null):(ar()<=W.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),cr(t)),this.vs(e,o,t,oT(i,Mi)).next((c=>c)))}))}Ds(e,t){let r=new te(zg(e));return t.forEach(((i,s)=>{os(e,s)&&(r=r.add(s))})),r}Cs(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,r){return ar()<=W.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",cr(t)),this.ps.getDocumentsMatchingQuery(e,t,Ge.min(),r)}vs(e,t,r,i){return this.ps.getDocumentsMatchingQuery(e,r,i).next((s=>(t.forEach((o=>{s=s.insert(o.key,o)})),s)))}};var Yh="LocalStore",wv=3e8,th=class{constructor(e,t,r,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new ae(z),this.xs=new Je((s=>Ln(s)),ss),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ma(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}};function T_(n,e,t,r){return new th(n,e,t,r)}async function v_(n,e){let t=G(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next((s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((s=>{let o=[],c=[],u=K();for(let h of i){o.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((h=>({Ls:h,removedBatchIds:o,addedBatchIds:c})))}))}))}function Tv(n,e){let t=G(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{let i=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,u,h,f){let m=h.batch,_=m.keys(),R=b.resolve();return _.forEach((k=>{R=R.next((()=>f.getEntry(u,k))).next((V=>{let N=h.docVersions.get(k);F(N!==null,48541),V.version.compareTo(N)<0&&(m.applyToRemoteDocument(V,h),V.isValidDocument()&&(V.setReadTime(h.commitVersion),f.addEntry(V)))}))})),R.next((()=>c.mutationQueue.removeMutationBatch(u,m)))})(t,r,e,s).next((()=>s.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(c){let u=K();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,i)))}))}function A_(n){let e=G(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function vv(n,e){let t=G(n),r=e.snapshotVersion,i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(s=>{let o=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;let c=[];e.targetChanges.forEach(((f,m)=>{let _=i.get(m);if(!_)return;c.push(t.Pi.removeMatchingKeys(s,f.removedDocuments,m).next((()=>t.Pi.addMatchingKeys(s,f.addedDocuments,m))));let R=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?R=R.withResumeToken(_e.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,r)),i=i.insert(m,R),(function(V,N,j){return V.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=wv?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0})(_,R,f)&&c.push(t.Pi.updateTargetData(s,R))}));let u=Ue(),h=K();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))})),c.push(Av(s,o,e.documentUpdates).next((f=>{u=f.ks,h=f.qs}))),!r.isEqual(B.min())){let f=t.Pi.getLastRemoteSnapshotVersion(s).next((m=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,r)));c.push(f)}return b.waitFor(c).next((()=>o.apply(s))).next((()=>t.localDocuments.getLocalViewOfDocuments(s,u,h))).next((()=>u))})).then((s=>(t.Ms=i,s)))}function Av(n,e,t){let r=K(),i=K();return t.forEach((s=>r=r.add(s))),e.getEntries(n,r).next((s=>{let o=Ue();return t.forEach(((c,u)=>{let h=s.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(B.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):C(Yh,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)})),{ks:o,qs:i}}))}function bv(n,e){let t=G(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Cn),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function Sv(n,e){let t=G(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let i;return t.Pi.getTargetData(r,e).next((s=>s?(i=s,b.resolve(i)):t.Pi.allocateTargetId(r).next((o=>(i=new kr(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,i).next((()=>i)))))))})).then((r=>{let i=t.Ms.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function nh(n,e,t){let r=G(n),i=r.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,(o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!nn(o))throw o;C(Yh,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(i.target)}function Qm(n,e,t){let r=G(n),i=B.min(),s=K();return r.persistence.runTransaction("Execute query","readwrite",(o=>(function(u,h,f){let m=G(u),_=m.xs.get(f);return _!==void 0?b.resolve(m.Ms.get(_)):m.Pi.getTargetData(h,f)})(r,o,ze(e)).next((c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,c.targetId).next((u=>{s=u}))})).next((()=>r.Fs.getDocumentsMatchingQuery(o,e,t?i:B.min(),t?s:K()))).next((c=>(Rv(r,BT(e),c),{documents:c,Qs:s})))))}function Rv(n,e,t){let r=n.Os.get(e)||B.min();t.forEach(((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)})),n.Os.set(e,r)}var Ia=class{constructor(){this.activeTargetIds=KT()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Ea=class{constructor(){this.Mo=new Ia,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ia,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var rh=class{Oo(e){}shutdown(){}};var Jm="ConnectivityMonitor",wa=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){C(Jm,"Network connectivity changed: AVAILABLE");for(let e of this.qo)e(0)}ko(){C(Jm,"Network connectivity changed: UNAVAILABLE");for(let e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ro=null;function ih(){return Ro===null?Ro=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ro++,"0x"+Ro.toString(16)}var Uu="RestConnection",Pv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},sh=class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${i}`,this.Wo=this.databaseId.database===Ko?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Go(e,t,r,i,s){let o=ih(),c=this.zo(e,t.toUriEncodedString());C(Uu,`Sending RPC '${e}' ${o}:`,c,r);let u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,i,s);let{host:h}=new URL(c),f=Pt(h);return this.Jo(e,c,u,r,f).then((m=>(C(Uu,`Received RPC '${e}' ${o}: `,m),m)),(m=>{throw On(Uu,`RPC '${e}' ${o} failed with error: `,m,"url: ",c,"request:",r),m}))}Ho(e,t,r,i,s,o){return this.Go(e,t,r,i,s)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Fr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((i,s)=>e[s]=i)),r&&r.headers.forEach(((i,s)=>e[s]=i))}zo(e,t){let r=Pv[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}};var oh=class{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}};var Ae="WebChannelConnection",ah=class extends sh{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,i,s){let o=ih();return new Promise(((c,u)=>{let h=new Cu;h.setWithCredentials(!0),h.listenOnce(Nu.COMPLETE,(()=>{try{switch(h.getLastErrorCode()){case Ti.NO_ERROR:let m=h.getResponseJson();C(Ae,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),c(m);break;case Ti.TIMEOUT:C(Ae,`RPC '${e}' ${o} timed out`),u(new D(P.DEADLINE_EXCEEDED,"Request time out"));break;case Ti.HTTP_ERROR:let _=h.getStatus();if(C(Ae,`RPC '${e}' ${o} failed with status:`,_,"response text:",h.getResponseText()),_>0){let R=h.getResponseJson();Array.isArray(R)&&(R=R[0]);let k=R?.error;if(k&&k.status&&k.message){let V=(function(j){let q=j.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(q)>=0?q:P.UNKNOWN})(k.status);u(new D(V,k.message))}else u(new D(P.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new D(P.UNAVAILABLE,"Connection failed."));break;default:M(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{C(Ae,`RPC '${e}' ${o} completed.`)}}));let f=JSON.stringify(i);C(Ae,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,r,15)}))}T_(e,t,r){let i=ih(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Vu(),c=Du(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let f=s.join("");C(Ae,`Creating RPC '${e}' stream ${i}: ${f}`,u);let m=o.createWebChannel(f,u);this.I_(m);let _=!1,R=!1,k=new oh({Yo:N=>{R?C(Ae,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(_||(C(Ae,`Opening RPC '${e}' stream ${i} transport.`),m.open(),_=!0),C(Ae,`RPC '${e}' stream ${i} sending:`,N),m.send(N))},Zo:()=>m.close()}),V=(N,j,q)=>{N.listen(j,(U=>{try{q(U)}catch(ee){setTimeout((()=>{throw ee}),0)}}))};return V(m,er.EventType.OPEN,(()=>{R||(C(Ae,`RPC '${e}' stream ${i} transport opened.`),k.o_())})),V(m,er.EventType.CLOSE,(()=>{R||(R=!0,C(Ae,`RPC '${e}' stream ${i} transport closed`),k.a_(),this.E_(m))})),V(m,er.EventType.ERROR,(N=>{R||(R=!0,On(Ae,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),k.a_(new D(P.UNAVAILABLE,"The operation could not be completed")))})),V(m,er.EventType.MESSAGE,(N=>{if(!R){let j=N.data[0];F(!!j,16349);let q=j,U=q?.error||q[0]?.error;if(U){C(Ae,`RPC '${e}' stream ${i} received error:`,U);let ee=U.status,Y=(function(g){let I=he[g];if(I!==void 0)return e_(I)})(ee),Q=U.message;Y===void 0&&(Y=P.INTERNAL,Q="Unknown error status: "+ee+" with message "+U.message),R=!0,k.a_(new D(Y,Q)),m.close()}else C(Ae,`RPC '${e}' stream ${i} received:`,j),k.u_(j)}})),V(c,ku.STAT_EVENT,(N=>{N.stat===To.PROXY?C(Ae,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===To.NOPROXY&&C(Ae,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{k.__()}),0),k}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}};function Cv(){return typeof window<"u"?window:null}function xo(){return typeof document<"u"?document:null}function Wa(n){return new wl(n,!0)}var Ta=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&C("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var Ym="PersistentStream",va=class{constructor(e,t,r,i,s,o,c,u){this.Mi=e,this.S_=r,this.b_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ta(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(Pe(t.toString()),Pe("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,i])=>{this.D_===t&&this.G_(r,i)}),(r=>{e((()=>{let i=new D(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)}))}))}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((i=>{r((()=>this.z_(i)))})),this.stream.onMessage((i=>{r((()=>++this.F_==1?this.J_(i):this.onNext(i)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return C(Ym,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(C(Ym,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}},ch=class extends va{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=cv(this.serializer,e),r=(function(s){if(!("targetChange"in s))return B.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?B.min():o.readTime?Ne(o.readTime):B.min()})(e);return this.listener.H_(t,r)}Y_(e){let t={};t.database=Al(this.serializer),t.addTarget=(function(s,o){let c,u=o.target;if(c=Qo(u)?{documents:o_(s,u)}:{query:a_(s,u).ft},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=t_(s,o.resumeToken);let h=Tl(s,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(B.min())>0){c.readTime=Nr(s,o.snapshotVersion.toTimestamp());let h=Tl(s,o.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,e);let r=lv(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){let t={};t.database=Al(this.serializer),t.removeTarget=e,this.q_(t)}},uh=class extends va{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return F(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,F(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){F(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=uv(e.writeResults,e.commitTime),r=Ne(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=Al(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map((r=>sa(this.serializer,r)))};this.q_(t)}};var lh=class{},hh=class extends lh{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new D(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Go(e,vl(t,r),i,s,o))).catch((s=>{throw s.name==="FirebaseError"?(s.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(P.UNKNOWN,s.toString())}))}Ho(e,t,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,c])=>this.connection.Ho(e,vl(t,r),i,o,c,s))).catch((o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new D(P.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}},dh=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Pe(t),this.aa=!1):C("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Bn="RemoteStore",fh=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((o=>{r.enqueueAndForget((async()=>{zn(this)&&(C(Bn,"Restarting streams for network reachability change."),await(async function(u){let h=G(u);h.Ea.add(4),await as(h),h.Ra.set("Unknown"),h.Ea.delete(4),await Ha(h)})(this))}))})),this.Ra=new dh(r,i)}};async function Ha(n){if(zn(n))for(let e of n.da)await e(!0)}async function as(n){for(let e of n.da)await e(!1)}function b_(n,e){let t=G(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),td(t)?ed(t):Ur(t).O_()&&Zh(t,e))}function Xh(n,e){let t=G(n),r=Ur(t);t.Ia.delete(e),r.O_()&&S_(t,e),t.Ia.size===0&&(r.O_()?r.L_():zn(t)&&t.Ra.set("Unknown"))}function Zh(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(B.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ur(n).Y_(e)}function S_(n,e){n.Va.Ue(e),Ur(n).Z_(e)}function ed(n){n.Va=new El({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Ur(n).start(),n.Ra.ua()}function td(n){return zn(n)&&!Ur(n).x_()&&n.Ia.size>0}function zn(n){return G(n).Ea.size===0}function R_(n){n.Va=void 0}async function Nv(n){n.Ra.set("Online")}async function kv(n){n.Ia.forEach(((e,t)=>{Zh(n,e)}))}async function Dv(n,e){R_(n),td(n)?(n.Ra.ha(e),ed(n)):n.Ra.set("Unknown")}async function Vv(n,e,t){if(n.Ra.set("Online"),e instanceof na&&e.state===2&&e.cause)try{await(async function(i,s){let o=s.cause;for(let c of s.targetIds)i.Ia.has(c)&&(await i.remoteSyncer.rejectListen(c,o),i.Ia.delete(c),i.Va.removeTarget(c))})(n,e)}catch(r){C(Bn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Aa(n,r)}else if(e instanceof pr?n.Va.Ze(e):e instanceof ta?n.Va.st(e):n.Va.tt(e),!t.isEqual(B.min()))try{let r=await A_(n.localStore);t.compareTo(r)>=0&&await(function(s,o){let c=s.Va.Tt(o);return c.targetChanges.forEach(((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.Ia.get(h);f&&s.Ia.set(h,f.withResumeToken(u.resumeToken,o))}})),c.targetMismatches.forEach(((u,h)=>{let f=s.Ia.get(u);if(!f)return;s.Ia.set(u,f.withResumeToken(_e.EMPTY_BYTE_STRING,f.snapshotVersion)),S_(s,u);let m=new kr(f.target,u,h,f.sequenceNumber);Zh(s,m)})),s.remoteSyncer.applyRemoteEvent(c)})(n,t)}catch(r){C(Bn,"Failed to raise snapshot:",r),await Aa(n,r)}}async function Aa(n,e,t){if(!nn(e))throw e;n.Ea.add(1),await as(n),n.Ra.set("Offline"),t||(t=()=>A_(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{C(Bn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ha(n)}))}function P_(n,e){return e().catch((t=>Aa(n,t,e)))}async function cs(n){let e=G(n),t=Zt(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Cn;for(;Ov(e);)try{let i=await bv(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,xv(e,i)}catch(i){await Aa(e,i)}C_(e)&&N_(e)}function Ov(n){return zn(n)&&n.Ta.length<10}function xv(n,e){n.Ta.push(e);let t=Zt(n);t.O_()&&t.X_&&t.ea(e.mutations)}function C_(n){return zn(n)&&!Zt(n).x_()&&n.Ta.length>0}function N_(n){Zt(n).start()}async function Lv(n){Zt(n).ra()}async function Mv(n){let e=Zt(n);for(let t of n.Ta)e.ea(t.mutations)}async function Fv(n,e,t){let r=n.Ta.shift(),i=_l.from(r,e,t);await P_(n,(()=>n.remoteSyncer.applySuccessfulWrite(i))),await cs(n)}async function Uv(n,e){e&&Zt(n).X_&&await(async function(r,i){if((function(o){return ZT(o)&&o!==P.ABORTED})(i.code)){let s=r.Ta.shift();Zt(r).B_(),await P_(r,(()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i))),await cs(r)}})(n,e),C_(n)&&N_(n)}async function Xm(n,e){let t=G(n);t.asyncQueue.verifyOperationInProgress(),C(Bn,"RemoteStore received new credentials");let r=zn(t);t.Ea.add(3),await as(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ha(t)}async function Bv(n,e){let t=G(n);e?(t.Ea.delete(2),await Ha(t)):e||(t.Ea.add(2),await as(t),t.Ra.set("Unknown"))}function Ur(n){return n.ma||(n.ma=(function(t,r,i){let s=G(t);return s.sa(),new ch(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:Nv.bind(null,n),t_:kv.bind(null,n),r_:Dv.bind(null,n),H_:Vv.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),td(n)?ed(n):n.Ra.set("Unknown")):(await n.ma.stop(),R_(n))}))),n.ma}function Zt(n){return n.fa||(n.fa=(function(t,r,i){let s=G(t);return s.sa(),new uh(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Lv.bind(null,n),r_:Uv.bind(null,n),ta:Mv.bind(null,n),na:Fv.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await cs(n)):(await n.fa.stop(),n.Ta.length>0&&(C(Bn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var ph=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,c=new n(e,t,o,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function nd(n,e){if(Pe("AsyncQueue",`${e}: ${n}`),nn(n))return new D(P.UNAVAILABLE,`${e}: ${n}`);throw n}var ba=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||x.comparator(t.key,r.key):(t,r)=>x.comparator(t.key,r.key),this.keyedMap=Ri(),this.sortedSet=new ae(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Sa=class{constructor(){this.ga=new ae(x.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):M(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}},Vr=class n{constructor(e,t,r,i,s,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach((c=>{o.push({type:0,doc:c})})),new n(e,t,ba.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ka(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var mh=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}},gh=class{constructor(){this.queries=Zm(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=G(t),s=i.queries;i.queries=Zm(),s.forEach(((o,c)=>{for(let u of c.Sa)u.onError(r)}))})(this,new D(P.ABORTED,"Firestore shutting down"))}};function Zm(){return new Je((n=>jg(n)),Ka)}async function k_(n,e){let t=G(n),r=3,i=e.query,s=t.queries.get(i);s?!s.ba()&&e.Da()&&(r=2):(s=new mh,r=e.Da()?0:1);try{switch(r){case 0:s.wa=await t.onListen(i,!0);break;case 1:s.wa=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){let c=nd(o,`Initialization of query '${cr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&rd(t)}async function D_(n,e){let t=G(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.Sa.indexOf(e);o>=0&&(s.Sa.splice(o,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function qv(n,e){let t=G(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.Sa)c.Fa(i)&&(r=!0);o.wa=i}}r&&rd(t)}function jv(n,e,t){let r=G(n),i=r.queries.get(e);if(i)for(let s of i.Sa)s.onError(t);r.queries.delete(e)}function rd(n){n.Ca.forEach((e=>{e.next()}))}var _h,eg;(eg=_h||(_h={})).Ma="default",eg.Cache="cache";var Ra=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Vr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Vr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==_h.Cache}};var Pa=class{constructor(e){this.key=e}},Ca=class{constructor(e){this.key=e}},yh=class{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=K(),this.mutatedKeys=K(),this.eu=zg(e),this.tu=new ba(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new Sa,i=t?t.tu:this.tu,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((f,m)=>{let _=i.get(f),R=os(this.query,m)?m:null,k=!!_&&this.mutatedKeys.has(_.key),V=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),N=!1;_&&R?_.data.isEqual(R.data)?k!==V&&(r.track({type:3,doc:R}),N=!0):this.su(_,R)||(r.track({type:2,doc:R}),N=!0,(u&&this.eu(R,u)>0||h&&this.eu(R,h)<0)&&(c=!0)):!_&&R?(r.track({type:0,doc:R}),N=!0):_&&!R&&(r.track({type:1,doc:_}),N=!0,(u||h)&&(c=!0)),N&&(R?(o=o.add(R),s=V?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))})),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{tu:o,iu:r,Cs:c,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let o=e.iu.ya();o.sort(((f,m)=>(function(R,k){let V=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{Rt:N})}};return V(R)-V(k)})(f.type,m.type)||this.eu(f.doc,m.doc))),this.ou(r),i=i??!1;let c=t&&!i?this._u():[],u=this.Xa.size===0&&this.current&&!i?1:0,h=u!==this.Za;return this.Za=u,o.length!==0||h?{snapshot:new Vr(this.query,e.tu,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Sa,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=K(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));let t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new Ca(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new Pa(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=K();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Vr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},id="SyncEngine",Ih=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Eh=class{constructor(e){this.key=e,this.hu=!1}},wh=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Je((c=>jg(c)),Ka),this.Iu=new Map,this.Eu=new Set,this.du=new ae(x.comparator),this.Au=new Map,this.Ru=new Zi,this.Vu={},this.mu=new Map,this.fu=Dr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};async function zv(n,e,t=!0){let r=F_(n),i,s=r.Tu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await V_(r,e,t,!0),i}async function Gv(n,e){let t=F_(n);await V_(t,e,!0,!1)}async function V_(n,e,t,r){let i=await Sv(n.localStore,ze(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=await $v(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&b_(n.remoteStore,i),c}async function $v(n,e,t,r,i){n.pu=(m,_,R)=>(async function(V,N,j,q){let U=N.view.ru(j);U.Cs&&(U=await Qm(V.localStore,N.query,!1).then((({documents:E})=>N.view.ru(E,U))));let ee=q&&q.targetChanges.get(N.targetId),Y=q&&q.targetMismatches.get(N.targetId)!=null,Q=N.view.applyChanges(U,V.isPrimaryClient,ee,Y);return ng(V,N.targetId,Q.au),Q.snapshot})(n,m,_,R);let s=await Qm(n.localStore,e,!0),o=new yh(e,s.Qs),c=o.ru(s.documents),u=Yi.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(c,n.isPrimaryClient,u);ng(n,t,h.au);let f=new Ih(e,t,o);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),h.snapshot}async function Kv(n,e,t){let r=G(n),i=r.Tu.get(e),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter((o=>!Ka(o,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await nh(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Xh(r.remoteStore,i.targetId),Th(r,i.targetId)})).catch(jn)):(Th(r,i.targetId),await nh(r.localStore,i.targetId,!0))}async function Wv(n,e){let t=G(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Xh(t.remoteStore,r.targetId))}async function Hv(n,e,t){let r=U_(n);try{let i=await(function(o,c){let u=G(o),h=se.now(),f=c.reduce(((R,k)=>R.add(k.key)),K()),m,_;return u.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let k=Ue(),V=K();return u.Ns.getEntries(R,f).next((N=>{k=N,k.forEach(((j,q)=>{q.isValidDocument()||(V=V.add(j))}))})).next((()=>u.localDocuments.getOverlayedDocuments(R,k))).next((N=>{m=N;let j=[];for(let q of c){let U=XT(q,m.get(q.key).overlayedDocument);U!=null&&j.push(new Ye(q.key,U,xg(U.value.mapValue),Be.exists(!0)))}return u.mutationQueue.addMutationBatch(R,h,j,c)})).next((N=>{_=N;let j=N.applyToLocalDocumentSet(m,V);return u.documentOverlayCache.saveOverlays(R,N.batchId,j)}))})).then((()=>({batchId:_.batchId,changes:$g(m)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(o,c,u){let h=o.Vu[o.currentUser.toKey()];h||(h=new ae(z)),h=h.insert(c,u),o.Vu[o.currentUser.toKey()]=h})(r,i.batchId,t),await us(r,i.changes),await cs(r.remoteStore)}catch(i){let s=nd(i,"Failed to persist write");t.reject(s)}}async function O_(n,e){let t=G(n);try{let r=await vv(t.localStore,e);e.targetChanges.forEach(((i,s)=>{let o=t.Au.get(s);o&&(F(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?F(o.hu,14607):i.removedDocuments.size>0&&(F(o.hu,42227),o.hu=!1))})),await us(t,r,e)}catch(r){await jn(r)}}function tg(n,e,t){let r=G(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach(((s,o)=>{let c=o.view.va(e);c.snapshot&&i.push(c.snapshot)})),(function(o,c){let u=G(o);u.onlineState=c;let h=!1;u.queries.forEach(((f,m)=>{for(let _ of m.Sa)_.va(c)&&(h=!0)})),h&&rd(u)})(r.eventManager,e),i.length&&r.Pu.H_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Qv(n,e,t){let r=G(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Au.get(e),s=i&&i.key;if(s){let o=new ae(x.comparator);o=o.insert(s,Te.newNoDocument(s,B.min()));let c=K().add(s),u=new ea(B.min(),new Map,new ae(z),o,c);await O_(r,u),r.du=r.du.remove(s),r.Au.delete(e),sd(r)}else await nh(r.localStore,e,!1).then((()=>Th(r,e,t))).catch(jn)}async function Jv(n,e){let t=G(n),r=e.batch.batchId;try{let i=await Tv(t.localStore,e);L_(t,r,null),x_(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await us(t,i)}catch(i){await jn(i)}}async function Yv(n,e,t){let r=G(n);try{let i=await(function(o,c){let u=G(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",(h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next((m=>(F(m!==null,37113),f=m.keys(),u.mutationQueue.removeMutationBatch(h,m)))).next((()=>u.mutationQueue.performConsistencyCheck(h))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f))).next((()=>u.localDocuments.getDocuments(h,f)))}))})(r.localStore,e);L_(r,e,t),x_(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await us(r,i)}catch(i){await jn(i)}}function x_(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function L_(n,e,t){let r=G(n),i=r.Vu[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Vu[r.currentUser.toKey()]=i}}function Th(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||M_(n,r)}))}function M_(n,e){n.Eu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Xh(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),sd(n))}function ng(n,e,t){for(let r of t)r instanceof Pa?(n.Ru.addReference(r.key,e),Xv(n,r)):r instanceof Ca?(C(id,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||M_(n,r.key)):M(19791,{wu:r})}function Xv(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(C(id,"New document in limbo: "+t),n.Eu.add(r),sd(n))}function sd(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new x(X.fromString(e)),r=n.fu.next();n.Au.set(r,new Eh(t)),n.du=n.du.insert(t,r),b_(n.remoteStore,new kr(ze($a(t.path)),r,"TargetPurposeLimboResolution",Oe.ce))}}async function us(n,e,t){let r=G(n),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((c,u)=>{o.push(r.pu(u,e,t).then((h=>{if((h||t)&&r.isPrimaryClient){let f=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(h){i.push(h);let f=Zl.As(u.targetId,h);s.push(f)}})))})),await Promise.all(o),r.Pu.H_(i),await(async function(u,h){let f=G(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(m=>b.forEach(h,(_=>b.forEach(_.Es,(R=>f.persistence.referenceDelegate.addReference(m,_.targetId,R))).next((()=>b.forEach(_.ds,(R=>f.persistence.referenceDelegate.removeReference(m,_.targetId,R)))))))))}catch(m){if(!nn(m))throw m;C(Yh,"Failed to update sequence numbers: "+m)}for(let m of h){let _=m.targetId;if(!m.fromCache){let R=f.Ms.get(_),k=R.snapshotVersion,V=R.withLastLimboFreeSnapshotVersion(k);f.Ms=f.Ms.insert(_,V)}}})(r.localStore,s))}async function Zv(n,e){let t=G(n);if(!t.currentUser.isEqual(e)){C(id,"User change. New user:",e.toKey());let r=await v_(t.localStore,e);t.currentUser=e,(function(s,o){s.mu.forEach((c=>{c.forEach((u=>{u.reject(new D(P.CANCELLED,o))}))})),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await us(t,r.Ls)}}function eA(n,e){let t=G(n),r=t.Au.get(e);if(r&&r.hu)return K().add(r.key);{let i=K(),s=t.Iu.get(e);if(!s)return i;for(let o of s){let c=t.Tu.get(o);i=i.unionWith(c.view.nu)}return i}}function F_(n){let e=G(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=O_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=eA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Qv.bind(null,e),e.Pu.H_=qv.bind(null,e.eventManager),e.Pu.yu=jv.bind(null,e.eventManager),e}function U_(n){let e=G(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Jv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Yv.bind(null,e),e}var qn=class{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Wa(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return T_(this.persistence,new ya,e.initialUser,this.serializer)}Cu(e){return new es(ga.mi,this.serializer)}Du(e){return new Ea}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}};qn.provider={build:()=>new qn};var vh=class extends qn{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){F(this.persistence.referenceDelegate instanceof _a,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new fa(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new es((r=>_a.mi(r,t)),this.serializer)}},Ah=class extends qn{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await U_(this.xu.syncEngine),await cs(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(e){return T_(this.persistence,new ya,e.initialUser,this.serializer)}Fu(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new fa(r,e.asyncQueue,t)}Mu(e,t){let r=new Xu(t,this.persistence);return new Yu(e.asyncQueue,r)}Cu(e){let t=Ev(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new Xl(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Cv(),xo(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new Ea}};var Or=class{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>tg(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Zv.bind(null,this.syncEngine),await Bv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new gh})()}createDatastore(e){let t=Wa(e.databaseInfo.databaseId),r=(function(s){return new ah(s)})(e.databaseInfo);return(function(s,o,c,u){return new hh(s,o,c,u)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,i,s,o,c){return new fh(r,i,s,o,c)})(this.localStore,this.datastore,e.asyncQueue,(t=>tg(this.syncEngine,t,0)),(function(){return wa.v()?new wa:new rh})())}createSyncEngine(e,t){return(function(i,s,o,c,u,h,f){let m=new wh(i,s,o,c,u,h);return f&&(m.gu=!0),m})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){let r=G(t);C(Bn,"RemoteStore shutting down."),r.Ea.add(5),await as(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}};Or.provider={build:()=>new Or};var Na=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Pe("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}};var en="FirestoreClient",bh=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=me.UNAUTHENTICATED,this.clientId=Li.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,(async o=>{C(en,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,(o=>(C(en,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=nd(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};async function Bu(n,e){n.asyncQueue.verifyOperationInProgress(),C(en,"Initializing OfflineComponentProvider");let t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async i=>{r.isEqual(i)||(await v_(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function rg(n,e){n.asyncQueue.verifyOperationInProgress();let t=await tA(n);C(en,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Xm(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,i)=>Xm(e.remoteStore,i))),n._onlineComponents=e}async function tA(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){C(en,"Using user provided OfflineComponentProvider");try{await Bu(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;On("Error using user provided cache. Falling back to memory cache: "+t),await Bu(n,new qn)}}else C(en,"Using default OfflineComponentProvider"),await Bu(n,new vh(void 0));return n._offlineComponents}async function B_(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(C(en,"Using user provided OnlineComponentProvider"),await rg(n,n._uninitializedComponentsProvider._online)):(C(en,"Using default OnlineComponentProvider"),await rg(n,new Or))),n._onlineComponents}function nA(n){return B_(n).then((e=>e.syncEngine))}async function q_(n){let e=await B_(n),t=e.eventManager;return t.onListen=zv.bind(null,e.syncEngine),t.onUnlisten=Kv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Gv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Wv.bind(null,e.syncEngine),t}function rA(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget((async()=>(function(s,o,c,u,h){let f=new Na({next:_=>{f.Nu(),o.enqueueAndForget((()=>D_(s,m)));let R=_.docs.has(c);!R&&_.fromCache?h.reject(new D(P.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&_.fromCache&&u&&u.source==="server"?h.reject(new D(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),m=new Ra($a(c.path),f,{includeMetadataChanges:!0,qa:!0});return k_(s,m)})(await q_(n),n.asyncQueue,e,t,r))),r.promise}function iA(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget((async()=>(function(s,o,c,u,h){let f=new Na({next:_=>{f.Nu(),o.enqueueAndForget((()=>D_(s,m))),_.fromCache&&u.source==="server"?h.reject(new D(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),m=new Ra(c,f,{includeMetadataChanges:!0,qa:!0});return k_(s,m)})(await q_(n),n.asyncQueue,e,t,r))),r.promise}function j_(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var ig=new Map;var z_="firestore.googleapis.com",sg=!0,ka=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new D(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=z_,this.ssl=sg}else this.host=e.host,this.ssl=e.ssl??sg;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=g_;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yv)throw new D(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}iT("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=j_(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new D(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},xr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ka({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ka(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new qu;switch(r.type){case"firstParty":return new $u(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=ig.get(t);r&&(C("ComponentProvider","Removing Datastore"),ig.delete(t),r.terminate())})(this),Promise.resolve()}};function sA(n,e,t,r={}){n=Qe(n,xr);let i=Pt(e),s=n._getSettings(),o={...s,emulatorOptions:n._getEmulatorOptions()},c=`${e}:${t}`;i&&(Ns(`https://${c}`),ks("Firestore",!0)),s.host!==z_&&s.host!==c&&On("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u={...s,host:c,ssl:i,emulatorOptions:r};if(!et(u,o)&&(n._setSettings(u),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=me.MOCK_USER;else{h=Pf(r.mockUserToken,n._app?.options.projectId);let m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new D(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new me(m)}n._authCredentials=new ju(new Lo(h,f))}}var tn=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Ee=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(rs(t,n._jsonSchema))return new n(e,r||null,new x(X.fromString(t.referencePath)))}};Ee._jsonSchemaVersion="firestore/documentReference/1.0",Ee._jsonSchema={type:fe("string",Ee._jsonSchemaVersion),referencePath:fe("string")};var qt=class n extends tn{constructor(e,t,r){super(e,t,$a(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ee(this.firestore,null,new x(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function od(n,e,...t){if(n=oe(n),dg("collection","path",e),n instanceof xr){let r=X.fromString(e,...t);return nm(r),new qt(n,null,r)}{if(!(n instanceof Ee||n instanceof qt))throw new D(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(X.fromString(e,...t));return nm(r),new qt(n.firestore,null,r)}}function Qa(n,e,...t){if(n=oe(n),arguments.length===1&&(e=Li.newId()),dg("doc","path",e),n instanceof xr){let r=X.fromString(e,...t);return tm(r),new Ee(n,null,new x(r))}{if(!(n instanceof Ee||n instanceof qt))throw new D(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(X.fromString(e,...t));return tm(r),new Ee(n.firestore,n instanceof qt?n.converter:null,new x(r))}}var og="AsyncQueue",Da=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ta(this,"async_queue_retry"),this._c=()=>{let r=xo();r&&C(og,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=xo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=xo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));let t=new je;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!nn(e))throw e;C(og,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){let t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Pe("INTERNAL UNHANDLED ERROR: ",ag(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=ph.createAndSchedule(this,e,t,r,(s=>this.hc(s)));return this.tc.push(i),i}uc(){this.nc&&M(47125,{Pc:ag(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function ag(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}var Et=class extends xr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Da,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Da(e),this._firestoreClient=void 0,await e}}};function G_(n,e){let t=typeof n=="object"?n:Ls(),r=typeof n=="string"?n:e||Ko,i=oi(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Rf("firestore");s&&sA(i,...s)}return i}function ad(n){if(n._terminated)throw new D(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||$_(n),n._firestoreClient}function $_(n){let e=n._freezeSettings(),t=(function(i,s,o,c){return new nl(i,s,o,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,j_(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new bh(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){let s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(n._componentsProvider))}function K_(n,e){On("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return oA(n,Or.provider,{build:r=>new Ah(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function oA(n,e,t){if((n=Qe(n,Et))._firestoreClient||n._terminated)throw new D(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new D(P.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},$_(n)}var jt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(_e.fromBase64String(e))}catch(t){throw new D(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(_e.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(rs(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};jt._jsonSchemaVersion="firestore/bytes/1.0",jt._jsonSchema={type:fe("string",jt._jsonSchemaVersion),bytes:fe("string")};var Lr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ge(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Mr=class{constructor(e){this._methodName=e}};var zt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return z(this._lat,e._lat)||z(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(rs(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};zt._jsonSchemaVersion="firestore/geoPoint/1.0",zt._jsonSchema={type:fe("string",zt._jsonSchemaVersion),latitude:fe("number"),longitude:fe("number")};var Gt=class n{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(rs(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new n(e.vectorValues);throw new D(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Gt._jsonSchemaVersion="firestore/vectorValue/1.0",Gt._jsonSchema={type:fe("string",Gt._jsonSchemaVersion),vectorValues:fe("object")};var aA=/^__.*__$/,Sh=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ye(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xt(e,this.data,t,this.fieldTransforms)}},Va=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ye(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function W_(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ac:n})}}var Rh=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new n({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return xa(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(W_(this.Ac)&&aA.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}},Ph=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Wa(e)}Cc(e,t,r,i=!1){return new Rh({Ac:e,methodName:t,Dc:r,path:ge.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ja(n){let e=n._freezeSettings(),t=Wa(n._databaseId);return new Ph(n._databaseId,!!e.ignoreUndefinedProperties,t)}function H_(n,e,t,r,i,s={}){let o=n.Cc(s.merge||s.mergeFields?2:0,e,t,i);cd("Data must be an object, but it was:",o,r);let c=Q_(r,o),u,h;if(s.merge)u=new Fe(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let _=Nh(e,m,t);if(!o.contains(_))throw new D(P.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Y_(f,_)||f.push(_)}u=new Fe(f),h=o.fieldTransforms.filter((m=>u.covers(m.field)))}else u=null,h=o.fieldTransforms;return new Sh(new Ce(c),u,h)}var Oa=class n extends Mr{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};var Ch=class n extends Mr{_toFieldTransform(e){return new Xo(e.path,new Qt)}isEqual(e){return e instanceof n}};function cA(n,e,t,r){let i=n.Cc(1,e,t);cd("Data must be an object, but it was:",i,r);let s=[],o=Ce.empty();rn(r,((u,h)=>{let f=ud(e,u,t);h=oe(h);let m=i.yc(f);if(h instanceof Oa)s.push(f);else{let _=ls(h,m);_!=null&&(s.push(f),o.set(f,_))}}));let c=new Fe(s);return new Va(o,c,i.fieldTransforms)}function uA(n,e,t,r,i,s){let o=n.Cc(1,e,t),c=[Nh(e,r,t)],u=[i];if(s.length%2!=0)throw new D(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)c.push(Nh(e,s[_])),u.push(s[_+1]);let h=[],f=Ce.empty();for(let _=c.length-1;_>=0;--_)if(!Y_(h,c[_])){let R=c[_],k=u[_];k=oe(k);let V=o.yc(R);if(k instanceof Oa)h.push(R);else{let N=ls(k,V);N!=null&&(h.push(R),f.set(R,N))}}let m=new Fe(h);return new Va(f,m,o.fieldTransforms)}function lA(n,e,t,r=!1){return ls(t,n.Cc(r?4:3,e))}function ls(n,e){if(J_(n=oe(n)))return cd("Unsupported field value:",e,n),Q_(n,e);if(n instanceof Mr)return(function(r,i){if(!W_(i.Ac))throw i.Sc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,i){let s=[],o=0;for(let c of r){let u=ls(c,i.wc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=oe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return WT(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=se.fromDate(r);return{timestampValue:Nr(i.serializer,s)}}if(r instanceof se){let s=new se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Nr(i.serializer,s)}}if(r instanceof zt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof jt)return{bytesValue:t_(i.serializer,r._byteString)};if(r instanceof Ee){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Qh(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Gt)return(function(o,c){return{mapValue:{fields:{[$h]:{stringValue:Kh},[br]:{arrayValue:{values:o.toArray().map((h=>{if(typeof h!="number")throw c.Sc("VectorValues must only contain numeric values.");return Hh(c.serializer,h)}))}}}}}})(r,i);throw i.Sc(`Unsupported field value: ${Fa(r)}`)})(n,e)}function Q_(n,e){let t={};return Rg(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):rn(n,((r,i)=>{let s=ls(i,e.mc(r));s!=null&&(t[r]=s)})),{mapValue:{fields:t}}}function J_(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof se||n instanceof zt||n instanceof jt||n instanceof Ee||n instanceof Mr||n instanceof Gt)}function cd(n,e,t){if(!J_(t)||!fg(t)){let r=Fa(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Nh(n,e,t){if((e=oe(e))instanceof Lr)return e._internalPath;if(typeof e=="string")return ud(n,e);throw xa("Field path arguments must be of type string or ",n,!1,void 0,t)}var hA=new RegExp("[~\\*/\\[\\]]");function ud(n,e,t){if(e.search(hA)>=0)throw xa(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Lr(...e.split("."))._internalPath}catch{throw xa(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function xa(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new D(P.INVALID_ARGUMENT,c+n+u)}function Y_(n,e){return n.some((t=>t.isEqual(e)))}var La=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ee(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new kh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ld("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},kh=class extends La{data(){return super.data()}};function ld(n,e){return typeof e=="string"?ud(n,e):e instanceof Lr?e._internalPath:e._delegate._internalPath}function dA(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ts=class{},ns=class extends ts{};function hd(n,e,...t){let r=[];e instanceof ts&&r.push(e),r=r.concat(t),(function(s){let o=s.filter((u=>u instanceof Vh)).length,c=s.filter((u=>u instanceof Dh)).length;if(o>1||o>0&&c>0)throw new D(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var Dh=class n extends ns{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return X_(e._query,t),new tn(e.firestore,e.converter,ml(e._query,t))}_parse(e){let t=Ja(e.firestore);return(function(s,o,c,u,h,f,m){let _;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new D(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){ug(m,f);let k=[];for(let V of m)k.push(cg(u,s,V));_={arrayValue:{values:k}}}else _=cg(u,s,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||ug(m,f),_=lA(c,o,m,f==="in"||f==="not-in");return H.create(h,f,_)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};var Vh=class n extends ts{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:Z.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)X_(o,u),o=ml(o,u)})(e._query,t),new tn(e.firestore,e.converter,ml(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Oh=class n extends ns{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=(function(i,s,o){if(i.startAt!==null)throw new D(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new D(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new xn(s,o)})(e._query,this._field,this._direction);return new tn(e.firestore,e.converter,(function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ht(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function dd(n,e="asc"){let t=e,r=ld("orderBy",n);return Oh._create(r,t)}var xh=class n extends ns{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new tn(e.firestore,e.converter,Yo(e._query,this._limit,this._limitType))}};function fd(n){return sT("limit",n),xh._create("limit",n,"F")}function cg(n,e,t){if(typeof(t=oe(t))=="string"){if(t==="")throw new D(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!qg(e)&&t.indexOf("/")!==-1)throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(X.fromString(t));if(!x.isDocumentKey(r))throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ki(n,new x(r))}if(t instanceof Ee)return Ki(n,t._key);throw new D(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Fa(t)}.`)}function ug(n,e){if(!Array.isArray(n)||n.length===0)throw new D(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function X_(n,e){let t=(function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new D(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Lh=class{convertValue(e,t="none"){switch($t(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(It(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return rn(e,((i,s)=>{r[i]=this.convertValue(s,t)})),r}convertVectorValue(e){let t=e.fields?.[br].arrayValue?.values?.map((r=>ie(r.doubleValue)));return new Gt(t)}convertGeoPoint(e){return new zt(ie(e.latitude),ie(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":let r=za(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Gi(e));default:return null}}convertTimestamp(e){let t=yt(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=X.fromString(e);F(h_(r),9688,{name:e});let i=new Ar(r.get(1),r.get(3)),s=new x(r.popFirst(5));return i.isEqual(t)||Pe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Z_(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Rn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Dn=class n extends La{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new mr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(ld("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Dn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Dn._jsonSchema={type:fe("string",Dn._jsonSchemaVersion),bundleSource:fe("string","DocumentSnapshot"),bundleName:fe("string"),bundle:fe("string")};var mr=class extends Dn{data(e={}){return super.data(e)}},gr=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Rn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new mr(this._firestore,this._userDataWriter,r.key,r,new Rn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map((c=>{let u=new mr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Rn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter((c=>s||c.type!==3)).map((c=>{let u=new mr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Rn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:fA(c.type),doc:u,oldIndex:h,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Li.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach((s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function fA(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:n})}}function ey(n){n=Qe(n,Ee);let e=Qe(n.firestore,Et);return rA(ad(e),n._key).then((t=>pA(e,n,t)))}gr._jsonSchemaVersion="firestore/querySnapshot/1.0",gr._jsonSchema={type:fe("string",gr._jsonSchemaVersion),bundleSource:fe("string","QuerySnapshot"),bundleName:fe("string"),bundle:fe("string")};var Ma=class extends Lh{constructor(e){super(),this.firestore=e}convertBytes(e){return new jt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ee(this.firestore,null,t)}};function pd(n){n=Qe(n,tn);let e=Qe(n.firestore,Et),t=ad(e),r=new Ma(e);return dA(n._query),iA(t,n._query).then((i=>new gr(e,r,n,i)))}function ty(n,e,t){n=Qe(n,Ee);let r=Qe(n.firestore,Et),i=Z_(n.converter,e,t);return _d(r,[H_(Ja(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Be.none())])}function md(n,e,t,...r){n=Qe(n,Ee);let i=Qe(n.firestore,Et),s=Ja(i),o;return o=typeof(e=oe(e))=="string"||e instanceof Lr?uA(s,"updateDoc",n._key,e,t,r):cA(s,"updateDoc",n._key,e),_d(i,[o.toMutation(n._key,Be.exists(!0))])}function gd(n,e){let t=Qe(n.firestore,Et),r=Qa(n),i=Z_(n.converter,e);return _d(t,[H_(Ja(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Be.exists(!1))]).then((()=>r))}function _d(n,e){return(function(r,i){let s=new je;return r.asyncQueue.enqueueAndForget((async()=>Hv(await nA(r),i,s))),s.promise})(ad(n),e)}function pA(n,e,t){let r=t.docs.get(e._key),i=new Ma(n);return new Dn(n,i,e._key,r,new Rn(t.hasPendingWrites,t.fromCache),e.converter)}function sn(){return new Ch("serverTimestamp")}(function(e,t=!0){(function(i){Fr=i})(Dt),kt(new qe("firestore",((r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),c=new Et(new zu(r.getProvider("auth-internal")),new Ku(o,r.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new D(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ar(h.options.projectId,f)})(o,i),o);return s={useFetchStreams:t,...s},c._setSettings(s),c}),"PUBLIC").setMultipleInstances(!0)),Ke(Xp,Zp,e),Ke(Xp,Zp,"esm2020")})();var mA={apiKey:"AIzaSyARjB1PrtGtQI08_8bHPC2d9fNbrOvp1sQ",authDomain:"leetcodeextension-64ac6.firebaseapp.com",projectId:"leetcodeextension-64ac6",storageBucket:"leetcodeextension-64ac6.firebasestorage.app",messagingSenderId:"623995174552",appId:"1:623995174552:web:847ee6c174396383e29aed",measurementId:"G-04BB8PFB65"},yd=$c(mA),$e=Ru(yd),Br=G_(yd);function gA(){return Tu($e,Eo)}async function _A(){try{await K_(Br)}catch{}}function yA(n){return vu($e,n)}function IA(n){return yo($e,n)}function EA(n,e){console.log("[Firebase Auth] signInWithEmailPassword called"),console.log("[Firebase Auth] Email:",n),console.log("[Firebase Auth] Current user before sign in:",$e.currentUser?.uid);try{let t=wu($e,n,e);return console.log("[Firebase Auth] signInWithEmailAndPassword promise created:",t),t&&typeof t.then=="function"&&t.then(r=>{console.log("[Firebase Auth] \u2705 Sign in promise resolved"),console.log("[Firebase Auth] User credential:",r?.user?{uid:r.user.uid,email:r.user.email}:null),console.log("[Firebase Auth] Current user after sign in:",$e.currentUser?.uid)}).catch(r=>{console.error("[Firebase Auth] \u274C Sign in promise rejected:",r),console.error("[Firebase Auth] Error code:",r?.code),console.error("[Firebase Auth] Error message:",r?.message)}),t}catch(t){throw console.error("[Firebase Auth] \u274C Error in signInWithEmailPassword:",t),t}}async function wA(n,e){console.log("[Email Verification] Starting registration for:",n);let t=await Eu($e,n,e);if(console.log("[Email Verification] User created:",{uid:t.user?.uid,email:t.user?.email}),t.user)try{console.log("[Email Verification] Sending verification email to:",t.user.email),await _o(t.user),console.log("[Email Verification] \u2705 Verification email sent successfully")}catch(r){throw console.error("[Email Verification] \u274C Error sending verification email:",r),console.error("[Email Verification] Error details:",{code:r.code,message:r.message,stack:r.stack}),r}else console.warn("[Email Verification] \u26A0\uFE0F No user in credential, cannot send verification email");return t}function TA(){console.log("[Firebase Auth] signOutUser called"),console.log("[Firebase Auth] Current user before sign out:",$e.currentUser?.uid);try{let n=Au($e);return console.log("[Firebase Auth] signOut promise created:",n),n&&typeof n.then=="function"&&n.then(()=>{console.log("[Firebase Auth] \u2705 Sign out promise resolved"),console.log("[Firebase Auth] Current user after sign out:",$e.currentUser)}).catch(e=>{console.error("[Firebase Auth] \u274C Sign out promise rejected:",e)}),n}catch(n){throw console.error("[Firebase Auth] \u274C Error in signOutUser:",n),n}}async function vA(){console.log("[Email Verification] sendVerificationEmail called");let n=Gn();if(console.log("[Email Verification] Current user:",{uid:n.uid,email:n.email,emailVerified:n.emailVerified}),n.emailVerified)throw console.log("[Email Verification] \u26A0\uFE0F Email already verified, skipping send"),new Error("Email is already verified");try{console.log("[Email Verification] Sending verification email to:",n.email);let e=await _o(n);return console.log("[Email Verification] \u2705 Verification email sent successfully:",e),e}catch(e){throw console.error("[Email Verification] \u274C Error sending verification email:",e),console.error("[Email Verification] Error details:",{code:e.code,message:e.message,stack:e.stack}),e}}async function AA(n=!1){console.log("[Email Verification] checkEmailVerified called, forceReload:",n);let e=Gn();if(console.log("[Email Verification] User before reload:",{uid:e.uid,email:e.email,emailVerified:e.emailVerified}),!n&&window._isProcessingTokenChange)return console.log("[Email Verification] \u26A0\uFE0F Token change in progress, skipping reload to avoid loop"),e.emailVerified;try{return n?(console.log("[Email Verification] Reloading user to get latest status..."),await mo(e),console.log("[Email Verification] User after reload:",{uid:e.uid,email:e.email,emailVerified:e.emailVerified})):console.log("[Email Verification] Using current user.emailVerified without reload:",e.emailVerified),e.emailVerified}catch(t){return console.error("[Email Verification] \u274C Error reloading user:",t),console.error("[Email Verification] Error details:",{code:t.code,message:t.message,stack:t.stack}),console.log("[Email Verification] Returning current emailVerified status:",e.emailVerified),e.emailVerified}}function Gn(){let n=$e.currentUser;if(!n||!n.uid)throw new Error("Not signed in");return n}function ny(n){return od(Br,"users",n,"chats")}function ry(n,e){return od(Br,"users",n,"chats",e,"messages")}async function bA(){let n=Gn(),e=Qa(Br,"users",n.uid),t=await ey(e),r={email:n.email||null,displayName:n.displayName||null,updatedAt:sn(),lastLoginAt:sn()};t.exists()?await md(e,r):await ty(e,{...r,createdAt:sn()})}async function SA({title:n,problemKey:e,problemUrl:t,model:r,systemPrompt:i,summary:s}={}){let o=Gn(),c=sn(),u={title:n||"New Chat",problemKey:e||null,problemUrl:t||null,model:r||null,systemPrompt:i||null,summary:s||null,createdAt:c,updatedAt:c,lastMessageAt:c};return{chatId:(await gd(ny(o.uid),u)).id}}async function RA({chatId:n,role:e,content:t,model:r=null,toolCalls:i=[]}={}){if(!n)throw new Error("chatId is required");if(!e)throw new Error("role is required");if(typeof t!="string")throw new Error("content must be a string");let s=Gn(),o={role:e,content:t,model:r,toolCalls:i,createdAt:sn()};await gd(ry(s.uid,n),o);let c=Qa(Br,"users",s.uid,"chats",n);await md(c,{updatedAt:sn(),lastMessageAt:sn()})}async function PA({max:n=50}={}){let e=Gn(),t=hd(ny(e.uid),dd("lastMessageAt","desc"),fd(n));return(await pd(t)).docs.map(i=>({chatId:i.id,...i.data()}))}async function CA(n,{max:e=500}={}){if(!n)throw new Error("chatId is required");let t=Gn(),r=hd(ry(t.uid,n),dd("createdAt","asc"),fd(e));return(await pd(r)).docs.map(s=>({messageId:s.id,...s.data()}))}return By(NA);})();
/*! Bundled license information:

@firebase/util/dist/index.esm.js:
@firebase/util/dist/index.esm.js:
@firebase/util/dist/index.esm.js:
@firebase/util/dist/index.esm.js:
@firebase/util/dist/index.esm.js:
@firebase/util/dist/index.esm.js:
@firebase/util/dist/index.esm.js:
@firebase/util/dist/index.esm.js:
@firebase/util/dist/index.esm.js:
@firebase/logger/dist/esm/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm.js:
@firebase/component/dist/esm/index.esm.js:
@firebase/app/dist/esm/index.esm.js:
@firebase/app/dist/esm/index.esm.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm.js:
firebase/app/dist/esm/index.esm.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/util/dist/index.esm.js:
@firebase/auth/dist/esm/index-1970027f.js:
@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/app/dist/esm/index.esm.js:
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-1970027f.js:
@firebase/auth/dist/esm/index-1970027f.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-1970027f.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-1970027f.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-1970027f.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-1970027f.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-1970027f.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/auth/dist/esm/index-1970027f.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/webchannel-wrapper/dist/bloom-blob/esm/bloom_blob_es2018.js:
@firebase/webchannel-wrapper/dist/webchannel-blob/esm/webchannel_blob_es2018.js:
  (** @license
  Copyright The Closure Library Authors.
  SPDX-License-Identifier: Apache-2.0
  *)
  (** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  *)

@firebase/firestore/dist/index.esm.js:
  (**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law | agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2025 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@firebase/firestore/dist/index.esm.js:
@firebase/firestore/dist/index.esm.js:
  (**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
